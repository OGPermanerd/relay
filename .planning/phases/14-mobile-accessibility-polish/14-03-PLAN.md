---
phase: 14-mobile-accessibility-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/sortable-column-header.tsx
  - apps/web/components/skills-table.tsx
autonomous: true

must_haves:
  truths:
    - "Screen readers announce which column is sorted and in what direction"
    - "aria-sort attribute is present on the active sorted column header"
    - "Sort changes trigger live region announcement"
  artifacts:
    - path: "apps/web/components/sortable-column-header.tsx"
      provides: "Column header with aria-sort attribute"
      contains: "aria-sort"
    - path: "apps/web/components/skills-table.tsx"
      provides: "Sort change announcements"
      contains: "announceToScreenReader"
  key_links:
    - from: "sortable-column-header.tsx"
      to: "screen reader"
      via: "aria-sort attribute"
      pattern: "aria-sort=.*ascending|descending"
    - from: "skills-table.tsx"
      to: "lib/accessibility.ts"
      via: "import announceToScreenReader"
      pattern: "announceToScreenReader"
---

<objective>
Add aria-sort attributes to sortable column headers and announce sort changes to screen readers via live region.

Purpose: Satisfies A11Y-03 requirement - sort indicators are screen reader accessible
Output: Column headers with aria-sort, sort change announcements
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-mobile-accessibility-polish/14-CONTEXT.md
@.planning/phases/14-mobile-accessibility-polish/14-RESEARCH.md
@apps/web/components/sortable-column-header.tsx
@apps/web/components/skills-table.tsx
@apps/web/hooks/use-sort-state.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add aria-sort to SortableColumnHeader</name>
  <files>apps/web/components/sortable-column-header.tsx</files>
  <action>
Add the `aria-sort` attribute to the `<th>` element to indicate sort state to screen readers.

Per WCAG and Adrian Roselli's guidance:
- Use `aria-sort="ascending"` or `aria-sort="descending"` on the active sorted column
- Omit the attribute entirely on non-sorted columns (NOT `aria-sort="none"`)
- Add `aria-hidden="true"` to the chevron SVG since it's decorative

Update the `<th>` element:
```tsx
<th
  scope="col"
  aria-sort={isActive ? (direction === "asc" ? "ascending" : "descending") : undefined}
  className={`px-4 py-3 text-xs font-medium uppercase tracking-wider text-gray-500 ${alignmentClass}`}
>
```

Update the SVG to hide from screen readers:
```tsx
<svg
  className={`h-4 w-4 ${chevronColor}`}
  fill="none"
  viewBox="0 0 24 24"
  strokeWidth={1.5}
  stroke="currentColor"
  aria-hidden="true"
  focusable="false"
>
```

The `focusable="false"` prevents IE/Edge from focusing the SVG.
  </action>
  <verify>
Grep for aria-sort: `grep -n "aria-sort" apps/web/components/sortable-column-header.tsx` - should find 1 match
Grep for aria-hidden on SVG: `grep -n 'aria-hidden="true"' apps/web/components/sortable-column-header.tsx` - should find 1 match
TypeScript compiles: `cd /home/claude/projects/relay && pnpm exec tsc --noEmit`
  </verify>
  <done>
SortableColumnHeader has aria-sort attribute on active sorted column, decorative icons hidden from screen readers.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add sort change announcements</name>
  <files>apps/web/components/skills-table.tsx</files>
  <action>
Import the announceToScreenReader utility and call it when sort state changes.

1. Add import at top:
```tsx
import { announceToScreenReader } from "@/lib/accessibility";
```

2. Create a useEffect that announces when sort changes:
```tsx
import { useMemo, useEffect, useRef } from "react";

// Inside component, after useSortState:
const isFirstRender = useRef(true);

useEffect(() => {
  // Skip announcement on initial render
  if (isFirstRender.current) {
    isFirstRender.current = false;
    return;
  }

  // Map column keys to human-readable labels
  const columnLabels: Record<string, string> = {
    name: "Skill Name",
    days_saved: "Days Saved",
    installs: "Installs",
    date: "Date Added",
    author: "Author",
  };

  const columnLabel = columnLabels[sortBy] || sortBy;
  const directionLabel = sortDir === "asc" ? "ascending" : "descending";

  announceToScreenReader(`Table sorted by ${columnLabel}, ${directionLabel}`);
}, [sortBy, sortDir]);
```

This ensures:
- No announcement on page load (only on user-triggered sort changes)
- Human-readable column names in announcement
- Clear direction indicator
  </action>
  <verify>
Grep for import: `grep -n "announceToScreenReader" apps/web/components/skills-table.tsx` - should find 2 matches (import + usage)
Grep for useEffect: `grep -n "useEffect" apps/web/components/skills-table.tsx` - should find at least 1 match
TypeScript compiles: `cd /home/claude/projects/relay && pnpm exec tsc --noEmit`
  </verify>
  <done>
Sort changes trigger screen reader announcement with column name and direction.
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `pnpm exec tsc --noEmit` passes
2. Column headers have aria-sort="ascending" or "descending" when active
3. SVG icons have aria-hidden="true"
4. Changing sort triggers announceToScreenReader call (verify with console.log or screen reader)
</verification>

<success_criteria>
- aria-sort attribute present on sorted column header
- Sort direction announced to screen readers on change
- Decorative icons hidden from assistive technology
- No announcement on initial page load
</success_criteria>

<output>
After completion, create `.planning/phases/14-mobile-accessibility-polish/14-03-SUMMARY.md`
</output>
