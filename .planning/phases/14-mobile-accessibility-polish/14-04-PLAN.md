---
phase: 14-mobile-accessibility-polish
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/hooks/use-login-count.ts
  - apps/web/components/leaderboard-table.tsx
autonomous: true

must_haves:
  truths:
    - "Leaderboard can be collapsed on mobile"
    - "First 5 logins show expanded leaderboard with auto-collapse after 5 seconds"
    - "After 5th login, leaderboard starts collapsed"
  artifacts:
    - path: "apps/web/hooks/use-login-count.ts"
      provides: "Login count tracking via localStorage"
      exports: ["useLoginCount"]
    - path: "apps/web/components/leaderboard-table.tsx"
      provides: "Collapsible leaderboard with onboarding logic"
      contains: "isExpanded"
  key_links:
    - from: "leaderboard-table.tsx"
      to: "use-login-count.ts"
      via: "import hook"
      pattern: "useLoginCount"
    - from: "use-login-count.ts"
      to: "localStorage"
      via: "getItem/setItem"
      pattern: "localStorage"
---

<objective>
Create a useLoginCount hook to track user visits and make the LeaderboardTable collapsible with smart onboarding behavior (expanded for first 5 visits, collapsed afterward).

Purpose: Improves mobile UX by allowing users to collapse leaderboard once familiar with it
Output: Collapsible leaderboard with progressive disclosure
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-mobile-accessibility-polish/14-CONTEXT.md
@.planning/phases/14-mobile-accessibility-polish/14-RESEARCH.md
@apps/web/components/leaderboard-table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useLoginCount hook</name>
  <files>apps/web/hooks/use-login-count.ts</files>
  <action>
Create a hook to track user login/visit count using localStorage with sessionStorage deduplication.

```typescript
"use client";

import { useState, useEffect } from "react";

const LOGIN_COUNT_KEY = "relay-login-count";
const SESSION_COUNTED_KEY = "relay-session-counted";
const ONBOARDING_THRESHOLD = 5;

interface UseLoginCountReturn {
  count: number;
  isOnboarding: boolean;
}

/**
 * Track user login count for progressive feature disclosure.
 *
 * - Increments once per session (not per page load)
 * - Persists count in localStorage across sessions
 * - `isOnboarding` is true for first 5 sessions
 *
 * @returns { count, isOnboarding }
 */
export function useLoginCount(): UseLoginCountReturn {
  const [count, setCount] = useState<number>(0);

  useEffect(() => {
    // SSR guard
    if (typeof window === "undefined") return;

    // Read current count
    let currentCount = 0;
    try {
      const stored = localStorage.getItem(LOGIN_COUNT_KEY);
      currentCount = stored ? parseInt(stored, 10) : 0;
    } catch {
      // localStorage not available
      currentCount = 0;
    }

    // Check if already counted this session
    const alreadyCounted = sessionStorage.getItem(SESSION_COUNTED_KEY);

    if (!alreadyCounted) {
      // Increment count
      currentCount += 1;
      try {
        localStorage.setItem(LOGIN_COUNT_KEY, String(currentCount));
        sessionStorage.setItem(SESSION_COUNTED_KEY, "true");
      } catch {
        // Storage not available, continue with memory state
      }
    }

    setCount(currentCount);
  }, []);

  const isOnboarding = count <= ONBOARDING_THRESHOLD;

  return { count, isOnboarding };
}
```

Key features:
- Increments once per session via sessionStorage flag
- Persists across sessions via localStorage
- `isOnboarding` true for first 5 sessions
- Gracefully handles storage errors (private browsing)
- SSR-safe with window check
  </action>
  <verify>
File exists: `ls apps/web/hooks/use-login-count.ts`
TypeScript compiles: `cd /home/claude/projects/relay && pnpm exec tsc --noEmit`
Exports useLoginCount: `grep -n "export function useLoginCount" apps/web/hooks/use-login-count.ts`
  </verify>
  <done>
useLoginCount hook tracks user visits and provides isOnboarding flag for first 5 sessions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Make LeaderboardTable collapsible</name>
  <files>apps/web/components/leaderboard-table.tsx</files>
  <action>
Add collapsible behavior to LeaderboardTable with onboarding auto-collapse.

1. Add imports:
```tsx
import { useState, useEffect, useRef } from "react";
import { useLoginCount } from "@/hooks/use-login-count";
```

2. Add state and onboarding logic inside component:
```tsx
export function LeaderboardTable({ contributors }: LeaderboardTableProps) {
  const { author, filterByAuthor } = useAuthorFilter();
  const { isOnboarding } = useLoginCount();

  // Start expanded during onboarding, collapsed after
  const [isExpanded, setIsExpanded] = useState(true);
  const autoCollapseRef = useRef<NodeJS.Timeout | null>(null);

  // Auto-collapse after 5 seconds during onboarding
  useEffect(() => {
    if (isOnboarding && isExpanded) {
      autoCollapseRef.current = setTimeout(() => {
        setIsExpanded(false);
      }, 5000);
    }

    return () => {
      if (autoCollapseRef.current) {
        clearTimeout(autoCollapseRef.current);
      }
    };
  }, [isOnboarding, isExpanded]);

  // After onboarding period, start collapsed
  useEffect(() => {
    if (!isOnboarding) {
      setIsExpanded(false);
    }
  }, [isOnboarding]);
```

3. Add collapsible header with toggle button:
```tsx
  if (contributors.length === 0) {
    return <p className="text-gray-500">No contributors yet. Be the first to share a skill!</p>;
  }

  return (
    <div className="overflow-hidden rounded-lg border border-gray-200">
      {/* Collapsible header */}
      <button
        type="button"
        onClick={() => setIsExpanded(!isExpanded)}
        aria-expanded={isExpanded}
        aria-controls="leaderboard-content"
        className="flex w-full items-center justify-between bg-gray-50 px-4 py-3 text-left text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-inset"
      >
        <span>Top Contributors</span>
        <svg
          className={`h-5 w-5 text-gray-500 transition-transform ${isExpanded ? "rotate-180" : ""}`}
          fill="none"
          viewBox="0 0 24 24"
          strokeWidth={1.5}
          stroke="currentColor"
          aria-hidden="true"
        >
          <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
        </svg>
      </button>

      {/* Collapsible content */}
      {isExpanded && (
        <div id="leaderboard-content">
          <table className="min-w-full divide-y divide-gray-200">
            {/* existing thead and tbody unchanged */}
          </table>
        </div>
      )}
    </div>
  );
```

The existing table markup stays the same, just wrapped in the collapsible structure.
  </action>
  <verify>
Grep for useLoginCount import: `grep -n "useLoginCount" apps/web/components/leaderboard-table.tsx`
Grep for aria-expanded: `grep -n "aria-expanded" apps/web/components/leaderboard-table.tsx`
Grep for isExpanded state: `grep -n "isExpanded" apps/web/components/leaderboard-table.tsx`
TypeScript compiles: `cd /home/claude/projects/relay && pnpm exec tsc --noEmit`
  </verify>
  <done>
LeaderboardTable is collapsible with proper ARIA attributes, expands for first 5 logins with auto-collapse, starts collapsed after 5th login.
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `pnpm exec tsc --noEmit` passes
2. Leaderboard shows collapsible header with chevron
3. First visit: leaderboard expanded, collapses after 5 seconds
4. After 5 sessions: leaderboard starts collapsed
5. Click header to toggle expand/collapse
6. aria-expanded attribute updates correctly
</verification>

<success_criteria>
- useLoginCount hook tracks sessions in localStorage
- Leaderboard has collapsible header with toggle button
- First 5 sessions: expanded with auto-collapse after 5 seconds
- After 5 sessions: starts collapsed
- aria-expanded and aria-controls properly implemented
</success_criteria>

<output>
After completion, create `.planning/phases/14-mobile-accessibility-polish/14-04-SUMMARY.md`
</output>
