---
phase: 30-branding-navigation
plan: 05
type: execute
wave: 3
depends_on: ["30-01", "30-02", "30-03", "30-04"]
files_modified:
  - apps/web/app/(protected)/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Layout header shows TenantBranding instead of plain text logo"
    - "Navigation uses NavLink components with active underline indicators"
    - "Skills nav link exists between Home and Analytics"
    - "HeaderStats (years saved sparkline) is removed from nav"
    - "GreetingArea shows user name, days saved, and contributor tier"
    - "getTotalStats import and call are removed"
  artifacts:
    - path: "apps/web/app/(protected)/layout.tsx"
      provides: "Updated layout integrating all new navigation components"
  key_links:
    - from: "apps/web/app/(protected)/layout.tsx"
      to: "apps/web/components/tenant-branding.tsx"
      via: "import TenantBranding"
      pattern: "TenantBranding"
    - from: "apps/web/app/(protected)/layout.tsx"
      to: "apps/web/components/nav-link.tsx"
      via: "import NavLink"
      pattern: "NavLink"
    - from: "apps/web/app/(protected)/layout.tsx"
      to: "apps/web/components/greeting-area.tsx"
      via: "import GreetingArea"
      pattern: "GreetingArea"
---

<objective>
Wire all new branding and navigation components into the protected layout.

Purpose: This integration plan connects AnimatedLogo (30-01), NavLink (30-02), GreetingArea (30-03), and TenantBranding (30-04) into the actual layout. Also removes HeaderStats (BRAND-06) and adds Skills nav link (BRAND-05).
Output: Updated `layout.tsx` with complete new navigation.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@apps/web/app/(protected)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite layout.tsx header with new components</name>
  <files>apps/web/app/(protected)/layout.tsx</files>
  <action>
Modify `apps/web/app/(protected)/layout.tsx`:

**REMOVE these imports:**
- `import { HeaderStats } from "@/components/header-stats";`
- `import { getTotalStats } from "@/lib/total-stats";`

**ADD these imports:**
- `import { TenantBranding } from "@/components/tenant-branding";`
- `import { NavLink } from "@/components/nav-link";`
- `import { GreetingArea } from "@/components/greeting-area";`

**REMOVE from function body:**
- `const { totalDaysSaved, trendData } = await getTotalStats();`

**Replace the LEFT side of the header** (logo + stats + nav) with:
```tsx
<div className="flex items-center gap-8">
  <TenantBranding />
  <nav className="hidden sm:flex sm:gap-6">
    <NavLink href="/">Home</NavLink>
    <NavLink href="/skills">Skills</NavLink>
    <NavLink href="/analytics">Analytics</NavLink>
    <NavLink href="/profile">Profile</NavLink>
    {isAdmin(user.email) && (
      <NavLink href="/admin/settings">Admin</NavLink>
    )}
  </nav>
</div>
```

Key changes:
- `<TenantBranding />` replaces the plain `<Link href="/">EverySkill</Link>` text.
- `<NavLink>` replaces all plain `<Link>` elements in the nav (BRAND-04 active indicator).
- Skills link added between Home and Analytics (BRAND-05).
- `<HeaderStats>` JSX removed entirely (BRAND-06).
- `getTotalStats()` call removed (no longer needed).

**Replace the RIGHT side of the header** (user menu) with:
```tsx
<div className="flex items-center gap-4">
  <GreetingArea userId={user.id!} userName={user.name || "User"} />
  <Link href="/profile" className="flex items-center transition hover:opacity-80">
    {user.image ? (
      <Image
        src={user.image}
        alt={user.name || "User avatar"}
        width={32}
        height={32}
        className="rounded-full"
      />
    ) : (
      <div className="flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 text-sm font-medium text-gray-600">
        {user.name?.charAt(0) || user.email?.charAt(0) || "?"}
      </div>
    )}
  </Link>
  <SignOutButton />
</div>
```

Key changes:
- `<GreetingArea>` added before the avatar, showing name + days + tier (BRAND-07).
- Removed the separate `<span>` with user name next to avatar (now in GreetingArea).
- Avatar link simplified (no text, just image).

Keep the Link and Image imports (still used for avatar). Keep `isAdmin` import and `auth()` call.
  </action>
  <verify>
Run `cd /home/dev/projects/relay && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | head -20` to confirm no type errors.
Run `cd /home/dev/projects/relay/apps/web && npx playwright test tests/e2e/ --timeout 30000 2>&1 | tail -30` to verify pages load without errors.
  </verify>
  <done>
Layout header displays: TenantBranding (left), NavLinks with active indicators including Skills (center), GreetingArea + avatar + sign out (right). HeaderStats and getTotalStats are fully removed. No "2.7Y saved" display remains.
  </done>
</task>

</tasks>

<verification>
- Layout imports TenantBranding, NavLink, GreetingArea (no HeaderStats, no getTotalStats).
- Nav contains exactly: Home, Skills, Analytics, Profile, Admin (conditional).
- GreetingArea receives userId and userName props from session.
- TypeScript compiles. Playwright tests pass.
</verification>

<success_criteria>
The navigation bar shows tenant-aware branding, active page indicators, a Skills link, and a personalized greeting area with contributor tier. The years-saved sparkline is gone.
</success_criteria>

<output>
After completion, create `.planning/phases/30-branding-navigation/30-05-SUMMARY.md`
</output>
