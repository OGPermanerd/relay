---
phase: 23-analytics-dashboard
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/package.json
  - apps/web/components/usage-area-chart.tsx
  - apps/web/components/time-range-selector.tsx
autonomous: true

must_haves:
  truths:
    - "Recharts ^3.7.0 is installed as a dependency"
    - "Area chart renders time-series data with responsive sizing"
    - "Time range selector shows 7d/30d/90d/1y buttons with URL persistence"
  artifacts:
    - path: "apps/web/components/usage-area-chart.tsx"
      provides: "Recharts AreaChart wrapper for usage trends"
      min_lines: 30
    - path: "apps/web/components/time-range-selector.tsx"
      provides: "Time range button group with nuqs state"
      min_lines: 20
  key_links:
    - from: "apps/web/components/time-range-selector.tsx"
      to: "nuqs"
      via: "useQueryState for URL persistence"
      pattern: "useQueryState.*range"
---

<objective>
Install Recharts and create the area chart and time range selector components.

Purpose: Provide the charting infrastructure for usage trend visualization and time filtering UI.
Output: Recharts installed, UsageAreaChart and TimeRangeSelector components created
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@apps/web/components/home-tabs.tsx (pattern: nuqs URL state)
@apps/web/components/stat-card.tsx (pattern: Tailwind styling)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts and create UsageAreaChart component</name>
  <files>apps/web/package.json, apps/web/components/usage-area-chart.tsx</files>
  <action>
1. Install Recharts:
   ```bash
   cd apps/web && pnpm add recharts
   ```

2. Create `apps/web/components/usage-area-chart.tsx`:

```typescript
"use client";

import {
  AreaChart,
  Area,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
} from "recharts";

interface UsageDataPoint {
  date: string;  // ISO date string
  hoursSaved: number;
}

interface UsageAreaChartProps {
  data: UsageDataPoint[];
  height?: number;
}

export function UsageAreaChart({ data, height = 300 }: UsageAreaChartProps) {
  if (data.length === 0) {
    return (
      <div className="flex h-[300px] items-center justify-center rounded-lg border border-dashed border-gray-300 bg-gray-50">
        <p className="text-sm text-gray-500">No usage data for this period</p>
      </div>
    );
  }

  return (
    <div style={{ height }} className="w-full">
      <ResponsiveContainer width="100%" height="100%">
        <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
          <CartesianGrid strokeDasharray="3 3" className="stroke-gray-200" />
          <XAxis
            dataKey="date"
            tick={{ fontSize: 12 }}
            tickFormatter={(date: string) =>
              new Date(date).toLocaleDateString("en-US", { month: "short", day: "numeric" })
            }
          />
          <YAxis
            tick={{ fontSize: 12 }}
            tickFormatter={(value: number) => value.toFixed(0)}
          />
          <Tooltip
            labelFormatter={(date: string) => new Date(date).toLocaleDateString()}
            formatter={(value: number) => [value.toFixed(1) + " hours", "Hours Saved"]}
            contentStyle={{ borderRadius: "0.5rem", border: "1px solid #e5e7eb" }}
          />
          <Area
            type="monotone"
            dataKey="hoursSaved"
            stroke="#3b82f6"
            fill="#3b82f6"
            fillOpacity={0.1}
            strokeWidth={2}
          />
        </AreaChart>
      </ResponsiveContainer>
    </div>
  );
}
```

Key implementation details:
- "use client" directive required for Recharts
- ResponsiveContainer for fluid width
- Empty state with dashed border (matches codebase pattern)
- Blue color (#3b82f6) matches existing Tailwind blue-500
- Date formatting in XAxis tickFormatter and Tooltip labelFormatter
  </action>
  <verify>
    - `cd apps/web && pnpm list recharts` shows recharts installed
    - `cd apps/web && npx tsc --noEmit` passes
  </verify>
  <done>
    - recharts is in package.json dependencies
    - UsageAreaChart component renders area chart with data prop
    - Empty state displays when data is empty
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TimeRangeSelector component with nuqs</name>
  <files>apps/web/components/time-range-selector.tsx</files>
  <action>
Create `apps/web/components/time-range-selector.tsx`:

```typescript
"use client";

import { useQueryState, parseAsStringLiteral } from "nuqs";

const RANGES = ["7d", "30d", "90d", "1y"] as const;
export type TimeRange = (typeof RANGES)[number];

const RANGE_LABELS: Record<TimeRange, string> = {
  "7d": "7 days",
  "30d": "30 days",
  "90d": "90 days",
  "1y": "1 year",
};

interface TimeRangeSelectorProps {
  className?: string;
}

export function TimeRangeSelector({ className = "" }: TimeRangeSelectorProps) {
  const [range, setRange] = useQueryState(
    "range",
    parseAsStringLiteral(RANGES).withDefault("30d")
  );

  return (
    <div className={`inline-flex rounded-md shadow-sm ${className}`} role="group">
      {RANGES.map((r) => (
        <button
          key={r}
          type="button"
          onClick={() => setRange(r)}
          className={`px-4 py-2 text-sm font-medium transition-colors first:rounded-l-md last:rounded-r-md
            ${
              range === r
                ? "bg-blue-600 text-white"
                : "bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"
            }
            ${range !== r ? "border-l-0 first:border-l" : ""}
          `}
        >
          {RANGE_LABELS[r]}
        </button>
      ))}
    </div>
  );
}

/**
 * Hook to get current time range from URL state
 * For use in Server Components that need to read the range
 */
export function useTimeRange() {
  const [range] = useQueryState(
    "range",
    parseAsStringLiteral(RANGES).withDefault("30d")
  );
  return range as TimeRange;
}
```

Key implementation details:
- Uses nuqs parseAsStringLiteral for type-safe URL state
- Default to "30d" per CONTEXT.md decisions
- Button group styling with proper border handling
- Export both component and hook for flexibility
  </action>
  <verify>
    - `cd apps/web && npx tsc --noEmit` passes
    - TimeRangeSelector and useTimeRange are exported
  </verify>
  <done>
    - TimeRangeSelector shows 4 buttons (7d, 30d, 90d, 1y)
    - Selected range persists in URL as ?range=30d
    - Default is 30d per user decision
  </done>
</task>

</tasks>

<verification>
- recharts is installed in apps/web/package.json
- Both components compile without TypeScript errors
- Components are marked "use client"
</verification>

<success_criteria>
- Recharts installed
- UsageAreaChart renders responsive area chart with empty state
- TimeRangeSelector persists range in URL via nuqs
</success_criteria>

<output>
After completion, create `.planning/phases/23-analytics-dashboard/23-02-SUMMARY.md`
</output>
