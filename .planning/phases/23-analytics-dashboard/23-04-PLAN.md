---
phase: 23-analytics-dashboard
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/skills-tab.tsx
  - apps/web/components/skill-analytics-modal.tsx
autonomous: true

must_haves:
  truths:
    - "Skills tab shows leaderboard cards with rank indicators"
    - "Cards display usage count, unique users, and hours saved"
    - "Clicking skill card opens analytics modal"
    - "Modal shows which employees use the skill"
  artifacts:
    - path: "apps/web/components/skills-tab.tsx"
      provides: "Skills leaderboard with clickable cards"
      min_lines: 40
    - path: "apps/web/components/skill-analytics-modal.tsx"
      provides: "Skill drill-down view with employee breakdown"
      min_lines: 40
  key_links:
    - from: "apps/web/components/skills-tab.tsx"
      to: "apps/web/components/skill-analytics-modal.tsx"
      via: "onClick opens modal"
      pattern: "setSelectedSkill"
---

<objective>
Create the Skills tab with leaderboard cards and drill-down analytics modal.

Purpose: Display top skills by usage with employee breakdown for each skill.
Output: SkillsTab component with leaderboard and SkillAnalyticsModal for drill-down
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@apps/web/components/stat-card.tsx (pattern: card styling)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SkillsTab leaderboard component</name>
  <files>apps/web/components/skills-tab.tsx</files>
  <action>
Create `apps/web/components/skills-tab.tsx`:

```typescript
"use client";

import { useState } from "react";
import Link from "next/link";
import { SkillAnalyticsModal } from "./skill-analytics-modal";

interface EmployeeBreakdown {
  userId: string;
  userName: string | null;
  usageCount: number;
}

interface SkillRow {
  skillId: string;
  name: string;
  category: string;
  authorName: string | null;
  usageCount: number;
  uniqueUsers: number;
  hoursSaved: number;
  employeeBreakdown: EmployeeBreakdown[];
}

interface SkillsTabProps {
  data: SkillRow[];
}

// Rank badge colors: gold, silver, bronze, then muted
const RANK_COLORS = [
  "bg-yellow-100 text-yellow-800 border-yellow-300",
  "bg-gray-100 text-gray-600 border-gray-300",
  "bg-orange-100 text-orange-700 border-orange-300",
];

export function SkillsTab({ data }: SkillsTabProps) {
  const [selectedSkill, setSelectedSkill] = useState<SkillRow | null>(null);

  if (data.length === 0) {
    return (
      <div className="flex h-64 items-center justify-center rounded-lg border border-dashed border-gray-300 bg-gray-50">
        <p className="text-sm text-gray-500">No skill usage data for this period</p>
      </div>
    );
  }

  // Data is already sorted by usage count from the query
  return (
    <>
      <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {data.map((skill, index) => (
          <div
            key={skill.skillId}
            onClick={() => setSelectedSkill(skill)}
            className="relative cursor-pointer rounded-lg border border-gray-200 bg-white p-4 shadow-sm transition-shadow hover:shadow-md"
          >
            {/* Rank badge */}
            <div
              className={`absolute -top-2 -left-2 flex h-8 w-8 items-center justify-center rounded-full border text-sm font-bold ${
                index < 3 ? RANK_COLORS[index] : "bg-gray-50 text-gray-400 border-gray-200"
              }`}
            >
              {index + 1}
            </div>

            {/* Skill info */}
            <div className="ml-4">
              <Link
                href={`/skills/${skill.skillId}`}
                onClick={(e) => e.stopPropagation()}
                className="font-semibold text-gray-900 hover:text-blue-600"
              >
                {skill.name}
              </Link>
              <p className="text-sm text-gray-500">{skill.category}</p>
              {skill.authorName && (
                <p className="text-xs text-gray-400">by {skill.authorName}</p>
              )}
            </div>

            {/* Stats row */}
            <div className="mt-4 grid grid-cols-3 gap-2 text-center">
              <div>
                <p className="text-lg font-bold text-gray-900">{skill.usageCount}</p>
                <p className="text-xs text-gray-500">Uses</p>
              </div>
              <div>
                <p className="text-lg font-bold text-gray-900">{skill.uniqueUsers}</p>
                <p className="text-xs text-gray-500">Users</p>
              </div>
              <div>
                <p className="text-lg font-bold text-blue-600">{skill.hoursSaved.toFixed(1)}</p>
                <p className="text-xs text-gray-500">Hours</p>
              </div>
            </div>
          </div>
        ))}
      </div>

      {selectedSkill && (
        <SkillAnalyticsModal
          skill={selectedSkill}
          onClose={() => setSelectedSkill(null)}
        />
      )}
    </>
  );
}
```

Key implementation details:
- Leaderboard cards with rank badges (gold/silver/bronze for top 3)
- Grid layout: 3 columns on large screens, 2 on medium, 1 on small
- Skill name links to skill detail page (/skills/[slug])
- Click anywhere on card opens analytics modal
- Stats row shows usage count, unique users, hours saved
  </action>
  <verify>
    - `cd apps/web && npx tsc --noEmit` passes
    - SkillsTab is exported
  </verify>
  <done>
    - SkillsTab renders grid of skill cards
    - Top 3 have colored rank badges (gold, silver, bronze)
    - Each card shows usage stats
    - Clicking card opens analytics modal
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SkillAnalyticsModal with employee breakdown</name>
  <files>apps/web/components/skill-analytics-modal.tsx</files>
  <action>
Create `apps/web/components/skill-analytics-modal.tsx`:

```typescript
"use client";

import Link from "next/link";

interface EmployeeBreakdown {
  userId: string;
  userName: string | null;
  usageCount: number;
}

interface SkillRow {
  skillId: string;
  name: string;
  category: string;
  authorName: string | null;
  usageCount: number;
  uniqueUsers: number;
  hoursSaved: number;
  employeeBreakdown: EmployeeBreakdown[];
}

interface SkillAnalyticsModalProps {
  skill: SkillRow;
  onClose: () => void;
}

export function SkillAnalyticsModal({ skill, onClose }: SkillAnalyticsModalProps) {
  // Sort employees by usage count descending
  const sortedEmployees = [...skill.employeeBreakdown].sort((a, b) => b.usageCount - a.usageCount);

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      {/* Backdrop */}
      <div className="absolute inset-0 bg-black/50" onClick={onClose} />

      {/* Modal */}
      <div className="relative z-10 w-full max-w-lg max-h-[80vh] overflow-hidden rounded-lg bg-white shadow-xl flex flex-col">
        {/* Header */}
        <div className="flex items-start justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-lg font-semibold text-gray-900">{skill.name}</h2>
            <p className="text-sm text-gray-500">{skill.category}</p>
            {skill.authorName && (
              <p className="text-xs text-gray-400">by {skill.authorName}</p>
            )}
          </div>
          <button
            type="button"
            onClick={onClose}
            className="rounded-md p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600"
          >
            <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        {/* Stats Row */}
        <div className="grid grid-cols-3 gap-4 p-6 bg-gray-50">
          <div className="text-center">
            <p className="text-2xl font-bold text-gray-900">{skill.usageCount}</p>
            <p className="text-sm text-gray-500">Total Uses</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-gray-900">{skill.uniqueUsers}</p>
            <p className="text-sm text-gray-500">Unique Users</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-bold text-blue-600">{skill.hoursSaved.toFixed(1)}</p>
            <p className="text-sm text-gray-500">Hours Saved</p>
          </div>
        </div>

        {/* Employee Breakdown */}
        <div className="flex-1 overflow-y-auto p-6">
          <h3 className="text-sm font-medium text-gray-500 mb-3">Who Uses This Skill</h3>
          {sortedEmployees.length === 0 ? (
            <p className="text-sm text-gray-400">No usage data available</p>
          ) : (
            <div className="space-y-2">
              {sortedEmployees.map((emp, index) => (
                <div
                  key={emp.userId}
                  className="flex items-center justify-between rounded-lg border border-gray-200 bg-white p-3"
                >
                  <div className="flex items-center gap-3">
                    <span className={`w-6 text-center text-sm font-medium ${
                      index < 3 ? "text-blue-600" : "text-gray-400"
                    }`}>
                      {index + 1}
                    </span>
                    <Link
                      href={`/users/${emp.userId}`}
                      className="text-sm font-medium text-gray-900 hover:text-blue-600"
                    >
                      {emp.userName || "Unknown User"}
                    </Link>
                  </div>
                  <div className="text-right">
                    <span className="text-sm font-bold text-gray-900">{emp.usageCount}</span>
                    <span className="text-xs text-gray-500 ml-1">uses</span>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Footer */}
        <div className="flex justify-end gap-3 p-6 border-t border-gray-200">
          <button
            type="button"
            onClick={onClose}
            className="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-md"
          >
            Close
          </button>
          <Link
            href={`/skills/${skill.skillId}`}
            className="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md"
          >
            View Skill
          </Link>
        </div>
      </div>
    </div>
  );
}
```

Key implementation details:
- Modal header shows skill name, category, author
- Stats row with usage count, unique users, hours saved (blue highlight)
- Scrollable employee breakdown list, sorted by usage count
- Top 3 users have blue rank numbers
- Employee names link to their profile pages
- "View Skill" button links to skill detail page
  </action>
  <verify>
    - `cd apps/web && npx tsc --noEmit` passes
    - SkillAnalyticsModal is exported
  </verify>
  <done>
    - Modal displays skill details and stats
    - Employee breakdown shows who uses the skill, sorted by usage
    - User names link to /users/[id]
    - "View Skill" links to /skills/[skillId]
  </done>
</task>

</tasks>

<verification>
- Both components compile without TypeScript errors
- Cards show rank badges with appropriate colors
- Modal scrolls when employee list is long
</verification>

<success_criteria>
- SkillsTab renders leaderboard cards in responsive grid
- Top 3 skills have gold/silver/bronze rank badges
- SkillAnalyticsModal shows employee breakdown
- Links to user profiles and skill detail pages work
</success_criteria>

<output>
After completion, create `.planning/phases/23-analytics-dashboard/23-04-SUMMARY.md`
</output>
