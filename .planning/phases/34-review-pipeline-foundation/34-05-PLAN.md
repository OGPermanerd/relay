---
phase: 34-review-pipeline-foundation
plan: 05
type: execute
wave: 3
depends_on: ["34-02", "34-03", "34-04"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Creating a skill via web puts it in draft status"
    - "Draft skills do not appear in search or browse"
    - "Existing published skills still appear in search"
    - "Non-author sees 404 for draft skill"
    - "My Skills page shows status badges"
    - "Submit for Review transitions draft to pending_review"
  artifacts: []
  key_links: []
---

<objective>
End-to-end verification of the entire review pipeline foundation. Build all packages and run Playwright tests.

Purpose: Catch any integration issues across the 12+ modified files before marking phase complete.
Output: Verified working system with all requirements satisfied.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Full build and integration verification</name>
  <files></files>
  <action>
1. Kill any running dev server: `pkill -f "next-server" 2>/dev/null; pkill -9 node 2>/dev/null`

2. Full build of all packages:
   ```bash
   cd /home/dev/projects/relay && pnpm build
   ```
   If any build errors, fix them.

3. Verify migration state:
   ```bash
   psql "$DATABASE_URL" -c "SELECT column_name, data_type, column_default, is_nullable FROM information_schema.columns WHERE table_name = 'skills' AND column_name = 'status';"
   ```
   Expected: TEXT, DEFAULT 'published', NOT NULL.

4. Verify existing data integrity:
   ```bash
   psql "$DATABASE_URL" -c "SELECT status, count(*) FROM skills GROUP BY status;"
   ```
   Expected: All rows are 'published' (no regressions).

5. Verify indexes exist:
   ```bash
   psql "$DATABASE_URL" -c "SELECT indexname FROM pg_indexes WHERE tablename = 'skills' AND indexname LIKE '%status%';"
   ```
   Expected: skills_status_idx, skills_author_status_idx.

6. Start dev server and run Playwright tests to verify pages load:
   ```bash
   cd /home/dev/projects/relay/apps/web && npm run dev &
   sleep 5
   cd /home/dev/projects/relay/apps/web && npx playwright test
   ```
   All existing E2E tests should pass (existing published skills still visible, pages load).

7. If any tests fail due to new status-related issues, fix the root cause.
  </action>
  <verify>
- `pnpm build` succeeds across all packages
- All existing skills have status='published'
- Playwright E2E tests pass
- No regression in skill visibility
  </verify>
  <done>Full build passes, migration verified, existing skills untouched, E2E tests green.</done>
</task>

</tasks>

<verification>
- pnpm build succeeds for all packages (db, web, mcp)
- Migration verified: status column exists, all existing rows are 'published'
- Indexes exist: skills_status_idx, skills_author_status_idx
- Playwright E2E tests pass with no regressions
</verification>

<success_criteria>
Phase 34 success criteria verified:
1. Creating a skill puts it in `draft` status (code review of all 4 creation paths)
2. Author can submit draft for review, state machine enforces transitions (submit-for-review action)
3. All existing published skills retain `published` status (migration verification query)
4. Non-author/non-admin sees 404 for unpublished skills (access control in skill detail page)
5. Authors can view all their skills on My Skills page with status badges
</success_criteria>

<output>
After completion, create `.planning/phases/34-review-pipeline-foundation/34-05-SUMMARY.md`
</output>
