---
phase: 34-review-pipeline-foundation
plan: 02
type: execute
wave: 2
depends_on: ["34-01"]
files_modified:
  - apps/web/app/actions/skills.ts
  - apps/web/app/actions/fork-skill.ts
  - apps/mcp/src/tools/create.ts
autonomous: true

must_haves:
  truths:
    - "Skills created via web UI have status='draft'"
    - "Skills created via MCP have status='draft'"
    - "Forked skills have status='draft'"
    - "No creation path relies on column DEFAULT for new skills"
  artifacts:
    - path: "apps/web/app/actions/skills.ts"
      provides: "checkAndCreateSkill and createSkill set status='draft'"
      contains: "status: \"draft\""
    - path: "apps/web/app/actions/fork-skill.ts"
      provides: "forkSkill sets status='draft'"
      contains: "status: \"draft\""
    - path: "apps/mcp/src/tools/create.ts"
      provides: "MCP handleCreateSkill sets status='draft' in raw SQL INSERT"
      contains: "'draft'"
  key_links:
    - from: "apps/web/app/actions/skills.ts"
      to: "packages/db/src/schema/skills.ts"
      via: "Drizzle insert with explicit status"
      pattern: "status.*draft"
    - from: "apps/mcp/src/tools/create.ts"
      to: "skills table"
      via: "Raw SQL INSERT with status column"
      pattern: "status.*draft"
---

<objective>
Make all 4 skill creation paths explicitly set status='draft' so new skills are invisible until reviewed.

Purpose: RVPL-01 and RVPL-07 -- new skills must not auto-publish. The column DEFAULT is 'published' (for migration safety), so every INSERT must explicitly override it.
Output: All creation paths produce draft skills.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set status='draft' on all web and MCP creation paths</name>
  <files>
    apps/web/app/actions/skills.ts
    apps/web/app/actions/fork-skill.ts
    apps/mcp/src/tools/create.ts
  </files>
  <action>
**apps/web/app/actions/skills.ts** -- TWO insert locations:

1. In `checkAndCreateSkill()` (~line 216), add `status: "draft"` to the `.values({...})` object:
   ```typescript
   .values({
     tenantId: DEFAULT_TENANT_ID,
     name,
     slug,
     description,
     category,
     content: rawContent,
     hoursSaved,
     authorId: session.user.id,
     forkedFromId: variationOf || undefined,
     status: "draft",  // <-- ADD THIS
   })
   ```

2. In `createSkill()` (~line 398), add `status: "draft"` to the `.values({...})` object the same way.

3. After both creation functions, change the redirect from `/skills/${newSkill.slug}` to `/my-skills` since the skill is now a draft and the detail page would 404 for non-authors until access control is added in plan 04. Actually -- keep redirect to `/skills/${newSkill.slug}` because plan 04 will add access control that allows authors to view their own drafts. The redirect happens in the same request where the author just created it, so they will be the author.

**apps/web/app/actions/fork-skill.ts**:

4. In `forkSkill()` (~line 61), add `status: "draft"` to the `.values({...})` object.

**apps/mcp/src/tools/create.ts**:

5. In `handleCreateSkill()` (~line 146), the raw SQL INSERT must include status:
   Change the INSERT from:
   ```sql
   INSERT INTO skills (id, tenant_id, name, slug, description, category, content, hours_saved, author_id, tags)
   VALUES (...)
   ```
   To:
   ```sql
   INSERT INTO skills (id, tenant_id, name, slug, description, category, content, hours_saved, author_id, tags, status)
   VALUES (..., 'draft')
   ```
   Add `status` to the column list and `'draft'` to the VALUES.

6. Update the response message in MCP create.ts (~line 223-225) from:
   `Skill "${name}" created and published!`
   To:
   `Skill "${name}" created as a draft. It will be visible after review and approval.`
   Keep the local savedTo path in the message if applicable.
  </action>
  <verify>
Run `cd /home/dev/projects/relay && pnpm build --filter web && pnpm build --filter mcp` -- both should compile.
Grep to confirm: `grep -n "status.*draft" apps/web/app/actions/skills.ts apps/web/app/actions/fork-skill.ts apps/mcp/src/tools/create.ts` -- should show hits in all 3 files.
  </verify>
  <done>All 4 creation paths (checkAndCreateSkill, createSkill, forkSkill, MCP handleCreateSkill) explicitly set status='draft'. MCP response message updated.</done>
</task>

</tasks>

<verification>
- `grep -rn "status.*draft" apps/web/app/actions/skills.ts apps/web/app/actions/fork-skill.ts apps/mcp/src/tools/create.ts` shows matches in all files
- `pnpm build --filter web` passes
- `pnpm build --filter mcp` passes
</verification>

<success_criteria>
- Every skill INSERT (web checkAndCreateSkill, web createSkill, web forkSkill, MCP handleCreateSkill) includes status='draft'
- MCP create response says "created as a draft" not "created and published"
- Both apps compile cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/34-review-pipeline-foundation/34-02-SUMMARY.md`
</output>
