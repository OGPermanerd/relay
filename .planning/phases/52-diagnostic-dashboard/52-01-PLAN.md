---
phase: 52-diagnostic-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/category-pie-chart.tsx
  - apps/web/components/time-bar-chart.tsx
autonomous: true

must_haves:
  truths:
    - "Category distribution visible as pie chart with percentages"
    - "Time-per-category visible as horizontal bar chart with hours/week"
  artifacts:
    - path: "apps/web/components/category-pie-chart.tsx"
      provides: "PieChart for email category distribution"
      min_lines: 60
    - path: "apps/web/components/time-bar-chart.tsx"
      provides: "BarChart for time-per-category visualization"
      min_lines: 60
  key_links:
    - from: "category-pie-chart.tsx"
      to: "CategoryBreakdownItem type"
      via: "import from @everyskill/db"
      pattern: "@everyskill/db/services/email-diagnostics"
    - from: "time-bar-chart.tsx"
      to: "CategoryBreakdownItem type"
      via: "import from @everyskill/db"
      pattern: "@everyskill/db/services/email-diagnostics"
---

<objective>
Create reusable Recharts components for visualizing email diagnostic data.

Purpose: Transform aggregate diagnostic statistics into visual charts following established patterns from usage-area-chart.tsx
Output: Two client chart components (PieChart for category distribution, BarChart for time breakdown)
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/components/usage-area-chart.tsx
@packages/db/src/services/email-diagnostics.ts
</context>

<tasks>

<task type="auto">
  <name>Create category pie chart component</name>
  <files>apps/web/components/category-pie-chart.tsx</files>
  <action>
Create a client component that renders a Recharts PieChart showing email category distribution.

**Structure:**
- "use client" directive
- Accept `data: CategoryBreakdownItem[]` prop (import from @everyskill/db/services/email-diagnostics)
- Use Recharts PieChart, Pie, Cell, Tooltip, ResponsiveContainer, Legend
- Wrap in ResponsiveContainer with explicit height parent: `<div className="h-[300px] w-full">`

**Category colors:**
```typescript
const CATEGORY_COLORS: Record<string, string> = {
  "newsletter": "#3b82f6",           // blue
  "automated-notification": "#10b981", // green
  "meeting-invite": "#f59e0b",       // amber
  "direct-message": "#8b5cf6",       // purple
  "internal-thread": "#ef4444",      // red
  "vendor-external": "#06b6d4",      // cyan
  "support-ticket": "#ec4899",       // pink
};
```

**Chart config:**
- dataKey: "count" (matches CategoryBreakdownItem.count)
- nameKey: "category"
- Label: `${category}: ${percentage}%`
- Tooltip: rounded border (#e5e7eb), show count and category
- Legend: default positioning

**Empty state:** Empty data array shows centered "No category data" message in h-[300px] container

**Pattern reference:** Follow usage-area-chart.tsx structure (ResponsiveContainer, CartesianGrid, Tooltip styling)
  </action>
  <verify>
Check file exists and has "use client" directive:
```bash
head -1 apps/web/components/category-pie-chart.tsx
```

Verify imports include PieChart from recharts:
```bash
grep "from \"recharts\"" apps/web/components/category-pie-chart.tsx
```
  </verify>
  <done>category-pie-chart.tsx exists with PieChart rendering CategoryBreakdownItem[] data with category-specific colors and empty state handling</done>
</task>

<task type="auto">
  <name>Create time bar chart component</name>
  <files>apps/web/components/time-bar-chart.tsx</files>
  <action>
Create a client component that renders a Recharts horizontal BarChart showing hours per week per category.

**Structure:**
- "use client" directive
- Accept `data: CategoryBreakdownItem[]` prop (import from @everyskill/db/services/email-diagnostics)
- Use Recharts BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer
- Wrap in ResponsiveContainer with explicit height parent: `<div className="h-[400px] w-full">`

**Data transformation:**
Convert CategoryBreakdownItem to chart data:
```typescript
const chartData = data
  .map((item) => ({
    category: item.category.replace(/-/g, " "), // kebab-case to space-separated
    hoursPerWeek: Number(((item.estimatedMinutes / 60) * 7).toFixed(1)), // convert minutes to hours per week
  }))
  .sort((a, b) => b.hoursPerWeek - a.hoursPerWeek); // sort descending
```

**Chart config:**
- layout: "horizontal" (horizontal bars)
- YAxis: type="category", dataKey="category", width=90, fontSize 12
- XAxis: type="number", fontSize 12
- Bar: dataKey="hoursPerWeek", fill="#3b82f6"
- Tooltip: formatter shows `${value} hrs/week`, rounded border (#e5e7eb)
- CartesianGrid: strokeDasharray="3 3", stroke-gray-200

**Empty state:** Empty data array shows centered "No time data" message in h-[300px] container

**Pattern reference:** Follow usage-area-chart.tsx structure for ResponsiveContainer, CartesianGrid, Tooltip styling
  </action>
  <verify>
Check file exists and has "use client" directive:
```bash
head -1 apps/web/components/time-bar-chart.tsx
```

Verify imports include BarChart from recharts:
```bash
grep "from \"recharts\"" apps/web/components/time-bar-chart.tsx
```

Check data transformation logic converts minutes to hours:
```bash
grep "estimatedMinutes / 60" apps/web/components/time-bar-chart.tsx
```
  </verify>
  <done>time-bar-chart.tsx exists with horizontal BarChart converting CategoryBreakdownItem estimatedMinutes to hours/week, sorted descending, with empty state handling</done>
</task>

</tasks>

<verification>
Both chart components follow established Recharts patterns from usage-area-chart.tsx with:
- "use client" directive
- ResponsiveContainer with explicit height parent
- Empty state handling
- Tailwind styling
- TypeScript props matching CategoryBreakdownItem
</verification>

<success_criteria>
- category-pie-chart.tsx renders PieChart with 7 category colors and percentage labels
- time-bar-chart.tsx renders horizontal BarChart showing hours/week per category
- Both charts accept CategoryBreakdownItem[] and handle empty data gracefully
- No build errors, components ready for dashboard integration in next plan
</success_criteria>

<output>
After completion, create `.planning/phases/52-diagnostic-dashboard/52-01-SUMMARY.md`
</output>
