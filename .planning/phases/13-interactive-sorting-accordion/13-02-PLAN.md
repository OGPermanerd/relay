---
phase: 13-interactive-sorting-accordion
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/hooks/use-expanded-rows.ts
  - apps/web/hooks/use-clipboard-copy.ts
  - apps/web/lib/mcp-config.ts
  - apps/web/components/install-button.tsx
  - apps/web/components/skill-accordion-content.tsx
autonomous: true

must_haves:
  truths:
    - "useExpandedRows tracks multiple expanded rows simultaneously"
    - "useClipboardCopy provides copy function with 2-second feedback"
    - "InstallButton shows 'Copied!' for 2 seconds after click"
    - "SkillAccordionContent displays skill details in preview card style"
  artifacts:
    - path: "apps/web/hooks/use-expanded-rows.ts"
      provides: "Hook for tracking expanded row IDs"
      exports: ["useExpandedRows"]
    - path: "apps/web/hooks/use-clipboard-copy.ts"
      provides: "Hook for clipboard copy with feedback"
      exports: ["useClipboardCopy"]
    - path: "apps/web/lib/mcp-config.ts"
      provides: "MCP config JSON generator"
      exports: ["generateMcpConfig"]
    - path: "apps/web/components/install-button.tsx"
      provides: "Install button with copy feedback"
      exports: ["InstallButton"]
    - path: "apps/web/components/skill-accordion-content.tsx"
      provides: "Accordion row content with skill details"
      exports: ["SkillAccordionContent"]
  key_links:
    - from: "apps/web/components/install-button.tsx"
      to: "apps/web/hooks/use-clipboard-copy.ts"
      via: "hook consumption"
      pattern: "useClipboardCopy|copyToClipboard"
    - from: "apps/web/components/skill-accordion-content.tsx"
      to: "apps/web/components/install-button.tsx"
      via: "component import"
      pattern: "import.*InstallButton"
---

<objective>
Create accordion and install infrastructure: row expansion hooks, clipboard functionality, and accordion content component

Purpose: Enable expandable rows with skill details and one-click MCP config installation (TABL-06, TABL-07, TABL-08)
Output: Reusable hooks and components ready for SkillsTable integration
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-interactive-sorting-accordion/13-CONTEXT.md
@.planning/phases/13-interactive-sorting-accordion/13-RESEARCH.md
@apps/web/components/skill-card.tsx (styling reference)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create expansion and clipboard hooks</name>
  <files>apps/web/hooks/use-expanded-rows.ts, apps/web/hooks/use-clipboard-copy.ts, apps/web/lib/mcp-config.ts</files>
  <action>
Create three files for expansion and clipboard functionality.

**apps/web/hooks/use-expanded-rows.ts:**
```typescript
"use client";

import { useState, useCallback } from "react";

export function useExpandedRows() {
  const [expandedIds, setExpandedIds] = useState<Set<string>>(new Set());

  const toggleRow = useCallback((skillId: string) => {
    setExpandedIds((prev) => {
      const next = new Set(prev);
      if (next.has(skillId)) {
        next.delete(skillId);
      } else {
        next.add(skillId);
      }
      return next;
    });
  }, []);

  const isExpanded = useCallback(
    (skillId: string) => expandedIds.has(skillId),
    [expandedIds]
  );

  return { toggleRow, isExpanded };
}
```

**apps/web/hooks/use-clipboard-copy.ts:**
```typescript
"use client";

import { useState, useCallback } from "react";

export function useClipboardCopy() {
  const [copiedId, setCopiedId] = useState<string | null>(null);

  const copyToClipboard = useCallback(async (id: string, text: string) => {
    try {
      await navigator.clipboard.writeText(text);
      setCopiedId(id);
      setTimeout(() => setCopiedId(null), 2000);
      return true;
    } catch (err) {
      console.error("Failed to copy:", err);
      return false;
    }
  }, []);

  const isCopied = useCallback(
    (id: string) => copiedId === id,
    [copiedId]
  );

  return { copyToClipboard, isCopied };
}
```

**apps/web/lib/mcp-config.ts:**
```typescript
/**
 * Generate MCP config JSON for a skill
 * Format matches claude_desktop_config.json structure
 */
export function generateMcpConfig(skill: { name: string; slug: string }): string {
  const config = {
    mcpServers: {
      [skill.slug]: {
        command: "npx",
        args: ["-y", `@anthropic-ai/relay-${skill.slug}`],
      },
    },
  };
  return JSON.stringify(config, null, 2);
}
```

Note: Package name uses @anthropic-ai/relay-{slug} format (placeholder - actual publishing details may vary).
  </action>
  <verify>
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- All three files exist with expected exports
  </verify>
  <done>
- useExpandedRows hook tracks Set of expanded skill IDs
- useClipboardCopy hook provides copyToClipboard with 2-second feedback
- generateMcpConfig produces valid JSON matching claude_desktop_config format
  </done>
</task>

<task type="auto">
  <name>Task 2: Create InstallButton component</name>
  <files>apps/web/components/install-button.tsx</files>
  <action>
Create install button with two variants: full button and icon-only.

**Component interface:**
```typescript
interface InstallButtonProps {
  skillId: string;
  skillName: string;
  skillSlug: string;
  isCopied: boolean;
  onCopy: () => void;
  variant?: "full" | "icon";
}
```

**Implementation details:**
- "full" variant: Rounded button with text "Install" / "Copied!"
  - Default: bg-blue-600 text-white hover:bg-blue-700
  - Copied: bg-green-100 text-green-800
- "icon" variant: Download arrow icon, compact for table row
  - Use e.stopPropagation() to prevent row expansion when clicking
  - Default: text-gray-400 hover:text-blue-600
  - Copied: checkmark icon in text-green-600

**SVG icons (Heroicons stroke style):**
- Download arrow: `<path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />`
- Checkmark: `<path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" />`

**From CONTEXT.md:**
- "Row-level quick install uses download arrow icon"
- "Button text changes to 'Copied!' for 2 seconds, then reverts to 'Install'"
  </action>
  <verify>
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- Component exported: grep for "export.*InstallButton"
- Both variants implemented (full/icon)
  </verify>
  <done>
- InstallButton component with full and icon variants
- Shows "Copied!" state for feedback
- Icon variant uses stopPropagation to prevent row expansion
  </done>
</task>

<task type="auto">
  <name>Task 3: Create SkillAccordionContent component</name>
  <files>apps/web/components/skill-accordion-content.tsx</files>
  <action>
Create the accordion content component using preview card style.

**Component interface:**
```typescript
interface SkillAccordionContentProps {
  skill: {
    id: string;
    name: string;
    slug: string;
    description: string;
    category: string;
    tags?: string[];
  };
  onInstall: () => void;
  isCopied: boolean;
}
```

**Layout (from CONTEXT.md - "preview card style"):**
- Renders as a `<tr>` with `<td colSpan={6}>` to span all columns
- Background: bg-blue-50 (subtle highlight for expanded state)
- Inner content: rounded-lg border border-blue-100 bg-white p-4

**Content structure:**
1. Category badge: text-xs font-medium uppercase text-blue-600
2. Description: text-sm text-gray-700 (handle empty: "No description provided.")
3. Tags (if present): flex-wrap gap-1, each tag in rounded-full bg-gray-100 px-2 py-0.5 text-xs
4. Install button: InstallButton variant="full" at bottom

**From CONTEXT.md:**
- "No animation - content appears instantly when row is clicked"
- "Expanded rows get subtle background highlight (e.g., blue-50)"
  </action>
  <verify>
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- Component exported: grep for "export.*SkillAccordionContent"
- Imports InstallButton component
  </verify>
  <done>
- SkillAccordionContent renders tr with colspan for full width
- Displays category, description, tags, and install button
- Blue-50 background for expanded state indicator
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `cd apps/web && npx tsc --noEmit` passes
2. All files exist with expected exports
3. hooks/use-expanded-rows.ts tracks Set<string> of IDs
4. hooks/use-clipboard-copy.ts provides 2-second feedback
5. lib/mcp-config.ts generates valid JSON
6. InstallButton has both full and icon variants
7. SkillAccordionContent uses preview card style with blue-50 background
</verification>

<success_criteria>
- Hooks provide expansion tracking and clipboard functionality
- InstallButton shows copy feedback and has icon variant for rows
- SkillAccordionContent displays skill details in card style
- All components ready for Plan 03 SkillsTable integration
</success_criteria>

<output>
After completion, create `.planning/phases/13-interactive-sorting-accordion/13-02-SUMMARY.md`
</output>
