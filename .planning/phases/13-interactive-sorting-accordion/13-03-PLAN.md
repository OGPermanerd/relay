---
phase: 13-interactive-sorting-accordion
plan: 03
type: execute
wave: 2
depends_on: ["13-01", "13-02"]
files_modified:
  - apps/web/components/skills-table.tsx
  - apps/web/components/skills-table-row.tsx
autonomous: true

must_haves:
  truths:
    - "User can click column header to sort ascending/descending"
    - "Active sort column shows chevron direction indicator"
    - "User can click row to expand accordion with skill details"
    - "Multiple rows can be expanded simultaneously"
    - "User can click Install button in expanded row to copy config"
    - "Sort state persists in URL (shareable links)"
  artifacts:
    - path: "apps/web/components/skills-table.tsx"
      provides: "Interactive skills table with sorting and accordion"
      exports: ["SkillsTable"]
      contains: "use client"
    - path: "apps/web/components/skills-table-row.tsx"
      provides: "Individual row with expand/collapse and install"
      exports: ["SkillsTableRow"]
  key_links:
    - from: "apps/web/components/skills-table.tsx"
      to: "apps/web/hooks/use-sort-state.ts"
      via: "hook import"
      pattern: "useSortState"
    - from: "apps/web/components/skills-table.tsx"
      to: "apps/web/components/sortable-column-header.tsx"
      via: "component import"
      pattern: "SortableColumnHeader"
    - from: "apps/web/components/skills-table-row.tsx"
      to: "apps/web/components/skill-accordion-content.tsx"
      via: "component import"
      pattern: "SkillAccordionContent"
    - from: "apps/web/components/skills-table-row.tsx"
      to: "apps/web/hooks/use-clipboard-copy.ts"
      via: "hook for install"
      pattern: "useClipboardCopy|generateMcpConfig"
---

<objective>
Convert SkillsTable to client component with interactive sorting and expandable accordion rows

Purpose: Deliver core table interactivity - sortable columns with URL persistence and expandable rows with install functionality (TABL-02, TABL-03, TABL-06, TABL-07, TABL-08, TABL-09)
Output: Fully interactive SkillsTable with sorting, row expansion, and one-click install
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-interactive-sorting-accordion/13-CONTEXT.md
@.planning/phases/13-interactive-sorting-accordion/13-RESEARCH.md
@.planning/phases/13-interactive-sorting-accordion/13-01-SUMMARY.md
@.planning/phases/13-interactive-sorting-accordion/13-02-SUMMARY.md
@apps/web/components/skills-table.tsx (current implementation)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SkillsTableRow component with accordion</name>
  <files>apps/web/components/skills-table-row.tsx</files>
  <action>
Create the individual row component that handles expansion and install.

**Component interface:**
```typescript
"use client";

interface SkillsTableRowProps {
  skill: SkillTableRow & {
    description: string;
    category: string;
    tags?: string[];
  };
  trend: number[];
  isExpanded: boolean;
  onToggle: () => void;
  isCopied: boolean;
  onInstall: () => void;
  rowIndex: number;
}
```

**Implementation details:**
- Render main data row with all 6 columns (same structure as current skills-table.tsx)
- Add cursor-pointer to row, onClick calls onToggle
- Skill name remains a Link to /skills/{slug}
- Add InstallButton variant="icon" as 7th column or at end of row
- After main row, conditionally render SkillAccordionContent when isExpanded

**Row styling:**
- Main row: Same alternating bg (white/gray-50) + hover:bg-blue-50
- When expanded: Add ring-1 ring-blue-200 or border highlight to indicate active state
- Cursor pointer on entire row

**Install button placement:**
- Add a 7th cell after Sparkline for quick install icon
- This matches CONTEXT.md: "quick icon on collapsed row + full button inside accordion"

**Import from Plan 02:**
- SkillAccordionContent from "./skill-accordion-content"
- InstallButton from "./install-button"

**IMPORTANT:**
- Don't import hooks here - receive all state/callbacks as props
- The parent SkillsTable will manage the hooks and pass down
  </action>
  <verify>
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- Component exported: grep for "export.*SkillsTableRow"
- Imports SkillAccordionContent and InstallButton
  </verify>
  <done>
- SkillsTableRow renders data row + optional accordion content
- Row is clickable to toggle expansion
- Quick install icon in row, full install button in accordion
- Accordion content appears below row when expanded
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert SkillsTable to client component with sorting</name>
  <files>apps/web/components/skills-table.tsx</files>
  <action>
Convert the existing Server Component to a Client Component with sorting and accordion.

**Changes to make:**

1. Add "use client" directive at top

2. Update imports:
```typescript
import { useSortState, SortColumn } from "@/hooks/use-sort-state";
import { useExpandedRows } from "@/hooks/use-expanded-rows";
import { useClipboardCopy } from "@/hooks/use-clipboard-copy";
import { generateMcpConfig } from "@/lib/mcp-config";
import { SortableColumnHeader } from "./sortable-column-header";
import { SkillsTableRow } from "./skills-table-row";
```

3. Update SkillsTableProps interface:
```typescript
export interface SkillTableRow {
  // existing fields...
  description: string;  // Add: needed for accordion
  category: string;     // Add: needed for accordion
  tags?: string[];      // Add: needed for accordion
}
```

4. Add sorting logic:
```typescript
const { sortBy, sortDir, toggleSort } = useSortState();
const { toggleRow, isExpanded } = useExpandedRows();
const { copyToClipboard, isCopied } = useClipboardCopy();

// Client-side sort
const sortedSkills = useMemo(() => {
  return [...skills].sort((a, b) => {
    let comparison = 0;
    switch (sortBy) {
      case "name":
        comparison = a.name.localeCompare(b.name);
        break;
      case "days_saved":
        const aDays = (a.totalUses * (a.hoursSaved ?? 1)) / 8;
        const bDays = (b.totalUses * (b.hoursSaved ?? 1)) / 8;
        comparison = aDays - bDays;
        break;
      case "installs":
        comparison = a.totalUses - b.totalUses;
        break;
      case "date":
        comparison = a.createdAt.getTime() - b.createdAt.getTime();
        break;
      case "author":
        comparison = (a.author?.name ?? "").localeCompare(b.author?.name ?? "");
        break;
    }
    return sortDir === "desc" ? -comparison : comparison;
  });
}, [skills, sortBy, sortDir]);
```

5. Replace static th elements with SortableColumnHeader:
```tsx
<SortableColumnHeader
  column="name"
  label="Skill Name"
  currentSort={sortBy}
  direction={sortDir}
  onSort={toggleSort}
  align="left"
/>
```
(Repeat for days_saved, installs, date, author - NOT sparkline)

6. Add 7th column header for install (non-sortable):
```tsx
<th scope="col" className="px-4 py-3 text-center text-xs font-medium uppercase tracking-wider text-gray-500">
  Install
</th>
```

7. Replace inline row rendering with SkillsTableRow component:
```tsx
{sortedSkills.map((skill, index) => (
  <SkillsTableRow
    key={skill.id}
    skill={skill}
    trend={usageTrends.get(skill.id) || []}
    isExpanded={isExpanded(skill.id)}
    onToggle={() => toggleRow(skill.id)}
    isCopied={isCopied(skill.id)}
    onInstall={() => copyToClipboard(skill.id, generateMcpConfig(skill))}
    rowIndex={index}
  />
))}
```

**IMPORTANT - Hydration:**
- Default sort (days_saved desc) matches server-side default from searchSkills
- This prevents hydration mismatch
  </action>
  <verify>
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- Contains "use client" directive
- Imports all hooks from Plan 01 and 02
- Uses SortableColumnHeader for 5 sortable columns
- Uses SkillsTableRow for row rendering
  </verify>
  <done>
- SkillsTable is a client component with "use client"
- Sortable column headers with chevron indicators
- Client-side sorting using useMemo
- Rows are expandable with accordion content
- Install button in each row and in accordion
- Sort state persists in URL via nuqs
  </done>
</task>

<task type="auto">
  <name>Task 3: Update page.tsx to pass required skill fields</name>
  <files>apps/web/app/(protected)/skills/page.tsx</files>
  <action>
Ensure the page passes all required fields to SkillsTable.

**Check SearchSkillResult interface** in search-skills.ts - it already includes:
- description: string
- category: string

**Add tags to the query result.** Update the searchSkills query to include tags:

In `apps/web/lib/search-skills.ts`, the select already includes description and category. Check if tags is included - if not, add it.

Actually, looking at the schema, skills has a `tags` column. Check if searchSkills returns tags.

**If tags not returned by searchSkills:**
1. Add `tags: skills.tags` to the select in search-skills.ts
2. Add `tags: string[] | null` to SearchSkillResult interface

**Then verify page.tsx passes skills with all required fields to SkillsTable:**
- The SkillsTable component will use the SearchSkillResult type which includes description, category
- Need to ensure tags is also available

**Update SkillTableRow interface in skills-table.tsx if needed:**
- Should extend or match SearchSkillResult to include description, category, tags
  </action>
  <verify>
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- SearchSkillResult includes tags field
- SkillsTable receives skills with description, category, tags
  </verify>
  <done>
- searchSkills returns tags field
- Page passes complete skill data to SkillsTable
- SkillTableRow type includes description, category, tags
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `cd apps/web && npx tsc --noEmit` passes
2. SkillsTable is a client component
3. Column headers are clickable and show sort indicators
4. URL updates with sortBy/sortDir params when sorting
5. Rows are clickable to expand accordion
6. Multiple rows can be expanded simultaneously
7. Install button copies MCP config and shows feedback
</verification>

<success_criteria>
- User can click column headers to sort (ascending/descending toggle)
- Active sort column shows highlighted chevron
- User can click rows to expand accordion with details
- Multiple rows can be expanded simultaneously
- Install button copies config and shows "Copied!" feedback
- Sort state persists in URL for sharing
</success_criteria>

<output>
After completion, create `.planning/phases/13-interactive-sorting-accordion/13-03-SUMMARY.md`
</output>
