---
phase: 13-interactive-sorting-accordion
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/hooks/use-author-filter.ts
  - apps/web/components/leaderboard-table.tsx
  - apps/web/components/author-filter-chip.tsx
  - apps/web/app/(protected)/skills/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can click contributor in leaderboard to filter table"
    - "Active author filter shows chip in filter bar"
    - "Clicking chip X or highlighted leaderboard row clears filter"
    - "Author filter stacks with existing filters (search, category, tags)"
    - "Author filter persists in URL (?author=user-id)"
  artifacts:
    - path: "apps/web/hooks/use-author-filter.ts"
      provides: "Hook for author filter URL state"
      exports: ["useAuthorFilter"]
    - path: "apps/web/components/author-filter-chip.tsx"
      provides: "Removable chip for active author filter"
      exports: ["AuthorFilterChip"]
    - path: "apps/web/components/leaderboard-table.tsx"
      provides: "Clickable contributor rows"
      contains: "use client"
  key_links:
    - from: "apps/web/components/leaderboard-table.tsx"
      to: "apps/web/hooks/use-author-filter.ts"
      via: "hook import"
      pattern: "useAuthorFilter"
    - from: "apps/web/components/author-filter-chip.tsx"
      to: "apps/web/hooks/use-author-filter.ts"
      via: "hook import"
      pattern: "useAuthorFilter|clearAuthor"
    - from: "apps/web/app/(protected)/skills/page.tsx"
      to: "?author="
      via: "URL parameter handling"
      pattern: "author.*searchParams|params.author"
---

<objective>
Add author filtering from leaderboard to skills table with URL persistence and filter chip

Purpose: Enable filtering skills by contributor when clicking leaderboard rows (LEAD-03)
Output: Clickable leaderboard rows, author filter chip, and URL-synced author filtering
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-interactive-sorting-accordion/13-CONTEXT.md
@.planning/phases/13-interactive-sorting-accordion/13-RESEARCH.md
@apps/web/components/leaderboard-table.tsx (current implementation)
@apps/web/components/category-filter.tsx (nuqs pattern reference)
@apps/web/lib/search-skills.ts (needs author filter support)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useAuthorFilter hook and AuthorFilterChip component</name>
  <files>apps/web/hooks/use-author-filter.ts, apps/web/components/author-filter-chip.tsx</files>
  <action>
Create the author filter hook and chip component.

**apps/web/hooks/use-author-filter.ts:**
```typescript
"use client";

import { useQueryState, parseAsString } from "nuqs";
import { useTransition } from "react";

export function useAuthorFilter() {
  const [author, setAuthor] = useQueryState("author", parseAsString);
  const [isPending, startTransition] = useTransition();

  const filterByAuthor = (authorId: string) => {
    startTransition(() => {
      // Toggle: if already filtering by this author, clear it
      setAuthor(author === authorId ? null : authorId);
    });
  };

  const clearAuthor = () => {
    startTransition(() => {
      setAuthor(null);
    });
  };

  return { author, filterByAuthor, clearAuthor, isPending };
}
```

**apps/web/components/author-filter-chip.tsx:**
```typescript
"use client";

import { useAuthorFilter } from "@/hooks/use-author-filter";

interface AuthorFilterChipProps {
  authorName: string;
}

export function AuthorFilterChip({ authorName }: AuthorFilterChipProps) {
  const { author, clearAuthor, isPending } = useAuthorFilter();

  if (!author) return null;

  return (
    <span className="inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800">
      Author: {authorName}
      <button
        onClick={clearAuthor}
        disabled={isPending}
        className="ml-1 rounded-full p-0.5 hover:bg-blue-200 transition-colors"
        aria-label="Clear author filter"
      >
        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </span>
  );
}
```

**Styling notes:**
- Chip matches existing filter pill style (similar to tag chips)
- X button for clearing filter
- Disabled state during transition
  </action>
  <verify>
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- Both files export expected symbols
  </verify>
  <done>
- useAuthorFilter hook with author state, filterByAuthor, clearAuthor
- AuthorFilterChip displays when author filter active with clear button
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert LeaderboardTable to client component with click handling</name>
  <files>apps/web/components/leaderboard-table.tsx</files>
  <action>
Convert LeaderboardTable to a client component with clickable rows.

**Changes to make:**

1. Add "use client" directive at top

2. Add imports:
```typescript
import { useAuthorFilter } from "@/hooks/use-author-filter";
```

3. Inside the component, use the hook:
```typescript
const { author, filterByAuthor } = useAuthorFilter();
```

4. Make rows clickable:
- Add onClick to each tr: `onClick={() => filterByAuthor(contributor.userId)}`
- Add cursor-pointer class
- Add visual indicator when row is the active filter:
  ```tsx
  className={`${index % 2 === 0 ? "bg-white" : "bg-gray-50"}
    ${author === contributor.userId ? "ring-2 ring-blue-500 bg-blue-50" : ""}
    hover:bg-blue-50 transition-colors cursor-pointer`}
  ```

5. From CONTEXT.md:
- "Clicking author adds to existing filters (stacks with search/category/tags)"
  - This is handled by nuqs - setAuthor preserves other params
- "Either clicking the chip X or clicking the highlighted leaderboard row clears the filter"
  - filterByAuthor toggles: if same author clicked again, clears

**Row styling when active:**
- ring-2 ring-blue-500 for visual highlight
- bg-blue-50 to match expanded row style
  </action>
  <verify>
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- Contains "use client" directive
- Imports useAuthorFilter
- Rows have onClick handler and cursor-pointer
  </verify>
  <done>
- LeaderboardTable is a client component
- Contributor rows are clickable to filter by author
- Active author row is highlighted
- Clicking highlighted row clears the filter
  </done>
</task>

<task type="auto">
  <name>Task 3: Add author filter to searchSkills and wire to page</name>
  <files>apps/web/lib/search-skills.ts, apps/web/app/(protected)/skills/page.tsx</files>
  <action>
Add author filtering to the search functionality and wire it to the page.

**apps/web/lib/search-skills.ts:**

1. Add `authorId` to SearchParams interface:
```typescript
export interface SearchParams {
  query?: string;
  category?: string;
  tags?: string[];
  qualityTier?: "gold" | "silver" | "bronze";
  sortBy?: "uses" | "quality" | "rating" | "days_saved";
  authorId?: string;  // Add this
}
```

2. Add author filter condition (after existing conditions):
```typescript
// Author filter
if (params.authorId) {
  conditions.push(eq(skills.authorId, params.authorId));
}
```

**apps/web/app/(protected)/skills/page.tsx:**

1. Add author to searchParams interface:
```typescript
interface SkillsPageProps {
  searchParams: Promise<{
    q?: string;
    category?: string;
    tags?: string;
    qualityTier?: string;
    sortBy?: string;
    author?: string;  // Add this
  }>;
}
```

2. Parse author param:
```typescript
const authorId = params.author || undefined;
```

3. Pass to searchSkills:
```typescript
const [skills, availableTags, contributors] = await Promise.all([
  searchSkills({ query, category, tags, qualityTier, sortBy, authorId }),
  getAvailableTags(),
  getLeaderboard(10),
]);
```

4. Add AuthorFilterChip to filter bar. Need to find author name from contributors:
```typescript
// Find author name for chip display
const activeAuthor = authorId
  ? contributors.find(c => c.userId === authorId)?.name || "Unknown"
  : null;
```

5. Add chip after existing filters:
```typescript
import { AuthorFilterChip } from "@/components/author-filter-chip";

// In the filter bar section:
{authorId && <AuthorFilterChip authorName={activeAuthor || "Unknown"} />}
```

6. Update hasFilters check:
```typescript
const hasFilters = query || category || tags.length > 0 || qualityTier || authorId;
```
  </action>
  <verify>
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- searchSkills accepts authorId parameter
- Page reads author from URL params
- AuthorFilterChip appears when author filter active
  </verify>
  <done>
- searchSkills filters by authorId when provided
- Page reads ?author= param and passes to search
- Author filter chip displays with author name
- Filter stacks with existing filters
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `cd apps/web && npx tsc --noEmit` passes
2. LeaderboardTable rows are clickable
3. Clicking contributor adds ?author=userId to URL
4. Skills table filters to show only that author's skills
5. Author filter chip appears in filter bar
6. Clicking chip X clears the filter
7. Clicking highlighted leaderboard row clears the filter
8. Author filter stacks with other filters (search, category, tags)
</verification>

<success_criteria>
- User can click contributor in leaderboard to filter table to their skills
- Active author filter shows as removable chip in filter bar
- Active author row is highlighted in leaderboard
- Clicking chip X or highlighted row clears the filter
- Author filter persists in URL (?author=user-id)
- Filter stacks with existing filters
</success_criteria>

<output>
After completion, create `.planning/phases/13-interactive-sorting-accordion/13-04-SUMMARY.md`
</output>
