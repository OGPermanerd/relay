---
phase: 48-homepage-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/app/(protected)/page.tsx
  - apps/web/components/category-tiles.tsx
  - apps/web/components/compact-stats-bar.tsx
  - apps/web/components/mini-leverage-widget.tsx
  - apps/web/lib/category-counts.ts
autonomous: true
must_haves:
  truths:
    - "Homepage shows search-first hero with prominent DiscoverySearch at top"
    - "Four category tiles (Prompts, Workflows, Agents, MCP Tools) appear below search with per-category skill counts"
    - "Category tiles link to /skills?type=X for filtered browsing"
    - "Platform stats appear as a single compact inline banner, not as 4 separate stat cards"
    - "Sections flow as: search hero, category tiles, company recommended, trending cards, compact stats, leaderboard, mini leverage, CTAs"
    - "No tab system exists on the homepage"
  artifacts:
    - path: "apps/web/components/category-tiles.tsx"
      provides: "4-column grid of category tiles with counts"
      contains: "CategoryTiles"
    - path: "apps/web/components/compact-stats-bar.tsx"
      provides: "Inline metrics banner replacing stat cards"
      contains: "CompactStatsBar"
    - path: "apps/web/components/mini-leverage-widget.tsx"
      provides: "Compact personal stats with link to /my-leverage"
      contains: "MiniLeverageWidget"
    - path: "apps/web/lib/category-counts.ts"
      provides: "SQL query for per-category published skill counts"
      contains: "getCategoryCounts"
  key_links:
    - from: "apps/web/app/(protected)/page.tsx"
      to: "apps/web/components/category-tiles.tsx"
      via: "import and render with counts data"
      pattern: "CategoryTiles"
    - from: "apps/web/components/category-tiles.tsx"
      to: "/skills?type="
      via: "Link href for each category tile"
      pattern: "href.*skills.*type"
    - from: "apps/web/lib/category-counts.ts"
      to: "@everyskill/db"
      via: "SQL COUNT GROUP BY category"
      pattern: "getCategoryCounts"
---

<objective>
Restructure the homepage from a tabbed layout into a single scrollable page with search-first hero, category tiles, and compact stats banner.

Purpose: Transform the homepage from a functional dashboard into an intelligent marketplace hub that prioritizes discovery (search + categories) over metrics.

Output: Rewritten homepage page.tsx, three new components (CategoryTiles, CompactStatsBar, MiniLeverageWidget), and a category counts query.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@apps/web/app/(protected)/page.tsx
@apps/web/components/trending-section.tsx
@apps/web/components/company-approved-section.tsx
@apps/web/components/discovery-results.tsx
@apps/web/components/leaderboard-table.tsx
@apps/web/components/my-leverage-view.tsx
@apps/web/lib/platform-stats.ts
@apps/web/lib/my-leverage.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Category counts query + three new components</name>
  <files>
    apps/web/lib/category-counts.ts
    apps/web/components/category-tiles.tsx
    apps/web/components/compact-stats-bar.tsx
    apps/web/components/mini-leverage-widget.tsx
  </files>
  <action>
Create 4 new files:

**1. `apps/web/lib/category-counts.ts`** -- Server-side query function:
- Export `getCategoryCounts(): Promise<Record<string, number>>`
- SQL: `SELECT category, COUNT(*) FROM skills WHERE published_version_id IS NOT NULL AND status = 'published' AND visibility = 'tenant' GROUP BY category`
- Return object like `{ prompt: 12, workflow: 8, agent: 5, mcp: 3 }`
- Handle null db (return all zeros)
- Import db from `@everyskill/db`, skills from `@everyskill/db/schema`, use drizzle `sql` template

**2. `apps/web/components/category-tiles.tsx`** -- Server component (no "use client"):
- Export `CategoryTiles` accepting `counts: Record<string, number>`
- 4-column responsive grid (4 cols on lg, 2 on sm, 1 on mobile)
- Each tile is a `Link` to `/skills?category=X` (use the actual category value: prompt, workflow, agent, mcp)
- Tile content: icon (inline SVG), category label (Prompts, Workflows, Agents, MCP Tools), skill count ("12 skills"), subtle description
- Visual: rounded-xl cards with distinct accent color per category (blue for prompts, purple for workflows, green for agents, orange for MCP), hover shadow lift
- Category display names: prompt -> "Prompts", workflow -> "Workflows", agent -> "Agents", mcp -> "MCP Tools"
- Category descriptions: prompt -> "Ready-to-use AI prompts", workflow -> "Multi-step processes", agent -> "Autonomous AI agents", mcp -> "Tool integrations"

**3. `apps/web/components/compact-stats-bar.tsx`** -- Server component:
- Export `CompactStatsBar` accepting `stats: PlatformStats` (import type from `@/lib/platform-stats`)
- Single horizontal bar with dividers: "X skills | Y uses | Z FTE years saved"
- Style: rounded-lg bg-gray-50 border, flex row with gap, items center, text-sm text-gray-600
- Use FTE_DAYS_PER_YEAR constant for conversion
- Compact: one line of metrics, no icons, no sparklines

**4. `apps/web/components/mini-leverage-widget.tsx`** -- Client component ("use client"):
- Export `MiniLeverageWidget` accepting `skillsUsedStats: SkillsUsedStats, skillsCreatedStats: SkillsCreatedStats` (define inline interfaces matching the shapes from my-leverage.ts -- do NOT import from my-leverage.ts to avoid pulling server code into client bundle)
- Compact card with: "Your Impact" heading, 2-3 key numbers (skills used, skills created, hours saved), Link to "/my-leverage" saying "View full details"
- Style: rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-5, similar to existing "Your Impact" section but more compact
- Use FTE_HOURS_PER_YEAR from `@/lib/constants` for conversion
  </action>
  <verify>
Run `npx tsc --noEmit` from apps/web to confirm all 4 files compile without type errors.
  </verify>
  <done>Four files exist, export their named components/functions, and compile cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite homepage layout</name>
  <files>apps/web/app/(protected)/page.tsx</files>
  <action>
Rewrite `page.tsx` to implement the Hybrid A+B marketplace hub layout. The page is a server component (async function).

**Data fetching** -- keep existing parallel Promise.all pattern, but:
- ADD `getCategoryCounts()` import from `@/lib/category-counts` and call in Promise.all
- REMOVE `getPlatformStatTrends()` call (no longer needed -- compact stats bar has no sparklines)
- REMOVE `getSkillsUsed()` and `getSkillsCreated()` calls (no longer on homepage -- moved to /my-leverage)
- KEEP `getPlatformStats()`, `getTrendingSkills(6)`, `getLeaderboard(5)`, `getCompanyApprovedSkills(6)`, `getSkillsUsedStats()`, `getSkillsCreatedStats()` (last two needed for mini leverage widget)

**Layout order** (single scrollable page, no tabs):
1. Welcome heading + subtitle (keep existing)
2. DiscoverySearch (keep, already prominent)
3. CategoryTiles with counts data
4. CompanyApprovedSection (if skills exist) -- already built, just render
5. Trending section -- keep existing TrendingSection, pass `skills={trending}` only (no trendData prop since we removed trends)
6. CompactStatsBar with stats data
7. LeaderboardTable with "Top Contributors" heading
8. MiniLeverageWidget with user stats
9. Bottom CTAs: "Share a Skill" + "Browse All Skills" (keep existing 2-col Link cards)

**Remove:**
- HomeTabs import and usage (delete the tab wrapper entirely)
- All inline SVG icon components (ClockIcon, PlayCircleIcon, ArrowDownTrayIcon, StarIcon) -- no longer needed
- StatCard import -- replaced by CompactStatsBar
- MyLeverageView import -- moved to dedicated page
- browseContent and leverageContent variable constructs
- serializedSkillsUsed serialization logic

**Imports to add:**
- `import { CategoryTiles } from "@/components/category-tiles"`
- `import { CompactStatsBar } from "@/components/compact-stats-bar"`
- `import { MiniLeverageWidget } from "@/components/mini-leverage-widget"`
- `import { getCategoryCounts } from "@/lib/category-counts"`

**Imports to remove:**
- `HomeTabs`, `MyLeverageView`, `StatCard`, `getPlatformStatTrends`, `getSkillsUsed`, `getSkillsCreated`

The TrendingSection heading "Trending Skills" and LeaderboardTable heading "Top Contributors" should now be full-width sections (not the 2/3 + 1/3 grid). Layout them stacked with the trending section getting its own full-width area and leaderboard below it.
  </action>
  <verify>
Run `cd /home/dev/projects/relay/apps/web && npx next build` to confirm the homepage compiles and builds without errors. If build is too slow, at minimum run `npx tsc --noEmit`.
  </verify>
  <done>
Homepage renders as a single scrollable page with layout: search -> category tiles -> company recommended -> trending -> compact stats -> leaderboard -> mini leverage -> CTAs. No tabs, no stat cards, no sparkline trend data fetching.
  </done>
</task>

</tasks>

<verification>
1. `cd /home/dev/projects/relay/apps/web && npx tsc --noEmit` -- zero type errors
2. Start dev server, visit http://localhost:2002 -- homepage loads with new layout
3. Category tiles show counts and link to /skills?category=X
4. No tab UI visible on homepage
5. Compact stats bar shows inline metrics
6. Mini leverage widget shows personal stats with link to /my-leverage
7. Run relevant Playwright E2E tests: `cd /home/dev/projects/relay/apps/web && npx playwright test tests/e2e/home.spec.ts` (if exists)
</verification>

<success_criteria>
- Homepage loads with search-first hero layout
- Category tiles visible with per-category skill counts
- Platform stats displayed as compact inline banner
- Mini leverage widget shows personal stats
- No tabs, no stat card grid, no trend sparklines on homepage
- All existing sections (company recommended, trending, leaderboard) still render
</success_criteria>

<output>
After completion, create `.planning/phases/48-homepage-redesign/48-01-SUMMARY.md`
</output>
