---
phase: 73-community-discovery-ui
plan: 02
type: execute
wave: 2
depends_on: ["73-01"]
files_modified:
  - apps/web/components/community-card.tsx
  - apps/web/app/(protected)/communities/page.tsx
  - apps/web/app/(protected)/communities/[communityId]/page.tsx
  - apps/web/app/(protected)/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can see community cards with names, descriptions, member counts, and top skills on the browse page"
    - "Clicking a community card navigates to a detail page with all member skills and similarity scores"
    - "Dashboard shows a communities section with cards linking to the browse page"
  artifacts:
    - path: "apps/web/app/(protected)/communities/page.tsx"
      provides: "Community browse page with card grid"
      min_lines: 20
    - path: "apps/web/app/(protected)/communities/[communityId]/page.tsx"
      provides: "Community detail page with member skill list and similarity"
      min_lines: 30
    - path: "apps/web/components/community-card.tsx"
      provides: "Reusable community card component"
      min_lines: 15
  key_links:
    - from: "apps/web/app/(protected)/communities/page.tsx"
      to: "@everyskill/db"
      via: "import getCommunities"
      pattern: "getCommunities"
    - from: "apps/web/app/(protected)/communities/[communityId]/page.tsx"
      to: "@everyskill/db"
      via: "import getCommunityDetail"
      pattern: "getCommunityDetail"
    - from: "apps/web/app/(protected)/page.tsx"
      to: "apps/web/components/community-card.tsx"
      via: "import CommunityCard"
      pattern: "CommunityCard"
---

<objective>
Build the community browse page, detail page, community card component, and dashboard integration.

Purpose: Give users a visual way to discover skill communities -- browse cards on the dashboard and dedicated page, drill into any community to see member skills ranked by similarity.
Output: Three new pages/components, dashboard updated with communities section.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/73-community-discovery-ui/73-01-SUMMARY.md
@apps/web/app/(protected)/page.tsx
@apps/web/components/category-tiles.tsx
@apps/web/app/(protected)/skills/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Community card component + browse page</name>
  <files>
    apps/web/components/community-card.tsx
    apps/web/app/(protected)/communities/page.tsx
  </files>
  <action>
1. Create `apps/web/components/community-card.tsx`:
   - Import Link from next/link, import CommunityOverview type from `@everyskill/db`
   - Render as a Link to `/communities/${community.communityId}`
   - Card styling: rounded-lg border border-gray-200 bg-white p-5 shadow-sm, hover:border-blue-300 hover:shadow-md transition
   - Show: community.label (fallback to `Community ${communityId + 1}` if null)
   - Show: community.description (line-clamp-2, text-sm text-gray-600)
   - Show: `${community.memberCount} skills` badge (text-sm text-gray-500)
   - Show: top skills as rounded-full bg-gray-100 px-2 py-0.5 text-xs pills (max 3, from community.topSkills)
   - Export: `CommunityCard` component

2. Create `apps/web/app/(protected)/communities/page.tsx` (server component):
   - Import auth from `@/auth`, redirect from next/navigation
   - Import getCommunities from `@everyskill/db`
   - Import CommunityCard from `@/components/community-card`
   - Auth guard: `const session = await auth(); if (!session?.user?.tenantId) redirect("/login");`
   - Fetch: `const communities = await getCommunities(session.user.tenantId);`
   - Layout: max-w-7xl container with px-4 py-8
   - Header: h1 "Skill Communities" (text-2xl font-bold text-gray-900 mb-2)
   - Subtitle: p "Discover related skills grouped by thematic similarity. Communities update periodically." (text-gray-600 mb-6)
   - Grid: `grid gap-4 sm:grid-cols-2 lg:grid-cols-3` with CommunityCard for each community
   - Empty state: if communities.length === 0, show a centered message: "No communities detected yet. Communities are generated automatically when enough skills are published."
   - Add Next.js metadata: `export const metadata = { title: "Skill Communities" }`
  </action>
  <verify>
    - `pnpm turbo typecheck` passes
    - Navigate to `http://localhost:2002/communities` and verify community cards render with labels, descriptions, member counts, and top skill pills
  </verify>
  <done>Browse page at /communities shows a responsive grid of community cards. Each card displays AI-generated name, description, member count, and top 3 skill pills. Empty state handled.</done>
</task>

<task type="auto">
  <name>Task 2: Community detail page + dashboard section</name>
  <files>
    apps/web/app/(protected)/communities/[communityId]/page.tsx
    apps/web/app/(protected)/page.tsx
  </files>
  <action>
1. Create `apps/web/app/(protected)/communities/[communityId]/page.tsx` (server component):
   - Import auth, redirect, notFound from next/navigation
   - Import getCommunityDetail from `@everyskill/db`
   - Import Link from next/link
   - Parse params: `const communityId = parseInt(params.communityId); if (isNaN(communityId)) notFound();`
   - Note: Next.js 16 makes params a Promise -- use `const { communityId: cid } = await params;` then parseInt
   - Auth guard same pattern as browse page
   - Fetch: `const community = await getCommunityDetail(session.user.tenantId, communityId); if (!community) notFound();`
   - Layout: max-w-7xl container
   - Back link: `< Back to Communities` linking to /communities (text-sm text-blue-600 hover:text-blue-800 mb-4)
   - Header: h1 with community.label (fallback: `Community ${communityId + 1}`), text-2xl font-bold
   - Description: p with community.description if present, text-gray-600 mb-6
   - Stats bar: member count + modularity as inline text-sm text-gray-500 badges
   - Skill list: Use a styled table or card list. For each skill:
     - Name (as Link to `/skills/${skill.slug}`) in font-medium text-blue-600 hover:text-blue-800
     - Category badge (rounded-full bg-gray-100 px-2 py-0.5 text-xs)
     - Similarity percentage: `${skill.similarityPct}% match` in text-sm, color-coded:
       >= 80: text-green-600, >= 60: text-yellow-600, < 60: text-gray-500
     - Description (truncated, text-sm text-gray-600 line-clamp-2)
     - Total uses (text-sm text-gray-400)
   - Use a div list (not HTML table) for responsive layout. Each skill as a flex row or card.
   - Generate dynamic metadata: `export async function generateMetadata(...)` returning title with community label

2. Update `apps/web/app/(protected)/page.tsx` (dashboard):
   - Import getCommunities from `@everyskill/db`
   - Import CommunityCard from `@/components/community-card`
   - Import Link from next/link (already imported)
   - Add getCommunities(tenantId) to the existing Promise.all data fetch
   - Add a "Skill Communities" section between "Category Tiles" and "Company Recommended":
     ```jsx
     {communities.length > 0 && (
       <div className="mb-8">
         <div className="mb-4 flex items-center justify-between">
           <h2 className="text-lg font-semibold text-gray-900">Skill Communities</h2>
           <Link href="/communities" className="text-sm text-blue-600 hover:text-blue-800">
             View all &rarr;
           </Link>
         </div>
         <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
           {communities.slice(0, 3).map((c) => (
             <CommunityCard key={c.communityId} community={c} />
           ))}
         </div>
       </div>
     )}
     ```
   - Show max 3 communities on dashboard with "View all" link to /communities
  </action>
  <verify>
    - `pnpm turbo typecheck` passes
    - `pnpm lint` passes
    - Navigate to `http://localhost:2002/communities` -- click a community card -- verify detail page loads with skill list and similarity percentages
    - Navigate to `http://localhost:2002` (dashboard) -- verify "Skill Communities" section appears with up to 3 cards and "View all" link
    - Verify clicking "View all" navigates to /communities
    - Verify clicking a skill name on the detail page navigates to the skill detail page
  </verify>
  <done>Detail page at /communities/[id] shows community name, description, and all member skills ranked by centroid similarity with percentage scores. Dashboard shows top 3 communities with "View all" link. All navigation links work.</done>
</task>

</tasks>

<verification>
- /communities page shows card grid with AI-generated labels
- /communities/[id] page shows member skills with similarity percentages
- Dashboard includes communities section between categories and company-approved
- All links navigate correctly (card -> detail, skill name -> skill page, back link, view all)
- Empty states handled (no communities = helpful message)
- Responsive layout (1 col mobile, 2 cols sm, 3 cols lg)
</verification>

<success_criteria>
- Community browse page renders at /communities with card grid
- Community detail page renders at /communities/[id] with sorted skill list and similarity %
- Dashboard shows top 3 communities with "View all" link
- Cards show: AI-generated name, description, member count, top skill pills
- Detail page shows: community header, back link, skills with name (linked), category, similarity %, description, uses
- No TypeScript errors, no lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/73-community-discovery-ui/73-02-SUMMARY.md`
</output>
