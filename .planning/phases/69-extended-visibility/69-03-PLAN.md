---
phase: 69-extended-visibility
plan: 03
type: execute
wave: 2
depends_on: ["69-01"]
files_modified:
  - apps/web/components/skill-upload-form.tsx
  - apps/web/components/portfolio-view.tsx
  - apps/web/components/resume-view.tsx
autonomous: false

must_haves:
  truths:
    - "Upload form shows 4 visibility options: Team, Personal, Private, and Global (admin-only)"
    - "Global option only appears for admin users"
    - "Default visibility selection is Team (tenant)"
    - "VisibilityBadge in portfolio displays correct label and color for all 4 levels"
    - "VisibilityBadge in resume displays correct label and color for all 4 levels"
  artifacts:
    - path: "apps/web/components/skill-upload-form.tsx"
      provides: "Upload form with 4 visibility radio buttons"
      contains: "global_approved"
    - path: "apps/web/components/portfolio-view.tsx"
      provides: "VisibilityBadge handling 4 levels"
      contains: "global_approved"
    - path: "apps/web/components/resume-view.tsx"
      provides: "VisibilityBadge handling 4 levels"
      contains: "global_approved"
  key_links:
    - from: "apps/web/components/skill-upload-form.tsx"
      to: "apps/web/app/actions/skills.ts"
      via: "form submission with visibility field"
      pattern: "name=\"visibility\""
---

<objective>
Update UI components to display and select from 4 visibility levels, with admin-conditional global option.

Purpose: Users need to see and select the new visibility levels when creating/editing skills, and existing portfolio/resume views need to render the correct badge for all 4 levels. The Global option must only appear for admins (VIS-05).

Output: Upload form with 4 options, VisibilityBadge updated in both portfolio and resume views.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/69-extended-visibility/69-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update upload form with 4 visibility options and admin detection</name>
  <files>
    apps/web/components/skill-upload-form.tsx
  </files>
  <action>
The SkillUploadForm is a client component ("use client"). It currently has 2 radio buttons for visibility (tenant, personal) around lines 200-225.

**Step 1: Pass isAdmin prop.** The form needs to know if the user is an admin to conditionally show the Global option. Since this is a client component, the admin status must be passed as a prop from the server parent.

Find where SkillUploadForm is rendered (likely in a page.tsx under `apps/web/app/(protected)/`). Add `isAdmin` prop:
- In the parent server component: `import { isAdmin } from "@/lib/admin"` and pass `isAdmin={isAdmin(session)}`
- In SkillUploadForm: add `isAdmin?: boolean` to props, default false

**Step 2: Add Private radio button** after the Personal radio (around line 225):
```tsx
<label className="flex items-center gap-2 cursor-pointer">
  <input
    type="radio"
    name="visibility"
    value="private"
    checked={fields.visibility === "private"}
    onChange={(e) => setField("visibility", e.target.value)}
    disabled={isPending}
    className="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"
  />
  <div>
    <span className="text-sm font-medium text-gray-700">Private</span>
    <p className="text-xs text-gray-500">Hidden from all views, only you can access directly</p>
  </div>
</label>
```

**Step 3: Add Global radio button** (conditionally shown for admins):
```tsx
{isAdmin && (
  <label className="flex items-center gap-2 cursor-pointer">
    <input
      type="radio"
      name="visibility"
      value="global_approved"
      checked={fields.visibility === "global_approved"}
      onChange={(e) => setField("visibility", e.target.value)}
      disabled={isPending}
      className="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"
    />
    <div>
      <span className="text-sm font-medium text-gray-700">Global</span>
      <p className="text-xs text-gray-500">Visible across all organizations (admin only)</p>
    </div>
  </label>
)}
```

**Step 4: Update label descriptions** for existing options to be clearer:
- Team (tenant): "Visible to everyone in your organization"
- Personal: "Only you can see it, appears in your portfolio"

**Step 5: Update the `fields` default** -- keep `visibility: "tenant"` as default (unchanged, this is correct).
  </action>
  <verify>
Run `pnpm turbo typecheck` -- no type errors.
Run the relevant Playwright E2E test for the upload page: `cd /home/dev/projects/relay/apps/web && npx playwright test tests/e2e/upload.spec.ts` (if it exists). If no specific test exists, run `npx playwright test` to verify no regressions.
  </verify>
  <done>
Upload form shows Team, Personal, Private options for all users plus Global for admins. Default is Team. Form submits correct visibility value.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update VisibilityBadge in portfolio and resume views</name>
  <files>
    apps/web/components/portfolio-view.tsx
    apps/web/components/resume-view.tsx
  </files>
  <action>
Both files have identical `VisibilityBadge` components (lines 27-40 in portfolio, lines 51-64 in resume). Update BOTH to handle all 4 levels:

```tsx
function VisibilityBadge({ visibility }: { visibility: string }) {
  switch (visibility) {
    case "global_approved":
      return (
        <span className="inline-flex items-center rounded-full bg-purple-100 px-2 py-0.5 text-xs font-medium text-purple-700">
          Global
        </span>
      );
    case "tenant":
      return (
        <span className="inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-700">
          Company
        </span>
      );
    case "personal":
      return (
        <span className="inline-flex items-center rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-700">
          Portable
        </span>
      );
    case "private":
      return (
        <span className="inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-500">
          Private
        </span>
      );
    default:
      return null;
  }
}
```

Color scheme rationale:
- Global (purple) -- stands out as special/elevated
- Company (blue) -- existing color, unchanged
- Portable (green) -- existing color, unchanged
- Private (gray) -- muted to indicate hidden/inactive

Both portfolio-view.tsx and resume-view.tsx get the exact same component update.
  </action>
  <verify>
Run `pnpm turbo typecheck` -- no type errors.
Run Playwright tests: `cd /home/dev/projects/relay/apps/web && npx playwright test tests/e2e/portfolio.spec.ts tests/e2e/resume.spec.ts` (if they exist).
  </verify>
  <done>
VisibilityBadge shows correct label and color for all 4 visibility levels in both portfolio and resume views. Existing badge styles for Company and Portable unchanged.
  </done>
</task>

</tasks>

<verification>
1. `pnpm turbo typecheck` passes
2. Upload form renders all 4 visibility options (3 for non-admin, 4 for admin)
3. VisibilityBadge in portfolio renders Global (purple), Company (blue), Portable (green), Private (gray)
4. VisibilityBadge in resume renders same 4 styles
5. Playwright E2E tests pass (no regressions)
</verification>

<success_criteria>
- Upload form has Team, Personal, Private radio buttons for all users
- Upload form has Global radio button visible only to admins
- VisibilityBadge handles all 4 levels with distinct colors in both portfolio and resume
- Default visibility remains "tenant" (Team)
- No type errors, no E2E regressions
</success_criteria>

<output>
After completion, create `.planning/phases/69-extended-visibility/69-03-SUMMARY.md`
</output>
