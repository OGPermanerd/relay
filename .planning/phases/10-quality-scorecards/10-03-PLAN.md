---
phase: 10-quality-scorecards
plan: 03
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - apps/web/components/quality-breakdown.tsx
  - apps/web/components/skill-detail.tsx
  - apps/web/app/(protected)/skills/[slug]/page.tsx
  - apps/web/lib/skill-stats.ts
autonomous: true

must_haves:
  truths:
    - "Skill detail page displays quality badge prominently near title"
    - "User can expand 'Why this badge?' to see score breakdown"
    - "Breakdown shows usage score, rating score, and docs score"
  artifacts:
    - path: "apps/web/components/quality-breakdown.tsx"
      provides: "Collapsible quality breakdown component"
      exports: ["QualityBreakdown"]
    - path: "apps/web/components/skill-detail.tsx"
      provides: "Skill detail with badge integration"
      contains: "QualityBadge"
  key_links:
    - from: "apps/web/components/skill-detail.tsx"
      to: "apps/web/components/quality-breakdown.tsx"
      via: "renders breakdown component"
      pattern: "<QualityBreakdown"
    - from: "apps/web/app/(protected)/skills/[slug]/page.tsx"
      to: "apps/web/lib/skill-stats.ts"
      via: "passes totalRatings to detail"
      pattern: "totalRatings"
---

<objective>
Add quality badge and breakdown section to skill detail page.

Purpose: Users understand why a skill earned its badge (QUAL-04 transparency requirement).
Output: Detail page with badge and collapsible "Why this badge?" breakdown.
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-quality-scorecards/10-CONTEXT.md
@apps/web/components/skill-detail.tsx
@apps/web/lib/skill-stats.ts
@apps/web/app/(protected)/skills/[slug]/page.tsx
@apps/web/lib/quality-score.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create QualityBreakdown component</name>
  <files>apps/web/components/quality-breakdown.tsx</files>
  <action>
Create a collapsible component showing quality score breakdown.

Props:
- breakdown: QualityBreakdown (from quality-score.ts)
- tier: QualityTier
- score: number

Structure:
```tsx
"use client";

import { useState } from "react";
import { QualityBreakdown as BreakdownData, QualityTier } from "@/lib/quality-score";

interface QualityBreakdownProps {
  breakdown: BreakdownData;
  tier: QualityTier;
  score: number;
}

export function QualityBreakdown({ breakdown, tier, score }: QualityBreakdownProps) {
  const [isOpen, setIsOpen] = useState(false);

  if (tier === "unrated" || tier === "none") {
    return null; // No breakdown for unrated or no-badge skills
  }

  return (
    <div className="mt-2">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="text-sm text-blue-600 hover:underline flex items-center gap-1"
      >
        {isOpen ? "Hide" : "Why this badge?"}
        <span>{isOpen ? "▲" : "▼"}</span>
      </button>

      {isOpen && (
        <div className="mt-2 p-4 bg-gray-50 rounded-lg text-sm">
          <p className="font-medium mb-2">Quality Score: {score}/100</p>
          <ul className="space-y-1 text-gray-600">
            <li>Usage (50% weight): {breakdown.usageScore.toFixed(1)}/50</li>
            <li>Rating (35% weight): {breakdown.ratingScore.toFixed(1)}/35</li>
            <li>Documentation (15% weight): {breakdown.docsScore.toFixed(1)}/15</li>
          </ul>
        </div>
      )}
    </div>
  );
}
```

For unrated skills, show a different message:
- If tier === "unrated", optionally render "Need 3+ ratings to earn a badge"
  </action>
  <verify>Component renders with `npm run build`</verify>
  <done>QualityBreakdown component exists with collapsible behavior</done>
</task>

<task type="auto">
  <name>Task 2: Add totalRatings to SkillStats and page data flow</name>
  <files>apps/web/lib/skill-stats.ts, apps/web/app/(protected)/skills/[slug]/page.tsx</files>
  <action>
SkillStats already has totalRatings - verify it's being passed correctly.

1. In skill-stats.ts:
   - Confirm totalRatings is already in SkillStats interface (it is)
   - Confirm it's returned from getSkillStats (it is)

2. In skills/[slug]/page.tsx:
   - stats.totalRatings is already available
   - Pass it to SkillDetail component

Update SkillDetail props to include quality data:
- Either compute score in page.tsx and pass down, or
- Pass raw data (totalRatings, skill.totalUses, etc.) and compute in SkillDetail

Simpler approach: Compute in SkillDetail since it already has skill and stats props.
  </action>
  <verify>Verify data flow with console.log in SkillDetail</verify>
  <done>totalRatings flows from getSkillStats through page to SkillDetail</done>
</task>

<task type="auto">
  <name>Task 3: Integrate badge and breakdown into SkillDetail</name>
  <files>apps/web/components/skill-detail.tsx</files>
  <action>
Add quality badge and breakdown to the skill detail header.

1. Import calculateQualityScore from quality-score.ts
2. Import QualityBadge and QualityBreakdown components
3. Update SkillDetailProps to include skill data needed for calculation:
   - skill already has: totalUses (via averageRating and we have stats), description, category
   - Need: averageRating from skill object, totalRatings from stats

4. Compute quality score:
   ```typescript
   const { score, tier, breakdown } = calculateQualityScore({
     totalUses: skill.totalUses || stats.totalUses, // use denormalized value
     averageRating: skill.averageRating ?? null, // from skill object
     totalRatings: stats.totalRatings,
     hasDescription: Boolean(skill.description),
     hasCategory: Boolean(skill.category),
   });
   ```

5. Add badge next to title (after h1):
   ```tsx
   <div className="flex items-center gap-3">
     <h1 className="text-3xl font-bold">{skill.name}</h1>
     <QualityBadge tier={tier} size="md" />
   </div>
   ```

6. Add breakdown below badge section:
   ```tsx
   <QualityBreakdown breakdown={breakdown} tier={tier} score={score} />
   ```

7. Update SkillWithAuthor interface to include:
   - totalUses: number (add if not present)
   - averageRating: number | null (add if not present)

Note: skill-detail.tsx needs access to skill.totalUses and skill.averageRating. Check if these are already passed from the page query. If not, add them to the query columns.
  </action>
  <verify>Run dev server, navigate to skill detail page, verify badge and breakdown appear</verify>
  <done>Skill detail shows badge near title and expandable breakdown</done>
</task>

</tasks>

<verification>
1. `npm run build` passes
2. Navigate to any skill detail page - badge appears next to title
3. "Why this badge?" link is clickable and toggles breakdown
4. Breakdown shows correct scores for usage, rating, docs
5. Skills with <3 ratings show "Unrated" badge with appropriate message
</verification>

<success_criteria>
- Badge visible prominently on detail page
- Breakdown is collapsible (hidden by default)
- Score math matches formula in CONTEXT.md
- Unrated skills handled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/10-quality-scorecards/10-03-SUMMARY.md`
</output>
