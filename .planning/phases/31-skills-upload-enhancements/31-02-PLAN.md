---
phase: 31-skills-upload-enhancements
plan: 02
type: execute
wave: 2
depends_on: ["31-01"]
files_modified:
  - apps/web/components/skill-detail.tsx
  - apps/web/components/skills-table-row.tsx
  - apps/web/components/my-skills-list.tsx
  - apps/web/components/ai-review-display.tsx
  - apps/web/components/reviews-list.tsx
  - apps/web/components/admin-key-manager.tsx
  - apps/web/components/api-key-manager.tsx
  - apps/web/components/employee-detail-modal.tsx
  - apps/web/components/employees-tab.tsx
  - apps/web/components/admin-settings-form.tsx
  - apps/web/app/(protected)/users/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "All timestamps in cards, lists, and detail views show relative format like '1d 5h 3min ago'"
    - "Timestamps older than 1 year show format like '1y 5d ago'"
    - "Chart axis labels remain as absolute dates (not converted)"
    - "Zero instances of toLocaleDateString in non-chart component files"
  artifacts:
    - path: "apps/web/components/skill-detail.tsx"
      provides: "Skill detail with RelativeTime"
      contains: "RelativeTime"
    - path: "apps/web/components/skills-table-row.tsx"
      provides: "Skills table row with RelativeTime"
      contains: "RelativeTime"
  key_links:
    - from: "apps/web/components/skill-detail.tsx"
      to: "apps/web/components/relative-time.tsx"
      via: "RelativeTime component usage"
      pattern: "<RelativeTime"
    - from: "apps/web/components/skills-table-row.tsx"
      to: "apps/web/components/relative-time.tsx"
      via: "RelativeTime component usage"
      pattern: "<RelativeTime"
---

<objective>
Replace all 13 timestamp locations across the platform with the RelativeTime component from Plan 01 (SKILL-01 completion).

Purpose: Users see friendly relative times ("1d 5h 3min ago") instead of absolute dates across all views.
Output: All 11 component/page files converted to use `<RelativeTime>`.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/31-skills-upload-enhancements/31-01-SUMMARY.md
@apps/web/components/relative-time.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace timestamps in first 6 files (toLocaleDateString locations)</name>
  <files>
    apps/web/components/skill-detail.tsx
    apps/web/components/reviews-list.tsx
    apps/web/components/admin-key-manager.tsx
    apps/web/components/api-key-manager.tsx
    apps/web/components/employee-detail-modal.tsx
    apps/web/components/employees-tab.tsx
  </files>
  <action>
    Import `RelativeTime` from `@/components/relative-time` in each file.

    Replace `toLocaleDateString()` calls with `<RelativeTime date={...} />`:

    1. `skill-detail.tsx` (line ~46): Replace `new Date(skill.createdAt).toLocaleDateString()` with `<RelativeTime date={skill.createdAt} />`

    2. `reviews-list.tsx` (line ~56): Replace date formatting with `<RelativeTime date={review.createdAt} />`

    3. `admin-key-manager.tsx` (lines ~65, ~339): Replace both `toLocaleDateString()` calls:
       - Created date: `<RelativeTime date={key.createdAt} />`
       - Expires date: Keep as absolute date if it's a future expiry display, OR use RelativeTime if showing "last used" / "created" timestamps. Judge by context -- expiry dates should remain absolute ("Mar 15, 2026") since "45d from now" is confusing for expiry.

    4. `api-key-manager.tsx` (lines ~66, ~332, ~338): Same pattern as admin-key-manager -- replace "created" and "last used" timestamps with RelativeTime, keep expiry dates as absolute.

    5. `employee-detail-modal.tsx` (lines ~100, ~155): Replace both timestamp locations with `<RelativeTime date={...} />`

    6. `employees-tab.tsx` (line ~193): Replace timestamp with `<RelativeTime date={...} />`

    For each file: import RelativeTime, find the timestamp rendering, replace with the component. Work file by file to avoid errors.

    CRITICAL: Do NOT convert expiry dates (future dates) to relative format -- those should remain absolute for clarity.
  </action>
  <verify>
    - `cd apps/web && npx tsc --noEmit` passes
    - Grep for `toLocaleDateString` in modified files -- only in expiry date contexts (if any), not in "created at" or "last used" contexts
  </verify>
  <done>
    - 6 files converted from toLocaleDateString to RelativeTime
    - Expiry dates remain as absolute dates
    - TypeScript compiles cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace timestamps in remaining 5 files (manual UTC formatting locations)</name>
  <files>
    apps/web/components/skills-table-row.tsx
    apps/web/components/my-skills-list.tsx
    apps/web/components/ai-review-display.tsx
    apps/web/components/admin-settings-form.tsx
    apps/web/app/(protected)/users/[id]/page.tsx
  </files>
  <action>
    These files use manual UTC formatting (the `MONTHS[d.getUTCMonth()]` pattern from MEMORY.md).

    1. `skills-table-row.tsx` (lines ~96-111): Remove the local `formatDate` function. Import and use `<RelativeTime date={skill.createdAt} />` instead.

    2. `my-skills-list.tsx` (lines ~8-11): Remove the local `formatDate` function. Import and use `<RelativeTime date={skill.createdAt} />` instead.

    3. `ai-review-display.tsx` (lines ~48-57): Remove the local date formatting. Import and use `<RelativeTime date={review.createdAt} />` instead.

    4. `admin-settings-form.tsx` (line ~20): Replace the manual date formatting with `<RelativeTime date={...} />`.

    5. `app/(protected)/users/[id]/page.tsx` (line ~89): This is a server component. Pass the date as an ISO string and use `<RelativeTime date={dateString} />`. The RelativeTime component is a client component so it will handle the rendering.

    For each file: import `RelativeTime` from `@/components/relative-time`, find and remove any local `formatDate` helper, replace the date rendering with the component.

    DO NOT convert chart axis labels in skill-analytics-modal.tsx or usage-area-chart.tsx.
  </action>
  <verify>
    - `cd apps/web && npx tsc --noEmit` passes
    - `cd apps/web && pnpm build` succeeds
    - Grep for `toLocaleDateString` in all component files (excluding charts) -- 0 matches for created/updated timestamps
    - Grep for `getUTCMonth` in modified files -- 0 matches (manual formatting removed)
    - Playwright test on skills page loads without hydration errors: `cd apps/web && node_modules/.bin/playwright test`
  </verify>
  <done>
    - All 13 timestamp locations converted to RelativeTime (chart axes excluded)
    - No local formatDate helpers remain in modified files
    - Zero instances of toLocaleDateString in non-chart component files
    - Build succeeds, Playwright tests pass
  </done>
</task>

</tasks>

<verification>
1. `cd apps/web && pnpm build` -- successful build with no warnings
2. Grep for `toLocaleDateString` in components -- should return 0 matches (except chart files)
3. Grep for `<RelativeTime` across components -- should match in all 11 modified files
4. Playwright test on skills page loads without hydration errors
</verification>

<success_criteria>
- All 13 timestamp locations converted (chart axes excluded)
- Zero instances of toLocaleDateString in non-chart component files
- No local formatDate helpers remain
- Build succeeds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/31-skills-upload-enhancements/31-02-SUMMARY.md`
</output>
