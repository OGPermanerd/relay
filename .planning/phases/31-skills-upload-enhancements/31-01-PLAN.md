---
phase: 31-skills-upload-enhancements
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - apps/web/lib/relative-time.ts
  - apps/web/lib/__tests__/relative-time.test.ts
  - apps/web/components/relative-time.tsx
autonomous: true

must_haves:
  truths:
    - "formatRelativeTime returns correct strings for all time ranges (seconds through years)"
    - "No hydration mismatches occur when RelativeTime renders on client"
    - "RelativeTime auto-refreshes every 60 seconds"
  artifacts:
    - path: "apps/web/lib/relative-time.ts"
      provides: "formatRelativeTime pure function"
      exports: ["formatRelativeTime"]
    - path: "apps/web/lib/__tests__/relative-time.test.ts"
      provides: "Unit tests for relative time formatting"
      min_lines: 30
    - path: "apps/web/components/relative-time.tsx"
      provides: "Hydration-safe RelativeTime client component"
      exports: ["RelativeTime"]
  key_links:
    - from: "apps/web/components/relative-time.tsx"
      to: "apps/web/lib/relative-time.ts"
      via: "import formatRelativeTime"
      pattern: "import.*formatRelativeTime.*from.*relative-time"
---

<objective>
Create the TDD-tested formatRelativeTime utility and hydration-safe RelativeTime client component (SKILL-01 foundation).

Purpose: Provides the building blocks that Plan 02 will use to replace all 13 timestamp locations across the platform.
Output: `formatRelativeTime()` utility with tests, `<RelativeTime>` component.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
</context>

<feature>
  <name>Relative Timestamp Formatting</name>
  <files>apps/web/lib/relative-time.ts, apps/web/lib/__tests__/relative-time.test.ts</files>
  <behavior>
    formatRelativeTime(date: Date | string): string

    Cases (relative to "now"):
    - 0 seconds ago -> "just now"
    - 30 seconds ago -> "just now" (minutes granularity)
    - 5 minutes ago -> "5min ago"
    - 2 hours 15 minutes ago -> "2h 15min ago"
    - 1 day 3 hours ago -> "1d 3h ago"
    - 7 days 0 hours ago -> "7d ago" (minutes omitted when days >= 7)
    - 30 days 5 hours ago -> "30d 5h ago"
    - 365 days ago -> "1y ago"
    - 400 days ago -> "1y 35d ago"
    - future date -> "just now"
    - string ISO date input -> same as Date input
  </behavior>
  <implementation>
    RED: Write tests for all cases above using jest/vitest. Mock Date.now() with a fixed timestamp.
    GREEN: Implement formatRelativeTime as a pure function with no dependencies.
    REFACTOR: Clean up edge cases if needed.

    Then create `<RelativeTime>` client component:
    - "use client" directive
    - useState("") for initial render (empty string avoids hydration mismatch)
    - useEffect sets text on mount and refreshes every 60 seconds via setInterval
    - Accepts `date: Date | string` prop
    - Renders `<span>{text}</span>`

    CRITICAL: Never use toLocaleDateString() or toLocaleString() -- causes hydration mismatches per MEMORY.md.
  </implementation>
</feature>

<verification>
1. `cd apps/web && npx vitest run lib/__tests__/relative-time.test.ts` -- all tests pass
2. `cd apps/web && npx tsc --noEmit` -- no TypeScript errors
</verification>

<success_criteria>
- formatRelativeTime passes all test cases
- RelativeTime component renders without hydration warnings
- Build succeeds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/31-skills-upload-enhancements/31-01-SUMMARY.md`
</output>
