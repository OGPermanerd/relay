---
phase: 21-employee-usage-tracking
plan: 05
type: execute
wave: 2
depends_on: ["21-04"]
files_modified:
  - apps/web/components/home-tabs.tsx
  - apps/web/components/my-leverage-view.tsx
  - apps/web/app/(protected)/page.tsx
autonomous: true

must_haves:
  truths:
    - "Home page has Browse Skills and My Leverage tabs"
    - "Tab state synced to URL via nuqs (?view=browse or ?view=leverage)"
    - "My Leverage shows Skills Used section with stat cards and timeline"
    - "My Leverage shows Skills Created section with stat cards and skill list"
    - "Timeline has Load More button for pagination"
  artifacts:
    - path: "apps/web/components/home-tabs.tsx"
      provides: "Tab toggle component using nuqs"
      exports: ["HomeTabs"]
    - path: "apps/web/components/my-leverage-view.tsx"
      provides: "My Leverage content with stats + timelines"
      exports: ["MyLeverageView"]
    - path: "apps/web/app/(protected)/page.tsx"
      provides: "Updated home page with tab UI"
  key_links:
    - from: "apps/web/app/(protected)/page.tsx"
      to: "apps/web/lib/my-leverage.ts"
      via: "Server-side data fetching in parallel"
      pattern: "getSkillsUsed|getSkillsCreated"
    - from: "apps/web/components/home-tabs.tsx"
      to: "nuqs"
      via: "useQueryState with parseAsStringLiteral"
      pattern: "useQueryState"
---

<objective>
Build the My Skill Leverage tab UI on the home page.

Purpose: Employees see their personal skill usage history and created skill impact (TRK-04).
Output: Tabbed home page with Browse Skills (existing) and My Leverage (new) views.
</objective>

<context>
@apps/web/app/(protected)/page.tsx
@apps/web/components/stat-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tab and leverage components</name>
  <files>apps/web/components/home-tabs.tsx, apps/web/components/my-leverage-view.tsx</files>
  <action>
1. Create `apps/web/components/home-tabs.tsx` ("use client"):
   - Import `useQueryState`, `parseAsStringLiteral` from `nuqs`
   - Define `TABS = ["browse", "leverage"] as const`
   - Props: `{ browseContent: React.ReactNode, leverageContent: React.ReactNode }`
   - `useQueryState("view", parseAsStringLiteral(TABS).withDefault("browse"))`
   - Render two tab buttons styled with Tailwind (active: border-b-2 border-blue-500 text-blue-600, inactive: text-gray-500 hover:text-gray-700)
   - Tab labels: "Browse Skills" and "My Leverage"
   - Conditionally render browseContent or leverageContent based on active tab

2. Create `apps/web/components/my-leverage-view.tsx` ("use client"):
   - Props: `{ skillsUsed, skillsUsedStats, skillsCreated, skillsCreatedStats }` -- all data passed from server component
   - Import StatCard from `@/components/stat-card`
   - **Skills Used section:**
     - H2: "Skills Used"
     - 4 stat cards in grid (sm:grid-cols-2 lg:grid-cols-4): Skills Used (totalSkills), FTE Hours Saved (totalHoursSaved), Total Actions (totalActions), Most Used (mostUsedSkill || "None yet")
     - Timeline list below: map over skillsUsed items showing skill name, action badge (search/list/deploy/install), category badge, hours saved, relative timestamp
     - "Load More" button at bottom (tracks page state, calls server action or fetch to get next page -- use useState for `items` array and append on load more)
   - **Skills Created section:**
     - H2: "Skills Created"
     - 4 stat cards: Skills Published (skillsPublished), Hours Saved by Others (hoursSavedByOthers), Unique Users (uniqueUsers), Avg Rating (avgRating formatted to 1 decimal)
     - List of created skills showing name, category, total uses, hours saved, unique users, avg rating
   - Empty states: If no data, show friendly message like "Start using skills via MCP to see your leverage here"
   - For Load More: create a server action in the component file or use fetch to `/api/my-leverage?offset=N` -- OR simpler: add a server action `loadMoreUsage` in `apps/web/app/actions/my-leverage.ts` that calls getSkillsUsed with offset. Import and call it on button click.
  </action>
  <verify>
`cd /home/dev/projects/relay && npx tsc --noEmit -p apps/web/tsconfig.json` compiles.
  </verify>
  <done>
HomeTabs component toggles between browse/leverage views via URL state. MyLeverageView renders stats + timelines with Load More pagination.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire tabs into home page</name>
  <files>apps/web/app/(protected)/page.tsx, apps/web/app/actions/my-leverage.ts</files>
  <action>
1. Create `apps/web/app/actions/my-leverage.ts`:
   - "use server" directive
   - Import `getSkillsUsed` from `@/lib/my-leverage`
   - Export `loadMoreUsage(userId: string, offset: number)` that calls `getSkillsUsed(userId, 20, offset)` and returns the items array
   - Include auth check: import `auth` from `@/auth`, verify session userId matches parameter

2. Update `apps/web/app/(protected)/page.tsx`:
   - Add imports: `HomeTabs` from components, all 4 functions from `@/lib/my-leverage`
   - In the parallel Promise.all, add: `getSkillsUsed(user.id!)`, `getSkillsUsedStats(user.id!)`, `getSkillsCreated(user.id!)`, `getSkillsCreatedStats(user.id!)`
   - Wrap existing page content (stats, trending, leaderboard, nav cards, impact section) in a fragment or div as `browseContent`
   - Create `leverageContent` as `<MyLeverageView>` with all 4 data props
   - Replace the outer return with `<HomeTabs browseContent={browseContent} leverageContent={leverageContent} />`
   - Keep the welcome section and search bar ABOVE the tabs (shared between both views)
  </action>
  <verify>
`cd /home/dev/projects/relay && npx tsc --noEmit -p apps/web/tsconfig.json` compiles.
Dev server: home page loads without errors, both tabs render.
  </verify>
  <done>
Home page shows Browse Skills (existing content) and My Leverage (personal stats + timeline) tabs. Tab state persists in URL. All data fetched server-side in parallel.
  </done>
</task>

</tasks>

<verification>
- TypeScript compiles
- Home page renders both tabs
- URL changes to ?view=leverage when clicking My Leverage tab
- Playwright: `npx playwright test apps/web/tests/e2e/home.spec.ts` (if exists)
</verification>

<success_criteria>
Home page has working tab toggle. Browse Skills shows existing dashboard. My Leverage shows 8 stat cards (4 per section), usage timeline with Load More, and created skills list. Empty states display when no data. Tab state in URL via nuqs.
</success_criteria>

<output>
After completion, create `.planning/phases/21-employee-usage-tracking/21-05-SUMMARY.md`
</output>
