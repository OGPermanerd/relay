---
phase: 21-employee-usage-tracking
plan: 06
type: execute
wave: 3
depends_on: ["21-02", "21-05"]
files_modified:
  - apps/web/tests/e2e/home.spec.ts
  - apps/web/tests/e2e/install-callback.spec.ts
autonomous: true

must_haves:
  truths:
    - "Home page loads without errors on both Browse Skills and My Leverage tabs"
    - "Install callback endpoint returns 200 with valid JSON"
    - "Tab switching works via URL parameter"
  artifacts:
    - path: "apps/web/tests/e2e/home.spec.ts"
      provides: "E2E tests for tabbed home page"
    - path: "apps/web/tests/e2e/install-callback.spec.ts"
      provides: "E2E test for install callback endpoint"
  key_links: []
---

<objective>
Verify all Phase 21 UI and API changes with Playwright tests.

Purpose: Automated verification that tabbed home page and install callback work correctly.
Output: Passing Playwright tests.
</objective>

<context>
@apps/web/tests/e2e/install.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write and run Playwright tests</name>
  <files>apps/web/tests/e2e/home.spec.ts, apps/web/tests/e2e/install-callback.spec.ts</files>
  <action>
1. Update or create `apps/web/tests/e2e/home.spec.ts`:
   - Test: home page loads with "Browse Skills" tab active by default
   - Test: clicking "My Leverage" tab shows leverage content and updates URL to ?view=leverage
   - Test: navigating to /?view=leverage directly shows My Leverage tab
   - Test: "Skills Used" and "Skills Created" headings visible on leverage tab
   - Test: stat cards render on leverage tab (check for StatCard-like elements)
   - Test: switching back to Browse Skills shows existing dashboard content

2. Create `apps/web/tests/e2e/install-callback.spec.ts`:
   - Test: POST /api/install-callback with valid JSON returns 200 and { ok: true }
   - Test: POST /api/install-callback with no body returns 400
   - Test: POST /api/install-callback with platform/os but no key returns 200 (anonymous OK)
   - Use `request.post()` from Playwright for API tests

3. Run all tests: `cd /home/dev/projects/relay && npx playwright test apps/web/tests/e2e/home.spec.ts apps/web/tests/e2e/install-callback.spec.ts`
  </action>
  <verify>
All Playwright tests pass: `npx playwright test apps/web/tests/e2e/home.spec.ts apps/web/tests/e2e/install-callback.spec.ts`
  </verify>
  <done>
Playwright tests confirm: home page tabs work (browse/leverage), My Leverage shows stats and timeline sections, install callback endpoint accepts POST and returns 200.
  </done>
</task>

</tasks>

<verification>
All Playwright tests pass with 0 failures.
</verification>

<success_criteria>
E2E tests verify tabbed home page navigation, My Leverage content rendering, and install callback API behavior. All tests green.
</success_criteria>

<output>
After completion, create `.planning/phases/21-employee-usage-tracking/21-06-SUMMARY.md`
</output>
