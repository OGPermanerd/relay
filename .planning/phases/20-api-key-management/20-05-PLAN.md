---
phase: 20-api-key-management
plan: 05
type: execute
wave: 4
depends_on: ["20-04"]
files_modified:
  - apps/web/app/(protected)/profile/page.tsx
autonomous: true

must_haves:
  truths:
    - "Profile page shows API Keys section below Account Information"
    - "Keys are fetched server-side and passed to client component"
    - "Existing profile content is unchanged"
  artifacts:
    - path: "apps/web/app/(protected)/profile/page.tsx"
      contains: "ApiKeyManager"
---

<objective>
Integrate the ApiKeyManager component into the profile page. Run Playwright to verify.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@apps/web/app/(protected)/profile/page.tsx
@apps/web/components/api-key-manager.tsx
</context>

<tasks>

<task type="auto">
  <name>Add API Keys section to profile page</name>
  <files>apps/web/app/(protected)/profile/page.tsx</files>
  <action>
Update the profile page (server component, no "use client"):

1. Add imports:
   - `import { listApiKeysAction } from "@/app/actions/api-keys";`
   - `import { ApiKeyManager } from "@/components/api-key-manager";`

2. In the component body, after `getUserStats()`, call:
   `const keysResult = await listApiKeysAction();`
   `const keys = (keysResult.keys || []).map(k => ({ ...k, lastUsedAt: k.lastUsedAt?.toISOString?.() ?? k.lastUsedAt ?? null, createdAt: typeof k.createdAt === 'string' ? k.createdAt : k.createdAt.toISOString(), revokedAt: k.revokedAt?.toISOString?.() ?? k.revokedAt ?? null, expiresAt: k.expiresAt?.toISOString?.() ?? k.expiresAt ?? null }));`

   Note: Dates from the DB may already be serialized as strings by the server action. Handle both cases.

3. After the Account Information section's closing `</div>`, add:
```tsx
{/* API Keys */}
<div className="mt-8">
  <h2 className="mb-4 text-lg font-semibold text-gray-900">API Keys</h2>
  <p className="mb-4 text-sm text-gray-600">Manage keys for MCP authentication</p>
  <ApiKeyManager initialKeys={keys} />
</div>
```

4. Keep ALL existing profile content unchanged.

After implementing, run Playwright:
```bash
cd /home/dev/projects/relay && npx playwright test tests/e2e/profile.spec.ts
```
  </action>
  <verify>
1. `npx playwright test tests/e2e/profile.spec.ts` passes
2. `npx tsc --noEmit -p apps/web/tsconfig.json` passes
  </verify>
  <done>Profile page shows API Keys section with ApiKeyManager. Existing content preserved. Playwright passes.</done>
</task>

</tasks>

<verification>
1. Playwright profile tests pass
2. TypeScript compiles
3. API Keys section visible below Account Information
</verification>

<success_criteria>
- Profile page renders API Keys section
- Keys fetched server-side and serialized for client component
- Existing profile content unchanged
- Playwright tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/20-api-key-management/20-05-SUMMARY.md`
</output>
