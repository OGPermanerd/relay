---
phase: 20-api-key-management
plan: 04
type: execute
wave: 3
depends_on: ["20-03"]
files_modified:
  - apps/web/components/api-key-manager.tsx
autonomous: true

must_haves:
  truths:
    - "Component shows raw key exactly once with copy button and warning"
    - "Key list shows prefix, name, status badge, last used"
    - "Revoke button works on active keys"
  artifacts:
    - path: "apps/web/components/api-key-manager.tsx"
      provides: "Client component for API key CRUD"
      min_lines: 60
---

<objective>
Create the ApiKeyManager client component for generating, viewing, revoking, and rotating API keys.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@apps/web/app/actions/api-keys.ts
@apps/web/components/sign-out-button.tsx
</context>

<tasks>

<task type="auto">
  <name>Create ApiKeyManager component</name>
  <files>apps/web/components/api-key-manager.tsx</files>
  <action>
Create `apps/web/components/api-key-manager.tsx` as a "use client" component.

**Props:** `initialKeys: Array<{ id: string; keyPrefix: string; name: string; lastUsedAt: string | null; createdAt: string; revokedAt: string | null; expiresAt: string | null }>`

**State:** keys list, newKey (string|null for show-once), isGenerating, copied, showGenerateForm

**Sections:**

1. **Generate form:** Text input for key name + "Generate Key" button. On submit, call `generateApiKey(formData)`. On success, display raw key in a yellow/amber box with monospace font, copy button (`navigator.clipboard.writeText`), and warning "Copy this key now. You will not be able to see it again." A "Done" button clears newKey and refreshes list via `listApiKeysAction()`.

2. **Rotate button:** Calls `rotateApiKey(formData)` with name "Rotated Key". Same show-once pattern for new key.

3. **Key list:** Cards or rows showing: keyPrefix (monospace), name, status badge (Active=green / Revoked=red / Expiring=yellow), lastUsedAt ("Never" if null, else relative date), createdAt. Each active/expiring key has a "Revoke" button calling `revokeApiKeyAction(keyId)`.

4. **Empty state:** "No API keys yet. Generate one to authenticate your MCP sessions."

**Styling:** Tailwind. White cards, rounded-lg, shadow-sm. Match existing profile page patterns. Status badges: `bg-green-100 text-green-700`, `bg-red-100 text-red-700`, `bg-yellow-100 text-yellow-700`.

Import server actions from `@/app/actions/api-keys`.
  </action>
  <verify>`npx tsc --noEmit -p apps/web/tsconfig.json` passes</verify>
  <done>ApiKeyManager handles generate, rotate, revoke, list with show-once key display and status badges.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit -p apps/web/tsconfig.json` passes
2. Component has "use client" directive
3. Raw key shown once with copy and warning
</verification>

<success_criteria>
- Generate shows raw key once with copy button
- Key list shows status badges
- Revoke works on active keys
- Empty state message when no keys
</success_criteria>

<output>
After completion, create `.planning/phases/20-api-key-management/20-04-SUMMARY.md`
</output>
