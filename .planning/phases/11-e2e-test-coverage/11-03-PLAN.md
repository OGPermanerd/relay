---
phase: 11-e2e-test-coverage
plan: 03
type: execute
wave: 2
depends_on: [11-01]
files_modified:
  - apps/web/tests/e2e/skill-search.spec.ts
  - apps/web/tests/e2e/profile.spec.ts
autonomous: true

must_haves:
  truths:
    - "E2E test searches for skills and verifies results update"
    - "E2E test navigates to user profile and verifies contribution stats display"
  artifacts:
    - path: "apps/web/tests/e2e/skill-search.spec.ts"
      provides: "E2E test for skill browsing and search functionality"
      min_lines: 40
    - path: "apps/web/tests/e2e/profile.spec.ts"
      provides: "E2E test for user profile page and contribution stats"
      min_lines: 25
  key_links:
    - from: "apps/web/tests/e2e/skill-search.spec.ts"
      to: "/skills"
      via: "page navigation and URL query params"
      pattern: "goto.*skills"
    - from: "apps/web/tests/e2e/profile.spec.ts"
      to: "/profile"
      via: "page navigation"
      pattern: "goto.*profile"
---

<objective>
Create E2E tests for skill search and user profile pages (TEST-03, TEST-04)

Purpose: Validate that users can browse/search skills and view their contribution stats on the profile page.

Output: skill-search.spec.ts and profile.spec.ts with passing tests
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/11-e2e-test-coverage/11-01-SUMMARY.md

@apps/web/tests/e2e/home.spec.ts
@apps/web/app/(protected)/skills/page.tsx
@apps/web/components/search-input.tsx
@apps/web/app/(protected)/profile/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skill search E2E test (TEST-03)</name>
  <files>apps/web/tests/e2e/skill-search.spec.ts</files>
  <action>
Create E2E test for skill browsing and search:

```typescript
import { test, expect } from "@playwright/test";

test.describe("Skill Browse and Search", () => {
  test("should display skills list on browse page", async ({ page }) => {
    await page.goto("/skills");

    // Verify we're on the browse page
    await expect(page.locator("h1")).toContainText("Browse Skills");

    // Verify skills are displayed (from seed data)
    // Grid should have at least one skill card
    await expect(page.locator('[class*="grid"]').first()).toBeVisible();

    // Check for known seeded skill
    await expect(page.getByText("Code Review Assistant")).toBeVisible();
  });

  test("should filter skills by search query", async ({ page }) => {
    await page.goto("/skills");

    // Type in search input
    const searchInput = page.getByPlaceholder(/search skills/i);
    await searchInput.fill("Code Review");

    // Wait for debounced search (300ms + network)
    await page.waitForURL(/\?q=Code/);

    // Verify filtered results
    await expect(page.getByText("Code Review Assistant")).toBeVisible();

    // Skill that doesn't match should not be visible
    // (API Documentation Generator shouldn't match "Code Review")
    await expect(page.getByText("API Documentation Generator")).not.toBeVisible();
  });

  test("should filter skills by category", async ({ page }) => {
    await page.goto("/skills");

    // Select category from dropdown
    await page.getByRole("combobox", { name: /category/i }).selectOption("prompt");

    // Wait for URL update
    await page.waitForURL(/category=prompt/);

    // Verify results (Code Review Assistant is category:prompt)
    await expect(page.getByText("Code Review Assistant")).toBeVisible();
  });

  test("should update URL with search parameters", async ({ page }) => {
    await page.goto("/skills");

    // Apply search filter
    await page.getByPlaceholder(/search skills/i).fill("test");
    await page.waitForURL(/\?q=test/);

    // URL should contain search param
    expect(page.url()).toContain("q=test");

    // Clear search and apply category
    await page.getByPlaceholder(/search skills/i).clear();
    await page.getByRole("combobox", { name: /category/i }).selectOption("workflow");

    // URL should update
    await page.waitForURL(/category=workflow/);
    expect(page.url()).toContain("category=workflow");
  });

  test("should show empty state for no results", async ({ page }) => {
    await page.goto("/skills");

    // Search for something that doesn't exist
    await page.getByPlaceholder(/search skills/i).fill("xyznonexistent123");

    // Wait for search to complete
    await page.waitForURL(/\?q=xyznonexistent/);

    // Should show empty state or "no results" message
    await expect(page.getByText(/no skills found|no results/i)).toBeVisible();
  });
});
```

Note: Selector for category dropdown may vary. Check CategoryFilter component for exact implementation (likely uses <select> with aria-label).
  </action>
  <verify>
Run `cd apps/web && pnpm exec playwright test skill-search.spec.ts --reporter=line`
All tests should pass.
  </verify>
  <done>skill-search.spec.ts exists with browse, search, category filter, and empty state tests, all passing</done>
</task>

<task type="auto">
  <name>Task 2: Create profile page E2E test (TEST-04)</name>
  <files>apps/web/tests/e2e/profile.spec.ts</files>
  <action>
Create E2E test for user profile page:

```typescript
import { test, expect } from "@playwright/test";

test.describe("User Profile Page", () => {
  test("should display user profile with contribution stats", async ({ page }) => {
    await page.goto("/profile");

    // Verify profile page loads (not redirected to login)
    await expect(page.locator("h1")).toBeVisible();

    // Check user info is displayed
    // Test user from auth.setup.ts: "E2E Test User"
    await expect(page.getByText("E2E Test User")).toBeVisible();
    await expect(page.getByText(/e2e-test@/i)).toBeVisible();

    // Check contribution statistics section exists
    await expect(page.getByText("Contribution Statistics")).toBeVisible();

    // Verify stat cards are present
    await expect(page.getByText("Skills Shared")).toBeVisible();
    await expect(page.getByText("Total Uses")).toBeVisible();
    await expect(page.getByText("Avg Rating")).toBeVisible();
    await expect(page.getByText("FTE Days Saved")).toBeVisible();
  });

  test("should display account information", async ({ page }) => {
    await page.goto("/profile");

    // Check account info section
    await expect(page.getByText("Account Information")).toBeVisible();

    // Verify sign-in provider is shown
    await expect(page.getByText("Sign-in Provider")).toBeVisible();
    await expect(page.getByText("Google")).toBeVisible();
  });

  test("should show numeric values for stats", async ({ page }) => {
    await page.goto("/profile");

    // Each stat card should have a number or dash
    // Look for stat value elements (the large numbers)
    const statValues = page.locator(".text-2xl.font-bold");

    // Should have 4 stat cards
    await expect(statValues).toHaveCount(4);

    // Each should contain a number or dash
    for (let i = 0; i < 4; i++) {
      const text = await statValues.nth(i).textContent();
      expect(text).toMatch(/^\d+$|^-$/); // number or dash
    }
  });
});
```

Key patterns:
- Verify authenticated access (no redirect to login)
- Check for user details from the test user created in auth.setup
- Verify all contribution stat sections are present
- Validate stats have numeric or placeholder values
  </action>
  <verify>
Run `cd apps/web && pnpm exec playwright test profile.spec.ts --reporter=line`
All tests should pass.
  </verify>
  <done>profile.spec.ts exists with profile display and contribution stats tests, all passing</done>
</task>

</tasks>

<verification>
- [ ] skill-search.spec.ts tests browse, search, category filter, URL updates
- [ ] profile.spec.ts tests profile display and contribution stats
- [ ] Both tests run successfully with `pnpm exec playwright test`
- [ ] Tests properly use authenticated session
</verification>

<success_criteria>
- TEST-03: E2E test searches for skills and verifies results update
- TEST-04: E2E test navigates to user profile and verifies contribution stats display
- Both tests pass consistently in local environment
</success_criteria>

<output>
After completion, create `.planning/phases/11-e2e-test-coverage/11-03-SUMMARY.md`
</output>
