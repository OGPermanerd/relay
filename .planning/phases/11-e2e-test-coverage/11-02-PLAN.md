---
phase: 11-e2e-test-coverage
plan: 02
type: execute
wave: 2
depends_on: [11-01]
files_modified:
  - apps/web/tests/e2e/skill-upload.spec.ts
  - apps/web/tests/e2e/skill-rating.spec.ts
autonomous: true

must_haves:
  truths:
    - "E2E test logs in and successfully uploads a skill with metadata"
    - "E2E test logs in and submits a rating with comment and time saved"
  artifacts:
    - path: "apps/web/tests/e2e/skill-upload.spec.ts"
      provides: "E2E test for authenticated skill upload flow"
      min_lines: 30
    - path: "apps/web/tests/e2e/skill-rating.spec.ts"
      provides: "E2E test for authenticated skill rating flow"
      min_lines: 30
  key_links:
    - from: "apps/web/tests/e2e/skill-upload.spec.ts"
      to: "/skills/new"
      via: "page navigation and form submission"
      pattern: "goto.*skills/new"
    - from: "apps/web/tests/e2e/skill-rating.spec.ts"
      to: "/skills/[slug]"
      via: "page navigation and rating form submission"
      pattern: "goto.*skills/"
---

<objective>
Create E2E tests for skill upload and rating flows (TEST-01, TEST-02)

Purpose: Validate that authenticated users can upload skills and submit ratings - the core contribution flows of the application.

Output: skill-upload.spec.ts and skill-rating.spec.ts with passing tests
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/11-e2e-test-coverage/11-01-SUMMARY.md

@apps/web/tests/e2e/home.spec.ts
@apps/web/app/(protected)/skills/new/page.tsx
@apps/web/components/skill-upload-form.tsx
@apps/web/components/rating-form.tsx
@apps/web/app/(protected)/skills/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skill upload E2E test (TEST-01)</name>
  <files>apps/web/tests/e2e/skill-upload.spec.ts</files>
  <action>
Create E2E test for skill upload flow:

```typescript
import { test, expect } from "@playwright/test";

test.describe("Skill Upload Flow", () => {
  test("should upload a skill with full metadata", async ({ page }) => {
    // Generate unique skill name to avoid conflicts
    const uniqueName = `E2E Test Skill ${Date.now()}`;

    // Navigate to new skill page (should work - we're authenticated)
    await page.goto("/skills/new");

    // Verify we're on the upload page (not redirected to login)
    await expect(page.locator("h1")).toContainText("Share a New Skill");

    // Fill form fields
    await page.getByLabel(/name/i).fill(uniqueName);
    await page.getByLabel(/description/i).fill("An E2E test skill for automated testing");
    await page.getByLabel(/category/i).selectOption("prompt");
    await page.getByLabel(/tags/i).fill("e2e-test, automation");
    await page.getByLabel(/usage instructions/i).fill("Use this skill for testing purposes only.");
    await page.getByLabel(/hours saved/i).fill("1");
    await page.getByLabel(/skill content/i).fill("This is test content for the E2E skill.\n\nIt has multiple lines.");

    // Submit the form
    await page.getByRole("button", { name: /create skill/i }).click();

    // Verify redirect to skill detail page
    await expect(page).toHaveURL(/\/skills\/e2e-test-skill/);

    // Verify skill details are displayed
    await expect(page.locator("h1")).toContainText(uniqueName);
    await expect(page.getByText("An E2E test skill")).toBeVisible();
  });

  test("should show validation errors for missing required fields", async ({ page }) => {
    await page.goto("/skills/new");

    // Try to submit empty form
    await page.getByRole("button", { name: /create skill/i }).click();

    // Should stay on same page (HTML5 validation or form errors)
    await expect(page).toHaveURL(/\/skills\/new/);
  });
});
```

Key patterns:
- Use getByLabel for form fields (matches label text)
- Use getByRole for buttons
- Use unique skill names to avoid slug conflicts
- Verify URL after successful submission
- Test both happy path and validation
  </action>
  <verify>
Run `cd apps/web && pnpm exec playwright test skill-upload.spec.ts --reporter=line`
All tests should pass.
  </verify>
  <done>skill-upload.spec.ts exists with upload flow test and validation test, both passing</done>
</task>

<task type="auto">
  <name>Task 2: Create skill rating E2E test (TEST-02)</name>
  <files>apps/web/tests/e2e/skill-rating.spec.ts</files>
  <action>
Create E2E test for skill rating flow:

```typescript
import { test, expect } from "@playwright/test";

test.describe("Skill Rating Flow", () => {
  // Use a seeded skill that exists from database seed
  const testSkillSlug = "code-review-assistant";

  test("should submit a rating with comment and hours saved", async ({ page }) => {
    // Navigate to skill detail page
    await page.goto(`/skills/${testSkillSlug}`);

    // Verify we're on the skill page
    await expect(page.locator("h1")).toContainText("Code Review Assistant");

    // Find the rating form section
    const ratingSection = page.locator("text=Rate This Skill").locator("..");
    // Or if already rated: "Update Your Rating"

    // Click on 4-star rating (stars are buttons or clickable elements)
    // StarRatingInput uses buttons with aria-label or data attributes
    // Check the actual implementation, likely:
    await page.getByRole("button", { name: /4 stars?/i }).click();
    // Or: await page.locator('[data-rating="4"]').click();

    // Fill comment
    await page.getByLabel(/comment/i).fill("Great skill! Tested via E2E automation.");

    // Fill hours saved
    await page.getByLabel(/hours saved/i).fill("2");

    // Submit rating
    await page.getByRole("button", { name: /submit rating|update rating/i }).click();

    // Verify success message appears
    await expect(page.getByText(/rating.*submitted|success/i)).toBeVisible();

    // Or verify the rating persists (page reloads with existing rating)
  });

  test("should show rating form for authenticated user", async ({ page }) => {
    await page.goto(`/skills/${testSkillSlug}`);

    // Rating form should be visible for authenticated users
    await expect(page.getByText(/rate this skill|update your rating/i)).toBeVisible();
    await expect(page.getByLabel(/comment/i)).toBeVisible();
  });
});
```

Note: The StarRatingInput component implementation determines exact selectors.
Check components/star-rating-input.tsx for the correct way to select stars.
May need to adjust selectors based on actual star component structure.
  </action>
  <verify>
Run `cd apps/web && pnpm exec playwright test skill-rating.spec.ts --reporter=line`
All tests should pass.
  </verify>
  <done>skill-rating.spec.ts exists with rating submission test and form visibility test, both passing</done>
</task>

</tasks>

<verification>
- [ ] skill-upload.spec.ts tests complete upload flow
- [ ] skill-rating.spec.ts tests rating submission flow
- [ ] Both tests run successfully with `pnpm exec playwright test`
- [ ] Tests properly use authenticated session (no login redirects)
</verification>

<success_criteria>
- TEST-01: E2E test logs in and successfully uploads a skill with metadata
- TEST-02: E2E test logs in and submits a rating with comment and time saved
- Both tests pass consistently in local environment
</success_criteria>

<output>
After completion, create `.planning/phases/11-e2e-test-coverage/11-02-SUMMARY.md`
</output>
