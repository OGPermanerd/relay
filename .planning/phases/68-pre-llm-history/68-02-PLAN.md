---
phase: 68-pre-llm-history
plan: 02
type: execute
wave: 2
depends_on: ["68-01"]
files_modified:
  - apps/web/lib/artifact-parser.ts
  - apps/web/components/artifact-upload-form.tsx
  - apps/web/components/artifact-list.tsx
  - apps/web/components/portfolio-view.tsx
  - apps/web/app/(protected)/portfolio/page.tsx
  - apps/web/lib/portfolio-queries.ts
  - apps/web/components/impact-timeline-chart.tsx
autonomous: true

must_haves:
  truths:
    - "User sees an 'Upload Artifact' button/section on the portfolio page"
    - "User can fill in artifact metadata (title, date, category, description) and optionally attach a file"
    - "Uploaded artifacts appear in a list on the portfolio page with title, date, category, and a Pre-platform badge"
    - "Artifacts appear on the impact timeline as scatter points with a distinct color and 'Pre-platform' label"
    - "User can delete an artifact from the list"
    - "User can edit an artifact's title, description, date, and category"
  artifacts:
    - path: "apps/web/lib/artifact-parser.ts"
      provides: "Client-side text extraction from .txt, .md, .json, .eml files"
      exports: ["parseArtifactFile"]
    - path: "apps/web/components/artifact-upload-form.tsx"
      provides: "Upload form with file input, metadata fields, and submit action"
      contains: "ArtifactUploadForm"
    - path: "apps/web/components/artifact-list.tsx"
      provides: "Artifact list display with edit/delete actions and Pre-platform badge"
      contains: "ArtifactList"
    - path: "apps/web/components/portfolio-view.tsx"
      provides: "Portfolio view with artifact section integrated"
      contains: "ArtifactList"
    - path: "apps/web/components/impact-timeline-chart.tsx"
      provides: "Timeline chart with artifact event type (4th scatter series)"
      contains: "artifactEvent"
  key_links:
    - from: "apps/web/components/artifact-upload-form.tsx"
      to: "apps/web/app/actions/work-artifacts.ts"
      via: "form action calling createWorkArtifact"
      pattern: "createWorkArtifact"
    - from: "apps/web/components/artifact-list.tsx"
      to: "apps/web/app/actions/work-artifacts.ts"
      via: "delete/edit actions calling deleteWorkArtifact, updateWorkArtifact"
      pattern: "deleteWorkArtifact|updateWorkArtifact"
    - from: "apps/web/app/(protected)/portfolio/page.tsx"
      to: "apps/web/lib/portfolio-queries.ts"
      via: "getUserArtifacts call in server component"
      pattern: "getUserArtifacts"
    - from: "apps/web/components/impact-timeline-chart.tsx"
      to: "apps/web/lib/portfolio-queries.ts"
      via: "TimelineEvent type with 'artifact' event type"
      pattern: "artifact"
---

<objective>
Build the upload form, artifact list display, timeline integration, and wire everything into the portfolio page.

Purpose: Give users the ability to upload, view, edit, and delete pre-LLM work artifacts on their portfolio, and see them on the impact timeline.
Output: Fully functional artifact upload/management UI integrated into the portfolio page with timeline visualization.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/68-pre-llm-history/68-01-SUMMARY.md — schema, server actions, query from Plan 01
@apps/web/components/portfolio-view.tsx — current portfolio layout (add artifact section)
@apps/web/app/(protected)/portfolio/page.tsx — server component (add getUserArtifacts call)
@apps/web/components/impact-timeline-chart.tsx — timeline chart (add artifact scatter series)
@apps/web/lib/skill-file-parser.ts — reference for client-side file parsing pattern
@apps/web/components/skill-file-drop-zone.tsx — reference for drag/drop file UI pattern
@apps/web/lib/portfolio-queries.ts — getImpactTimeline UNION ALL query (add artifact block)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create artifact parser, upload form, and artifact list components</name>
  <files>
    apps/web/lib/artifact-parser.ts
    apps/web/components/artifact-upload-form.tsx
    apps/web/components/artifact-list.tsx
  </files>
  <action>
1. Create `apps/web/lib/artifact-parser.ts` — simple client-side text extraction:
   - `parseArtifactFile(file: File): Promise<{ text: string | null; fileType: string }>`
   - Max file size: 5MB. Return null text if exceeded.
   - For .txt files: `await file.text()` — truncate to 100,000 chars
   - For .md files: `await file.text()` — truncate to 100,000 chars
   - For .json files: `await file.text()` — truncate to 100,000 chars
   - For .eml files: `await file.text()` — truncate to 100,000 chars
   - For other extensions: return `{ text: null, fileType: extension }` (metadata-only)
   - `fileType` = file extension (e.g., ".txt", ".md", ".pdf") extracted from file.name

2. Create `apps/web/components/artifact-upload-form.tsx` — "use client" component:
   - Props: `{ onSuccess?: () => void }` — called after successful upload to trigger revalidation
   - State: isOpen (boolean toggle for collapsible form), isPending (useTransition)
   - When collapsed: show a button "Add Pre-Platform Work" with a + icon
   - When expanded: show a form with fields:
     - Title (text input, required)
     - Description (textarea, optional)
     - Category (select: Document, Email, Template, Script, Other)
     - Date (date input, required — when the work was originally done)
     - Estimated Hours Saved (number input, optional)
     - File (file input, optional — "Attach a file to extract content")
   - On submit:
     - If file attached, call `parseArtifactFile(file)` to extract text
     - Build FormData with all fields + extractedText + fileName + fileType
     - Call `createWorkArtifact(formData)` server action
     - On success: reset form, collapse, call onSuccess
     - On error: show error message in a red alert div
   - Use `useActionState` or `startTransition` + direct server action call pattern (match existing codebase)
   - Import createWorkArtifact from "@/app/actions/work-artifacts"
   - Style: consistent with existing portfolio page (Tailwind, rounded borders, white bg cards)

3. Create `apps/web/components/artifact-list.tsx` — "use client" component:
   - Props: `{ artifacts: WorkArtifactEntry[] }` (from portfolio-queries.ts)
   - Define `WorkArtifactEntry` import type from `@/lib/portfolio-queries`
   - Each artifact row shows:
     - Title (bold)
     - Date formatted with UTC-safe MONTHS array pattern (no toLocaleDateString!)
     - Category badge (colored pill, same style as skill category badges)
     - "Pre-platform" badge (amber/yellow: `bg-amber-100 text-amber-700`)
     - Description (truncated to 100 chars if present)
     - Estimated hours saved (if present, show "{N}h saved")
     - File name (if present, show in gray text)
   - Action buttons per row:
     - Edit button: toggles inline edit mode (edit title, description, category, date, estimatedHoursSaved)
     - Delete button: confirms with window.confirm(), calls deleteWorkArtifact
   - Edit mode: replace display fields with input fields, Save/Cancel buttons
   - On edit save: call updateWorkArtifact with FormData, then router.refresh()
   - On delete: call deleteWorkArtifact with FormData, then router.refresh()
   - Empty state: "No pre-platform artifacts yet. Upload historical work to showcase your experience."
   - Use `useRouter` from next/navigation for router.refresh() after mutations
   - Use `useTransition` for isPending states on edit/delete
  </action>
  <verify>
    - `cd /home/dev/projects/relay/apps/web && npx tsc --noEmit` passes
    - Components export correctly and have no import errors
  </verify>
  <done>Artifact parser extracts text from .txt/.md/.json/.eml files. Upload form creates artifacts via server action. Artifact list displays artifacts with Pre-platform badge and supports inline edit + delete.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate artifacts into portfolio page and impact timeline</name>
  <files>
    apps/web/app/(protected)/portfolio/page.tsx
    apps/web/components/portfolio-view.tsx
    apps/web/lib/portfolio-queries.ts
    apps/web/components/impact-timeline-chart.tsx
  </files>
  <action>
1. Update `apps/web/lib/portfolio-queries.ts` — extend getImpactTimeline:
   - Update `TimelineEvent.eventType` union type to include `"artifact"`: `"creation" | "fork" | "suggestion" | "artifact"`
   - Add 4th UNION ALL block to the getImpactTimeline query CTE:
     ```sql
     UNION ALL

     SELECT
       artifact_date AS event_date,
       'artifact' AS event_type,
       title AS skill_name,
       COALESCE(estimated_hours_saved, 0)::double precision AS hours_impact
     FROM work_artifacts
     WHERE user_id = ${userId}
     ```
   - Update the row mapping to handle `"artifact"` eventType

2. Update `apps/web/app/(protected)/portfolio/page.tsx`:
   - Import `getUserArtifacts` from `@/lib/portfolio-queries`
   - Add `getUserArtifacts(session.user.id)` to the Promise.all call
   - Pass `artifacts` prop to `<PortfolioView>`

3. Update `apps/web/components/portfolio-view.tsx`:
   - Import `ArtifactUploadForm` from `@/components/artifact-upload-form`
   - Import `ArtifactList` from `@/components/artifact-list`
   - Import `WorkArtifactEntry` type from `@/lib/portfolio-queries`
   - Add `artifacts: WorkArtifactEntry[]` to PortfolioViewProps
   - Add a new section BEFORE the "Your Skills" section:
     ```
     {/* Pre-Platform Work Artifacts */}
     <section>
       <h2 className="mb-4 text-lg font-semibold text-gray-900">Pre-Platform Work</h2>
       <ArtifactUploadForm />
       <div className="mt-4">
         <ArtifactList artifacts={artifacts} />
       </div>
     </section>
     ```

4. Update `apps/web/components/impact-timeline-chart.tsx`:
   - Add `artifactEvent?: number` to `TimelineDataPoint` interface
   - In `transformTimelineForChart`: add `else if (event.eventType === "artifact")` case setting `point.artifactEvent = event.cumulativeHoursSaved`
   - Add a 4th `<Scatter>` component with amber/orange color:
     ```tsx
     <Scatter dataKey="artifactEvent" fill="#d97706" name="Pre-platform Work" />
     ```
  </action>
  <verify>
    - `cd /home/dev/projects/relay/apps/web && npx tsc --noEmit` passes
    - Dev server starts: `curl -s http://localhost:2002/api/health` returns OK
    - Portfolio page loads: `curl -s http://localhost:2002/portfolio` returns 200
    - Run existing portfolio E2E tests: `cd /home/dev/projects/relay/apps/web && npx playwright test tests/e2e/portfolio.spec.ts` — all pass
  </verify>
  <done>Portfolio page displays pre-platform work section with upload form and artifact list. Impact timeline shows artifact events as amber scatter points labeled "Pre-platform Work". All existing portfolio E2E tests still pass.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in apps/web
2. Portfolio page loads without errors at /portfolio
3. Upload form appears (collapsed initially, expands on click)
4. Artifact list renders (empty state or with data)
5. Impact timeline includes artifact scatter series
6. Existing portfolio E2E tests pass
</verification>

<success_criteria>
- User can see "Add Pre-Platform Work" button on portfolio page
- Upload form collects title, date, category, description, optional file
- Artifacts display in a list with Pre-platform badge, edit, and delete
- Timeline chart shows a 4th scatter series for artifacts in amber
- Existing portfolio E2E tests pass without modification
</success_criteria>

<output>
After completion, create `.planning/phases/68-pre-llm-history/68-02-SUMMARY.md`
</output>
