---
phase: 19-cross-platform-install
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - apps/web/components/install-button.tsx
  - apps/web/components/skills-table.tsx
  - apps/web/components/skills-table-row.tsx
  - apps/web/components/skill-accordion-content.tsx
  - apps/web/app/(protected)/skills/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking any install button opens the platform selection modal instead of copying directly"
    - "Install button in table row icon variant opens modal (does not navigate to detail page)"
    - "Install button in accordion expanded view opens modal"
    - "Skill detail page has an install button that opens the platform selection modal"
    - "Modal works correctly from every install entry point"
    - "All existing pages load without errors after integration"
  artifacts:
    - path: "apps/web/components/install-button.tsx"
      provides: "Install button that opens modal instead of direct copy"
      exports: ["InstallButton"]
    - path: "apps/web/components/skills-table.tsx"
      provides: "Table with modal-aware install flow"
      contains: "PlatformInstallModal"
    - path: "apps/web/app/(protected)/skills/[slug]/page.tsx"
      provides: "Skill detail page with install button"
      contains: "InstallButton|PlatformInstallModal"
  key_links:
    - from: "apps/web/components/install-button.tsx"
      to: "apps/web/components/platform-install-modal.tsx"
      via: "renders modal when showModal state is true"
      pattern: "PlatformInstallModal|showModal"
    - from: "apps/web/components/skills-table-row.tsx"
      to: "apps/web/components/install-button.tsx"
      via: "renders InstallButton which now opens modal"
      pattern: "InstallButton"
    - from: "apps/web/components/skill-accordion-content.tsx"
      to: "apps/web/components/install-button.tsx"
      via: "renders InstallButton which now opens modal"
      pattern: "InstallButton"
---

<objective>
Integrate the PlatformInstallModal into all existing install entry points, replacing direct clipboard copy with the modal flow.

Purpose: Wire the modal built in Plan 01 into every place users can trigger an install -- table row icon, accordion expanded view, and skill detail page. This completes the cross-platform install feature end-to-end.

Output: All install buttons open the platform selection modal. Skill detail page gets a new install button. Existing pages verified working via Playwright.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-cross-platform-install/19-01-SUMMARY.md
@apps/web/components/install-button.tsx
@apps/web/components/skills-table.tsx
@apps/web/components/skills-table-row.tsx
@apps/web/components/skill-accordion-content.tsx
@apps/web/app/(protected)/skills/[slug]/page.tsx
@apps/web/components/platform-install-modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor InstallButton to open modal and integrate into all pages</name>
  <files>
    apps/web/components/install-button.tsx
    apps/web/components/skills-table.tsx
    apps/web/components/skills-table-row.tsx
    apps/web/components/skill-accordion-content.tsx
    apps/web/app/(protected)/skills/[slug]/page.tsx
  </files>
  <action>
**Refactor InstallButton to be self-contained with modal:**

Rewrite `apps/web/components/install-button.tsx` to manage its own modal state:

```tsx
"use client";
import { useState } from "react";
import { PlatformInstallModal } from "./platform-install-modal";

interface InstallButtonProps {
  variant?: "full" | "icon";
}
```

- Remove `skillName`, `isCopied`, `onCopy` props -- they are no longer needed since the button now opens a modal instead of copying directly
- Add `variant` prop (default "full"), keep both "full" and "icon" visual variants
- Add internal `showModal` state (boolean, initially false)
- `handleClick`: call `e.stopPropagation()` (always, not just for icon variant -- prevents row navigation AND event bubbling), set `showModal(true)`
- Render the `PlatformInstallModal` when `showModal` is true, pass `onClose={() => setShowModal(false)}`
- Keep the same visual styling for both variants (icon variant: download icon SVG, full variant: blue "Install" rounded button)
- Remove the "Copied!" state visual since copy feedback is now handled inside the modal
- The button text for full variant is always "Install" (no toggling to "Copied!")

**Simplify SkillsTableRow (`apps/web/components/skills-table-row.tsx`):**
- Remove `isCopied` and `onInstall` props from the interface
- Remove `isCopied` and `onInstall` from the component parameters
- Update `InstallButton` usage: just `<InstallButton variant="icon" />` (no props needed)
- Remove swipe-to-install handler (`useSwipeable` for install) OR keep swipe but have it open the modal by calling a ref or just remove it since the modal is a better UX. Decision: Remove the swipe-to-install behavior entirely (remove `useSwipeable` import and `swipeHandlers`). Swipe was a shortcut for direct copy which no longer exists. Remove the `{...swipeHandlers}` spread from the `<tr>`. If `useSwipeable` is no longer used anywhere else in this file, remove the import.

**Simplify SkillAccordionContent (`apps/web/components/skill-accordion-content.tsx`):**
- Remove `onInstall` and `isCopied` props from the interface
- Remove those from the component parameters
- Update `InstallButton` usage: just `<InstallButton variant="full" />`

**Simplify SkillsTable (`apps/web/components/skills-table.tsx`):**
- Remove `generateMcpConfig` import from `@/lib/mcp-config`
- Remove `useClipboardCopy` import from `@/hooks/use-clipboard-copy` (if it was only used for install -- check if it's used for anything else first)
- Remove `copyToClipboard` and `isCopied` from the component
- Remove `isCopied` and `onInstall` props passed to `SkillsTableRow`
- The SkillsTableRow no longer receives these props

**Update SkillsTableRow interface** (in `skills-table.tsx` or wherever `SkillsTableRowProps` is defined in `skills-table-row.tsx`):
- Remove `isCopied: boolean` and `onInstall: () => void` from the props interface

**Add install button to skill detail page (`apps/web/app/(protected)/skills/[slug]/page.tsx`):**
- Import `InstallButton` from `@/components/install-button`
- Add the InstallButton in the skill detail section, right after the ForkButton (or next to it). Place it in the same `mt-4` div as the ForkButton, making them sit side by side:
  ```tsx
  {session?.user && (
    <div className="mt-4 flex items-center gap-3">
      <ForkButton skillId={skill.id} skillName={skill.name} forkCount={forkCount} />
      <InstallButton variant="full" />
    </div>
  )}
  ```
- Actually, the install button should be available to ALL users, not just authenticated ones. Move it outside the `session?.user` check. Place it right after the SkillDetail component:
  ```tsx
  <SkillDetail ... />

  <div className="mt-4 flex items-center gap-3">
    <InstallButton variant="full" />
    {session?.user && (
      <ForkButton skillId={skill.id} skillName={skill.name} forkCount={forkCount} />
    )}
  </div>
  ```
  This puts Install and Fork buttons on the same row, with Fork only showing for authenticated users.

**Important implementation notes:**
- The `PlatformInstallModal` uses a `fixed` overlay with `z-50`, so it will render correctly from any position in the DOM tree (no portal needed)
- Make sure all `e.stopPropagation()` calls are preserved to prevent table row navigation
- The `useSwipeable` import can be removed from `skills-table-row.tsx` if no longer used there (check if it's used for any other gesture)
- Check that `react-swipeable` is still used elsewhere before removing from package.json (do NOT remove from package.json, just remove the import in this file if unused)
  </action>
  <verify>
1. Run `npx tsc --noEmit` from `apps/web/` to confirm all files compile
2. Run the Playwright E2E tests: `npx playwright test` from the project root (or `apps/web/`) to verify all pages load without errors
3. Specifically run tests that hit the skills listing page and skill detail page to confirm no regressions
  </verify>
  <done>
Every install entry point (table row icon, accordion full button, skill detail page) opens the PlatformInstallModal instead of direct clipboard copy. No props drilling for clipboard state. SkillsTable no longer manages clipboard state for install. Skill detail page has an Install button visible to all users. All TypeScript compiles. All Playwright tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify full flow with Playwright tests</name>
  <files>
    apps/web/e2e/install.spec.ts
  </files>
  <action>
Create a Playwright E2E test file `apps/web/e2e/install.spec.ts` that verifies the install modal flow.

Follow existing test patterns in the project (check `apps/web/e2e/` for existing test files and match their setup/structure).

**Tests to write:**

1. **"install button opens platform modal from skills table"**
   - Navigate to the skills listing page
   - Find an install icon button in a table row
   - Click it
   - Assert the platform install modal is visible (look for "Install Relay MCP Server" heading text)
   - Assert 4 platform cards are visible (Claude Chat, Claude Code, Other IDE, Other Systems)

2. **"selecting a platform shows config JSON"**
   - Open the modal (from step 1)
   - Click on "Claude Code" platform card
   - Assert a `pre` element with JSON config is visible
   - Assert the JSON contains `"relay-skills"` and `"npx"`
   - Assert a "Copy" button is visible

3. **"modal stays open after clicking copy"**
   - Open the modal, select a platform
   - Click the Copy button
   - Assert modal is still visible (not closed)
   - Assert button text changes to "Copied!" (or contains a checkmark)

4. **"install button on skill detail page opens modal"**
   - Navigate to a skill detail page (use the first skill's slug from the listing)
   - Find the Install button
   - Click it
   - Assert the platform install modal is visible

5. **"detected OS label appears in modal"**
   - Open the modal
   - Assert text matching "Detected:" is visible in the modal

**Test setup notes:**
- Use the same auth/login helper as other E2E tests in the project (if they require auth)
- The skills listing page is at `/skills` (or `/(protected)/skills` -- check existing tests for the correct URL)
- Use `page.getByRole`, `page.getByText`, and `page.locator` as appropriate
- Tests should be independent (each test opens a fresh modal)
  </action>
  <verify>
Run `npx playwright test apps/web/e2e/install.spec.ts` and confirm all tests pass.
  </verify>
  <done>
5 E2E tests verify the complete install modal flow: opening from table, platform selection showing config, modal persistence after copy, opening from detail page, and OS detection label display. All tests pass.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in apps/web/ with zero errors
2. `npx playwright test` passes -- all existing tests still pass (no regressions)
3. `npx playwright test apps/web/e2e/install.spec.ts` passes -- new install tests pass
4. Install button in table row opens modal (does not navigate away)
5. Install button in accordion opens modal
6. Install button on skill detail page opens modal
7. No direct clipboard copy happens on install button click (all copy is inside modal)
</verification>

<success_criteria>
- Every install entry point opens PlatformInstallModal
- No install-related props drilling through table/row/accordion components
- Skill detail page has Install button visible to all users (not just authenticated)
- All existing Playwright tests pass (no regressions from refactor)
- New E2E tests cover modal open, platform selection, copy, and detail page integration
- Clean TypeScript compilation
</success_criteria>

<output>
After completion, create `.planning/phases/19-cross-platform-install/19-02-SUMMARY.md`
</output>
