---
phase: 65-individual-skills-portfolio
plan: 02
type: execute
wave: 2
depends_on: ["65-01"]
files_modified:
  - apps/web/app/(protected)/portfolio/page.tsx
  - apps/web/components/portfolio-view.tsx
  - apps/web/tests/e2e/portfolio.spec.ts
autonomous: true

must_haves:
  truths:
    - "User navigates to /portfolio and sees hero stat cards: Skills Authored, Total Uses, Hours Saved, and Contribution Ranking"
    - "User sees portable vs company IP breakdown with skill counts and hours saved for each"
    - "User sees a list of their skills with a Portable or Company visibility badge on each"
    - "Portfolio page shows ranking context: 'Top X%' for large teams or 'Nth of Y' for small teams"
    - "Page handles empty state gracefully when user has no published skills"
  artifacts:
    - path: "apps/web/app/(protected)/portfolio/page.tsx"
      provides: "Server component with auth guard and parallel data fetching"
      contains: "getPortfolioStats"
    - path: "apps/web/components/portfolio-view.tsx"
      provides: "Client component rendering stat cards, IP breakdown, and skill list"
      contains: "use client"
    - path: "apps/web/tests/e2e/portfolio.spec.ts"
      provides: "E2E test verifying portfolio page loads and displays content"
      contains: "portfolio"
  key_links:
    - from: "apps/web/app/(protected)/portfolio/page.tsx"
      to: "apps/web/lib/portfolio-queries.ts"
      via: "import and call getPortfolioStats, getPortfolioSkills, getContributionRanking"
      pattern: "from.*portfolio-queries"
    - from: "apps/web/app/(protected)/portfolio/page.tsx"
      to: "apps/web/components/portfolio-view.tsx"
      via: "import PortfolioView and render with props"
      pattern: "PortfolioView"
    - from: "apps/web/components/portfolio-view.tsx"
      to: "apps/web/components/stat-card.tsx"
      via: "import and render StatCard components"
      pattern: "StatCard"
---

<objective>
Build the portfolio page UI: server component page with auth guard and parallel data fetching, client view component with stat cards, portable vs company IP breakdown, skill list with visibility badges, and E2E test.

Purpose: Delivers the user-facing portfolio experience where users see their impact, IP ownership breakdown, and contribution ranking.
Output: `/portfolio` route with full page, view component, and E2E test coverage.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/65-individual-skills-portfolio/65-01-SUMMARY.md
@apps/web/app/(protected)/leverage/page.tsx
@apps/web/app/(protected)/leverage/ip-dashboard/page.tsx
@apps/web/components/my-leverage-view.tsx
@apps/web/components/stat-card.tsx
@apps/web/lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create portfolio server component page and client view component</name>
  <files>
    apps/web/app/(protected)/portfolio/page.tsx
    apps/web/components/portfolio-view.tsx
  </files>
  <action>
**Page: `apps/web/app/(protected)/portfolio/page.tsx`**

Server component following the exact pattern from `leverage/page.tsx` and `leverage/ip-dashboard/page.tsx`:

1. Export metadata: `{ title: "Portfolio | EverySkill" }`
2. Auth guard: `const session = await auth()` + redirect if no user or no tenantId
3. Parallel data fetch with Promise.all:
   ```typescript
   const [stats, skills, ranking] = await Promise.all([
     getPortfolioStats(session.user.id!),
     getPortfolioSkills(session.user.id!),
     getContributionRanking(session.user.id!, tenantId),
   ]);
   ```
4. Render `<PortfolioView stats={stats} skills={skills} ranking={ranking} />`

Import from `@/lib/portfolio-queries` and `@/components/portfolio-view`.

**View: `apps/web/components/portfolio-view.tsx`**

Client component (`"use client"`) receiving the three data objects as props. Import interfaces from `@/lib/portfolio-queries`.

Layout (top to bottom):

1. **Page Header**: `<h1>My Portfolio</h1>` with subtitle showing ranking label (e.g., "Top 15% of contributors" or "3rd of 12").

2. **Hero Stats Row**: 4 `<StatCard>` components in a responsive grid (`grid grid-cols-2 lg:grid-cols-4 gap-4`):
   - "Skills Authored" — `stats.skillsAuthored`
   - "Total Uses" — `stats.totalUses` (format with toLocaleString for thousands separator — this is OK because it's a "use client" component rendered only on client)
   - "Hours Saved" — `stats.totalHoursSaved` formatted to 1 decimal
   - "Contribution Rank" — `ranking.label` (the text label like "Top 15%" or "3rd of 12")

3. **Portable vs Company IP Breakdown**: Two side-by-side cards in a 2-column grid (`grid grid-cols-1 md:grid-cols-2 gap-4 mt-8`):

   **Portable Skills card** (green accent):
   - Header: "Portable Skills" with a green badge icon
   - Subtitle: "Skills you own regardless of employer"
   - Stats: `stats.portableSkills` skills, `stats.portableHoursSaved` hours saved
   - Green left border or green accent styling

   **Company Skills card** (blue accent):
   - Header: "Company Skills" with a blue badge icon
   - Subtitle: "Skills owned by your organization"
   - Stats: `stats.companySkills` skills, `stats.companyHoursSaved` hours saved
   - Blue left border or blue accent styling

4. **Skills List**: Section with heading "Your Skills" and a table/list of skills sorted by total hours saved descending:
   - Each row: skill name (linked to `/skills/${skill.slug}`), category, total uses, hours saved, visibility badge
   - Visibility badge component inline:
     - `"personal"` -> green badge "Portable"
     - `"tenant"` -> blue badge "Company"
   - Empty state: If no skills, show a friendly message "You haven't published any skills yet. Create your first skill to start building your portfolio."

**Important styling notes:**
- Use the same card/section styling as `my-leverage-view.tsx` (rounded-lg bg-white shadow-sm)
- Do NOT use `toLocaleDateString()` — use manual UTC formatting for any dates (per MEMORY.md)
- Use `toLocaleString()` ONLY inside "use client" components for number formatting (safe for client-only rendering)
- Import `StatCard` from `@/components/stat-card`

**Empty state handling:**
- If `stats.skillsAuthored === 0`, still show the page but with zero values and a call-to-action
- If `ranking.rank === 0`, show "No ranking yet" instead of the ranking label
  </action>
  <verify>
Run `cd /home/dev/projects/relay && npx tsc --noEmit --project apps/web/tsconfig.json 2>&1 | head -30` to verify no type errors.
Verify page renders by starting dev server and visiting http://localhost:2002/portfolio.
  </verify>
  <done>
/portfolio page loads with auth guard, shows 4 stat cards, portable vs company IP breakdown, skill list with visibility badges, and contribution ranking context. Empty state handled gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create E2E test for portfolio page</name>
  <files>apps/web/tests/e2e/portfolio.spec.ts</files>
  <action>
Create `apps/web/tests/e2e/portfolio.spec.ts` following the pattern from `my-leverage.spec.ts`:

```typescript
import { test, expect } from "@playwright/test";

test.describe("Portfolio Page", () => {
  test("should load /portfolio page with hero stats", async ({ page }) => {
    await page.goto("/portfolio");

    // Page header should be visible
    await expect(page.locator("h1")).toContainText("Portfolio");

    // Hero stat cards should be present
    await expect(page.getByText("Skills Authored")).toBeVisible();
    await expect(page.getByText("Total Uses")).toBeVisible();
    await expect(page.getByText("Hours Saved")).toBeVisible();
    await expect(page.getByText("Contribution Rank")).toBeVisible();
  });

  test("should display portable vs company IP breakdown", async ({ page }) => {
    await page.goto("/portfolio");

    // IP breakdown sections should be visible
    await expect(page.getByText("Portable Skills")).toBeVisible();
    await expect(page.getByText("Company Skills")).toBeVisible();
  });

  test("should show portfolio link in header nav", async ({ page }) => {
    await page.goto("/portfolio");

    // Portfolio nav link should exist in header
    await expect(page.getByRole("link", { name: "Portfolio" })).toBeVisible();
  });

  test("should display skills list section", async ({ page }) => {
    await page.goto("/portfolio");

    // Skills list section should be visible
    await expect(page.getByText("Your Skills")).toBeVisible();
  });
});
```

Run the test: `cd /home/dev/projects/relay/apps/web && npx playwright test tests/e2e/portfolio.spec.ts`

If the dev server was stopped for tests, restart it after: `cd /home/dev/projects/relay/apps/web && pnpm dev &`
  </action>
  <verify>
Run `cd /home/dev/projects/relay/apps/web && npx playwright test tests/e2e/portfolio.spec.ts` — all tests pass.
  </verify>
  <done>
E2E tests verify: portfolio page loads with stat cards, IP breakdown sections visible, Portfolio nav link in header, and skills list section present.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit --project apps/web/tsconfig.json` passes
2. Navigate to http://localhost:2002/portfolio — page loads with all sections
3. E2E tests pass: `npx playwright test tests/e2e/portfolio.spec.ts`
4. Portfolio nav link visible in header between Leverage and Profile
5. Stat cards show Skills Authored, Total Uses, Hours Saved, Contribution Rank
6. Portable vs Company IP breakdown shows two cards with counts and hours
7. Skills list shows visibility badge (Portable or Company) on each skill
</verification>

<success_criteria>
- /portfolio page loads for authenticated users, redirects unauthenticated users to /login
- Hero stats display skills authored, total uses, hours saved, and contribution ranking
- Portable vs Company IP breakdown shows distinct counts and hours saved
- Skills list renders with visibility badges (green "Portable", blue "Company")
- Ranking label shows "Top X%" for large teams or "Nth of Y" for small teams
- Empty state shows friendly message when user has no published skills
- E2E tests pass
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/65-individual-skills-portfolio/65-02-SUMMARY.md`
</output>
