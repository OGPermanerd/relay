---
phase: 45-hybrid-search
plan: 03
type: execute
wave: 3
depends_on: ["45-02"]
files_modified:
  - apps/web/components/discovery-results.tsx
  - apps/web/app/(protected)/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can type a natural language query in the homepage search bar and see top-3 results inline"
    - "Results show skill name, description, category, and match rationale"
    - "Loading state shows skeleton cards while search is processing"
    - "Boosted results show a visual indicator for preferred categories"
    - "Empty/no-results state is handled gracefully"
  artifacts:
    - path: "apps/web/components/discovery-results.tsx"
      provides: "Client component for discovery result cards with rationale and loading skeletons"
      contains: "DiscoveryResults"
    - path: "apps/web/app/(protected)/page.tsx"
      provides: "Homepage with integrated discovery search"
      contains: "DiscoveryResults"
  key_links:
    - from: "apps/web/components/discovery-results.tsx"
      to: "apps/web/app/actions/discover.ts"
      via: "discoverSkills server action call"
      pattern: "discoverSkills"
    - from: "apps/web/app/(protected)/page.tsx"
      to: "apps/web/components/discovery-results.tsx"
      via: "component import and render"
      pattern: "DiscoveryResults"
---

<objective>
Build the discovery UI: inline result cards with rationale below the homepage search bar.

Purpose: Users see intelligent, ranked skill recommendations directly on the homepage after submitting a natural language query, with match rationale explaining why each result matched.
Output: Discovery result cards component, integrated into the homepage with loading states.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/app/(protected)/page.tsx
@apps/web/app/actions/discover.ts
@apps/web/components/search-with-dropdown.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create discovery results component</name>
  <files>apps/web/components/discovery-results.tsx</files>
  <action>
Create `apps/web/components/discovery-results.tsx` as a client component:

```typescript
"use client";

import { useState, useTransition } from "react";
import Link from "next/link";
import { discoverSkills, type DiscoveryResult } from "@/app/actions/discover";
```

The component should contain:

1. **DiscoverySearch** -- a self-contained search form + results display:
   - Text input with placeholder "Describe what you need..." (larger, more prominent than the existing dropdown search)
   - On form submit (NOT on every keystroke), call `discoverSkills(query)` via `useTransition`
   - Show a "Discover" submit button to the right of the input
   - Use `isPending` from `useTransition` to show/hide loading skeleton

2. **Result cards** (3 cards in a row on desktop, stacked on mobile):
   - Each card shows: skill name (linked to `/skills/${slug}`), truncated description (120 chars), category badge (rounded pill, colored by category), match rationale text (italic, smaller, gray-600)
   - If `isBoosted` is true, show a small star icon or "Recommended" label next to the category badge
   - Match type indicator: small colored dot -- blue for "keyword", purple for "semantic", gradient for "both"

3. **Skeleton loading state** (3 skeleton cards):
   - Same card layout but with `animate-pulse` gray bars for name, description, category
   - Show a subtle text "Searching..." below the skeleton cards

4. **Empty state**:
   - When search returns 0 results: "No skills found matching your description. Try different terms or browse all skills." with link to `/skills`
   - Before any search: don't show anything (no cards, no skeleton)

5. **"View all results" link**:
   - Below the 3 result cards, show: "View all results for [query]" linking to `/skills?q=${encodeURIComponent(query)}`

Tailwind styling to match existing design:
- Cards: `rounded-xl border border-gray-200 bg-white p-5 shadow-sm hover:shadow-md transition`
- Grid: `grid gap-4 sm:grid-cols-2 lg:grid-cols-3`
- Category badge colors: prompt=blue, workflow=emerald, agent=purple, mcp=amber (matching existing patterns in the codebase)
- Match rationale: `text-xs italic text-gray-500 mt-2`
- Boosted indicator: `text-xs font-medium text-amber-600` with a small star SVG

Export the component as `DiscoverySearch`.
  </action>
  <verify>TypeScript compiles: `cd /home/dev/projects/relay/apps/web && npx tsc --noEmit`.</verify>
  <done>DiscoverySearch component exists with search form, result cards, skeleton loading, empty state, and preference boost indicator.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate discovery into homepage</name>
  <files>apps/web/app/(protected)/page.tsx</files>
  <action>
Modify `apps/web/app/(protected)/page.tsx`:

1. Import `DiscoverySearch` from `@/components/discovery-results`

2. Replace the current search bar section (the `SearchWithDropdown` in navigate mode) with `DiscoverySearch`. The existing `SearchWithDropdown` is a simple keyword-search dropdown that navigates to `/skills?q=...`. Replace it with the new discovery search that shows inline results.

The section currently looks like:
```tsx
{/* Search Bar */}
<div className="mb-8 flex items-center gap-4">
  <div className="max-w-xl flex-1">
    <SearchWithDropdown mode="navigate" />
  </div>
</div>
```

Replace with:
```tsx
{/* Discovery Search */}
<div className="mb-8">
  <DiscoverySearch />
</div>
```

3. Keep the `SearchWithDropdown` import ONLY if it's used elsewhere on the page. If it's only used in this one spot, remove the import.

4. Do NOT change any other part of the homepage (stats, trending, leaderboard, CTAs, tabs).

After making changes, run the dev server and Playwright tests:
```bash
cd /home/dev/projects/relay/apps/web && npx playwright test tests/e2e/home.spec.ts
```

If no home.spec.ts exists, verify manually that the homepage loads without errors:
```bash
curl -s -o /dev/null -w "%{http_code}" http://localhost:2002/
```
  </action>
  <verify>Homepage loads without errors. The discovery search component renders with the input and submit button. Submitting a query shows skeleton loading then result cards (or empty state). Run `cd /home/dev/projects/relay/apps/web && npx playwright test` to check no existing tests break.</verify>
  <done>Homepage displays the discovery search bar. Users can type natural language queries and see top-3 ranked results with match rationale inline, without leaving the page.</done>
</task>

</tasks>

<verification>
1. Homepage renders `DiscoverySearch` component (visible search input with "Describe what you need..." placeholder)
2. Submitting a query shows 3 skeleton cards then real results with rationale
3. Results link to skill detail pages
4. Empty query state shows nothing; no-results state shows helpful message
5. Boosted results show visual indicator
6. "View all results" link navigates to `/skills?q=...`
7. Existing Playwright tests still pass
</verification>

<success_criteria>
- User types "help me write better code reviews" and sees top-3 relevant skills with match rationale
- Loading skeleton appears immediately on submit, replaced by real results
- Preferred category skills show boost indicator
- No results gracefully shows helpful empty state
- Homepage TTFB not significantly impacted (search is client-triggered, not SSR)
</success_criteria>

<output>
After completion, create `.planning/phases/45-hybrid-search/45-03-SUMMARY.md`
</output>
