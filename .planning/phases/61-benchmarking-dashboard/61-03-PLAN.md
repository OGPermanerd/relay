---
phase: 61-benchmarking-dashboard
plan: 03
type: execute
wave: 3
depends_on: ["61-02"]
files_modified:
  - apps/web/components/skill-detail-tabs.tsx
  - apps/web/app/(protected)/skills/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Skill detail page has a Benchmark tab alongside Details, AI Review, and Suggestions"
    - "Benchmark tab loads with real data from DB queries (latest run, model comparison, cost trend, stats)"
    - "Tab is accessible and follows existing tab bar pattern"
  artifacts:
    - path: "apps/web/components/skill-detail-tabs.tsx"
      provides: "4-tab layout with benchmark tab"
      contains: "benchmark"
    - path: "apps/web/app/(protected)/skills/[slug]/page.tsx"
      provides: "Page wiring: fetches benchmark data and passes to BenchmarkTab"
      contains: "BenchmarkTab"
  key_links:
    - from: "apps/web/app/(protected)/skills/[slug]/page.tsx"
      to: "packages/db/src/services/benchmark.ts"
      via: "getLatestBenchmarkRun, getModelComparisonStats, getCostTrendData, getTrainingExamples"
      pattern: "getLatestBenchmarkRun|getModelComparisonStats|getCostTrendData"
    - from: "apps/web/app/(protected)/skills/[slug]/page.tsx"
      to: "apps/web/components/benchmark-tab.tsx"
      via: "BenchmarkTab component with props"
      pattern: "BenchmarkTab"
    - from: "apps/web/components/skill-detail-tabs.tsx"
      to: "benchmark tab panel"
      via: "benchmarkContent prop rendered in tabpanel"
      pattern: "benchmarkContent"
---

<objective>
Wire the Benchmark tab into the skill detail page by extending the tab component and adding data fetching.

Purpose: Connect all the backend and UI work from Plans 01-02 to the live skill detail page so users can see and interact with the Benchmark tab.

Output: Updated tab component with 4 tabs + page wiring with parallel data fetching
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/61-benchmarking-dashboard/61-02-SUMMARY.md
@apps/web/components/skill-detail-tabs.tsx
@apps/web/app/(protected)/skills/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend SkillDetailTabs with Benchmark tab</name>
  <files>apps/web/components/skill-detail-tabs.tsx</files>
  <action>
Modify the existing `skill-detail-tabs.tsx` to add a 4th "Benchmark" tab.

1. Update the TabKey union type:
```typescript
type TabKey = "details" | "ai-review" | "suggestions" | "benchmark";
```

2. Add `benchmarkContent` prop to the interface (optional with default, per existing pattern):
```typescript
interface SkillDetailTabsProps {
  children: ReactNode;
  aiReviewContent: ReactNode;
  suggestionsContent?: ReactNode;
  suggestionCount?: number;
  benchmarkContent?: ReactNode;  // NEW
}
```

3. Add default value in destructuring: `benchmarkContent = null`

4. Add the benchmark tab to the `tabs` array:
```typescript
{ key: "benchmark" as TabKey, label: "Benchmark" },
```

5. Add the benchmark tab panel after the suggestions panel:
```tsx
<div
  role="tabpanel"
  id="tabpanel-benchmark"
  aria-labelledby="tab-benchmark"
  hidden={activeTab !== "benchmark"}
>
  {benchmarkContent}
</div>
```

The new prop is optional with a default, ensuring backward compatibility (existing usages don't break).
  </action>
  <verify>Run `cd /home/dev/projects/relay/apps/web && npx tsc --noEmit` to confirm the tab component compiles and existing usages still work.</verify>
  <done>SkillDetailTabs has 4 tabs: Details, AI Review, Suggestions, Benchmark. The benchmarkContent prop is optional for backward compatibility.</done>
</task>

<task type="auto">
  <name>Task 2: Wire benchmark data fetching and BenchmarkTab into skill detail page</name>
  <files>apps/web/app/(protected)/skills/[slug]/page.tsx</files>
  <action>
Modify the skill detail page to fetch benchmark data and render the BenchmarkTab component.

1. Add imports at the top:
```typescript
import {
  getLatestBenchmarkRun,
  getModelComparisonStats,
  getCostTrendData,
  getTrainingExamples,
} from "@everyskill/db/services";
import { BenchmarkTab } from "@/components/benchmark-tab";
```

2. Add benchmark data fetching to the existing `Promise.all` block (the large parallel fetch). Add these 3 calls:
```typescript
getLatestBenchmarkRun(skill.id),
getCostTrendData(skill.id),
getTrainingExamples(skill.id),
```

Add corresponding destructured variables: `latestBenchmarkRun`, `costTrendData`, `trainingExamples`.

3. After the Promise.all, conditionally fetch model comparison stats (only if a run exists):
```typescript
const modelComparison = latestBenchmarkRun
  ? await getModelComparisonStats(latestBenchmarkRun.id)
  : [];
```

4. Serialize the latestBenchmarkRun for the client component (Dates to ISO strings):
```typescript
const serializedBenchmarkRun = latestBenchmarkRun
  ? {
      id: latestBenchmarkRun.id,
      status: latestBenchmarkRun.status,
      models: latestBenchmarkRun.models,
      bestModel: latestBenchmarkRun.bestModel,
      bestQualityScore: latestBenchmarkRun.bestQualityScore,
      cheapestModel: latestBenchmarkRun.cheapestModel,
      cheapestCostMicrocents: latestBenchmarkRun.cheapestCostMicrocents,
      completedAt: latestBenchmarkRun.completedAt?.toISOString() ?? null,
      createdAt: latestBenchmarkRun.createdAt.toISOString(),
    }
  : null;
```

5. Add the `benchmarkContent` prop to the `<SkillDetailTabs>` component:
```tsx
<SkillDetailTabs
  aiReviewContent={...existing...}
  suggestionCount={pendingSuggestionCount}
  suggestionsContent={...existing...}
  benchmarkContent={
    <BenchmarkTab
      skillId={skill.id}
      skillSlug={skill.slug}
      isAdmin={userIsAdmin}
      isAuthor={isAuthor}
      latestRun={serializedBenchmarkRun}
      modelComparison={modelComparison}
      costTrendData={costTrendData}
      costStats={costStats}
      feedbackStats={{
        totalFeedback: feedbackStats.totalFeedback,
        positivePct: feedbackStats.positivePct,
      }}
      hasTrainingExamples={trainingExamples.length > 0}
    />
  }
>
```

Note: `costStats` and `feedbackStats` are already fetched in the existing Promise.all -- just pass them through to BenchmarkTab. No duplicate fetching.

Important: Keep the existing `Promise.all` structure intact. Just add the 3 new calls at the end of the array. The destructuring order must match.
  </action>
  <verify>
Run `cd /home/dev/projects/relay/apps/web && npx tsc --noEmit` to confirm the page compiles.
Then run `cd /home/dev/projects/relay/apps/web && pnpm build` to verify a full production build succeeds.
  </verify>
  <done>Skill detail page fetches benchmark data in parallel with existing queries, serializes dates for client, and renders BenchmarkTab inside the new Benchmark tab panel. Full build succeeds.</done>
</task>

</tasks>

<verification>
- `pnpm build` succeeds (full production build)
- Skill detail page loads without errors
- Benchmark tab appears in the tab bar
- Tab switching works between all 4 tabs
- No TypeScript errors
</verification>

<success_criteria>
1. SkillDetailTabs shows 4 tabs: Details, AI Review, Suggestions, Benchmark
2. Skill detail page fetches latest benchmark run, model comparison, cost trend, and training examples in parallel
3. BenchmarkTab receives all data via props with properly serialized dates
4. Full production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/61-benchmarking-dashboard/61-03-SUMMARY.md`
</output>
