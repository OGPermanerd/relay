---
phase: 01-project-foundation
plan: 04
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - apps/web/playwright.config.ts
  - apps/web/tests/e2e/home.spec.ts
  - apps/web/package.json
  - package.json
  - turbo.json
autonomous: true

must_haves:
  truths:
    - "pnpm test:e2e runs Playwright tests against the web app"
    - "Playwright automatically starts Next.js dev server via webServer config"
    - "E2E test validates home page loads and contains expected content"
    - "Test runs in headless Chromium in CI, headed locally when needed"
  artifacts:
    - path: "apps/web/playwright.config.ts"
      provides: "Playwright test configuration"
      contains: "webServer"
      min_lines: 20
    - path: "apps/web/tests/e2e/home.spec.ts"
      provides: "Home page E2E test"
      contains: "test("
      min_lines: 10
  key_links:
    - from: "apps/web/playwright.config.ts"
      to: "Next.js dev server"
      via: "webServer.command"
      pattern: "pnpm (dev|start)"
    - from: "apps/web/tests/e2e/home.spec.ts"
      to: "apps/web/app/page.tsx"
      via: "page navigation and assertions"
      pattern: "page.goto|expect"
---

<objective>
Set up Playwright E2E testing for the web app with automatic dev server management and initial home page test.

Purpose: Enables automated validation of served pages, catching integration issues that unit tests miss. Requirement INFR-01 specifies E2E browser automation testing.

Output: Working E2E test suite that validates the home page renders correctly.
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-foundation/01-CONTEXT.md
@.planning/phases/01-project-foundation/01-RESEARCH.md
@.planning/phases/01-project-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Playwright and create configuration</name>
  <files>
    apps/web/playwright.config.ts
    apps/web/package.json
  </files>
  <action>
    Install Playwright in apps/web:
    - pnpm --filter web add -D @playwright/test

    Create apps/web/playwright.config.ts following Pattern 4 from RESEARCH.md:
    - testDir: "./tests/e2e"
    - fullyParallel: true
    - forbidOnly: !!process.env.CI (prevent .only in CI)
    - retries: 2 in CI, 0 locally
    - workers: 1 in CI, undefined (auto) locally
    - reporter: "html"
    - use.baseURL: "http://localhost:3000"
    - use.trace: "on-first-retry"

    Configure projects array with Chromium only for now:
    - name: "chromium"
    - use: devices["Desktop Chrome"]

    Configure webServer:
    - command: process.env.CI ? "pnpm start" : "pnpm dev"
    - url: "http://localhost:3000"
    - reuseExistingServer: !process.env.CI
    - timeout: 120000 (2 minutes for cold start)

    Add scripts to apps/web/package.json:
    - "test:e2e": "playwright test"
    - "test:e2e:ui": "playwright test --ui" (for local debugging)
  </action>
  <verify>
    test -f apps/web/playwright.config.ts
    grep -q "webServer" apps/web/playwright.config.ts
    grep -q "test:e2e" apps/web/package.json
  </verify>
  <done>Playwright installed and configured with webServer auto-start</done>
</task>

<task type="auto">
  <name>Task 2: Create initial E2E test for home page</name>
  <files>
    apps/web/tests/e2e/home.spec.ts
  </files>
  <action>
    Create apps/web/tests/e2e/home.spec.ts:

    Import test and expect from @playwright/test

    Create test suite "Home Page":

    Test 1: "should load and display Relay heading"
    - Navigate to "/"
    - Assert page title or heading contains "Relay"
    - Assert page is visible and not showing error state

    Test 2: "should have valid HTML structure"
    - Navigate to "/"
    - Assert html element has lang attribute
    - Assert body element exists
    - Assert no console errors (optional - use page.on('console'))

    These are baseline tests that verify the app serves correctly. More specific tests will be added as features are built.

    Make sure the test matches what's actually on the home page (check apps/web/app/page.tsx from Plan 01).
  </action>
  <verify>
    test -f apps/web/tests/e2e/home.spec.ts
    grep -q "test(" apps/web/tests/e2e/home.spec.ts
    grep -q "expect" apps/web/tests/e2e/home.spec.ts
  </verify>
  <done>Home page E2E test created with basic assertions</done>
</task>

<task type="auto">
  <name>Task 3: Add E2E test script to Turborepo and verify</name>
  <files>
    package.json
    turbo.json
  </files>
  <action>
    Add "test:e2e" task to turbo.json:
    - dependsOn: ["build"] (need built app for CI mode)
    - cache: false (E2E tests shouldn't be cached)

    Add test:e2e script to root package.json:
    - "test:e2e": "turbo test:e2e"

    Install Playwright browsers (chromium only to save time):
    - pnpm --filter web exec playwright install chromium

    Run the E2E tests to verify everything works:
    - pnpm test:e2e

    If tests fail, debug and fix:
    - Check if home page content matches test assertions
    - Check webServer is starting correctly
    - Use "pnpm --filter web test:e2e:ui" for visual debugging if needed

    Tests should pass before completing this task.
  </action>
  <verify>
    grep -q '"test:e2e"' package.json
    grep -q '"test:e2e"' turbo.json
    pnpm test:e2e 2>&1 | tail -10
  </verify>
  <done>E2E tests run via Turborepo and pass successfully</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `pnpm test:e2e` runs Playwright tests
2. Playwright automatically starts/uses dev server
3. Home page test passes
4. HTML report generated in apps/web/playwright-report/
5. Tests work both locally and would work in CI (CI mode uses built app)
</verification>

<success_criteria>
- Playwright 1.50+ installed in apps/web
- playwright.config.ts with webServer auto-start configuration
- E2E test directory at apps/web/tests/e2e/
- Home page test validates page loads and renders correctly
- test:e2e script runs from root via Turborepo
- All tests pass locally
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation/01-04-SUMMARY.md`
</output>
