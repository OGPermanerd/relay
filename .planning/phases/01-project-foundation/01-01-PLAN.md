---
phase: 01-project-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-workspace.yaml
  - turbo.json
  - .gitignore
  - .env.example
  - .prettierrc
  - .prettierignore
  - eslint.config.mjs
  - .husky/pre-commit
  - apps/web/package.json
  - apps/web/next.config.ts
  - apps/web/tsconfig.json
  - apps/web/app/layout.tsx
  - apps/web/app/page.tsx
  - packages/core/package.json
  - packages/core/tsconfig.json
  - packages/core/src/index.ts
  - packages/db/package.json
  - packages/db/tsconfig.json
  - packages/db/src/index.ts
  - packages/ui/package.json
  - packages/ui/tsconfig.json
  - packages/ui/src/index.ts
  - packages/ui/src/styles/globals.css
autonomous: true

must_haves:
  truths:
    - "pnpm dev starts web app with hot reload on localhost:3000"
    - "pnpm lint runs ESLint across all packages without errors"
    - "pnpm build compiles all packages successfully"
    - "Internal packages (@everyskill/core, @everyskill/db, @everyskill/ui) resolve without IDE errors"
  artifacts:
    - path: "pnpm-workspace.yaml"
      provides: "Workspace package configuration"
      contains: "apps/*"
    - path: "turbo.json"
      provides: "Turborepo task pipeline"
      contains: "dependsOn"
    - path: "apps/web/app/page.tsx"
      provides: "Home page component"
      min_lines: 5
    - path: "packages/core/package.json"
      provides: "@everyskill/core package definition"
      contains: "@everyskill/core"
    - path: "packages/db/package.json"
      provides: "@everyskill/db package definition"
      contains: "@everyskill/db"
    - path: "packages/ui/package.json"
      provides: "@everyskill/ui package definition"
      contains: "@everyskill/ui"
  key_links:
    - from: "apps/web/package.json"
      to: "packages/*/package.json"
      via: "workspace:* dependencies"
      pattern: "workspace:\\*"
    - from: "turbo.json"
      to: "package.json scripts"
      via: "task definitions"
      pattern: '"dev":|"build":|"lint":'
---

<objective>
Scaffold the Relay monorepo with Turborepo, pnpm workspaces, Next.js 15+, and shared packages (@everyskill/core, @everyskill/db, @everyskill/ui). Establish linting, formatting, and pre-commit hooks.

Purpose: Creates the foundation structure that all subsequent development depends on. Enables parallel feature development across apps and packages with shared dependencies.

Output: Runnable monorepo where `pnpm dev` starts the web app and `pnpm lint` validates code quality.
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-foundation/01-CONTEXT.md
@.planning/phases/01-project-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create monorepo structure with Turborepo and pnpm workspaces</name>
  <files>
    package.json
    pnpm-workspace.yaml
    turbo.json
    .gitignore
    .env.example
  </files>
  <action>
    Initialize root package.json with:
    - name: "relay"
    - private: true
    - scripts: dev, build, lint, test, test:e2e, db:generate, db:migrate, db:studio, docker:up, docker:down, prepare (husky)
    - packageManager: "pnpm@9.x"

    Create pnpm-workspace.yaml with packages: ["apps/*", "packages/*"]

    Create turbo.json following Pattern 2 from RESEARCH.md:
    - build: dependsOn ["^build"], outputs [".next/**", "!.next/cache/**", "dist/**"]
    - lint: dependsOn ["^build"]
    - dev: cache false, persistent true
    - typecheck: dependsOn ["^build"]
    - Add globalEnv for DATABASE_URL, NODE_ENV

    Create .gitignore with: node_modules, .next, dist, .env, .env.local, .turbo, *.log

    Create .env.example with DATABASE_URL and NEXT_PUBLIC_APP_URL placeholders
  </action>
  <verify>
    cat package.json | grep -q '"relay"'
    cat pnpm-workspace.yaml | grep -q 'apps/*'
    cat turbo.json | grep -q 'dependsOn'
  </verify>
  <done>Root monorepo configuration files exist with correct workspace and Turborepo setup</done>
</task>

<task type="auto">
  <name>Task 2: Create apps/web Next.js 15+ application</name>
  <files>
    apps/web/package.json
    apps/web/next.config.ts
    apps/web/tsconfig.json
    apps/web/postcss.config.mjs
    apps/web/app/layout.tsx
    apps/web/app/page.tsx
    apps/web/app/globals.css
  </files>
  <action>
    Create apps/web/package.json:
    - name: "web"
    - dependencies: next@latest, react@latest, react-dom@latest, @everyskill/core, @everyskill/db, @everyskill/ui (workspace:*)
    - devDependencies: typescript, @types/node, @tailwindcss/postcss
    - scripts: dev, build, start, lint, typecheck

    Create apps/web/next.config.ts with transpilePackages: ["@everyskill/ui", "@everyskill/core", "@everyskill/db"]

    Create apps/web/tsconfig.json extending from base, with paths for @everyskill/* packages

    Create apps/web/postcss.config.mjs with @tailwindcss/postcss plugin (Tailwind v4 pattern)

    Create apps/web/app/globals.css importing tailwindcss and @everyskill/ui/styles/globals.css

    Create apps/web/app/layout.tsx with basic HTML structure, importing globals.css

    Create apps/web/app/page.tsx with simple "Relay" heading to verify app runs
  </action>
  <verify>
    test -f apps/web/package.json
    test -f apps/web/app/page.tsx
    grep -q "@everyskill/core" apps/web/package.json
  </verify>
  <done>Next.js app exists with workspace dependencies configured</done>
</task>

<task type="auto">
  <name>Task 3: Create shared packages (@everyskill/core, @everyskill/db, @everyskill/ui)</name>
  <files>
    packages/core/package.json
    packages/core/tsconfig.json
    packages/core/src/index.ts
    packages/db/package.json
    packages/db/tsconfig.json
    packages/db/src/index.ts
    packages/db/src/client.ts
    packages/ui/package.json
    packages/ui/tsconfig.json
    packages/ui/src/index.ts
    packages/ui/src/styles/globals.css
  </files>
  <action>
    For each package (core, db, ui):

    @everyskill/core:
    - package.json: name "@everyskill/core", main "./src/index.ts", types "./src/index.ts"
    - tsconfig.json with strict mode
    - src/index.ts exporting placeholder constant (e.g., export const RELAY_VERSION = "0.0.1")

    @everyskill/db:
    - package.json: name "@everyskill/db", depends on @everyskill/core (workspace:*), drizzle-orm, postgres
    - devDependencies: drizzle-kit
    - scripts: db:generate, db:migrate, db:push, db:studio
    - tsconfig.json with strict mode
    - src/index.ts with placeholder export
    - src/client.ts with placeholder db client setup (will be implemented in Plan 02)

    @everyskill/ui:
    - package.json: name "@everyskill/ui", depends on @everyskill/core (workspace:*), react, react-dom
    - tsconfig.json with jsx: react-jsx
    - src/index.ts with placeholder export
    - src/styles/globals.css with Tailwind v4 CSS-first config (@import "tailwindcss"; @theme block with brand colors)
  </action>
  <verify>
    grep -q "@everyskill/core" packages/core/package.json
    grep -q "@everyskill/db" packages/db/package.json
    grep -q "@everyskill/ui" packages/ui/package.json
    test -f packages/ui/src/styles/globals.css
  </verify>
  <done>Three shared packages exist with correct workspace dependencies and Tailwind v4 setup</done>
</task>

<task type="auto">
  <name>Task 4: Configure ESLint, Prettier, and Husky pre-commit hooks</name>
  <files>
    eslint.config.mjs
    .prettierrc
    .prettierignore
    .husky/pre-commit
  </files>
  <action>
    Create eslint.config.mjs using ESLint 9 flat config (Pattern 5 from RESEARCH.md):
    - Import @eslint/js, typescript-eslint, @next/eslint-plugin-next
    - Use globalIgnores for node_modules, .next, dist
    - Apply Next.js rules to apps/web/**/*.{ts,tsx}
    - Set @typescript-eslint/no-explicit-any as error
    - Set @typescript-eslint/no-unused-vars as error with argsIgnorePattern: "^_"
    - Set stylistic rules (prefer-const, no-console) as warnings

    Create .prettierrc with: semi: true, singleQuote: false, tabWidth: 2, trailingComma: "es5"

    Create .prettierignore with: node_modules, .next, dist, pnpm-lock.yaml

    Install Husky and configure:
    - Run pnpm add -D husky lint-staged
    - Run pnpm exec husky init
    - Create .husky/pre-commit running "pnpm lint-staged"
    - Add lint-staged config to root package.json: *.{ts,tsx,js,jsx} runs eslint --fix and prettier --write

    Install all dependencies:
    - Run pnpm add -D eslint @eslint/js typescript-eslint @next/eslint-plugin-next prettier husky lint-staged
  </action>
  <verify>
    test -f eslint.config.mjs
    test -f .husky/pre-commit
    pnpm lint --help 2>&1 | head -1
  </verify>
  <done>ESLint flat config, Prettier, and pre-commit hooks configured and working</done>
</task>

<task type="auto">
  <name>Task 5: Install dependencies and verify development workflow</name>
  <files></files>
  <action>
    Run pnpm install to install all dependencies across workspaces

    Verify the development workflow:
    1. Run "pnpm lint" - should complete without errors (may have warnings)
    2. Run "pnpm build" - should compile all packages and apps/web
    3. Run "pnpm dev" briefly and verify localhost:3000 responds (can use curl or timeout after startup)

    Fix any issues encountered during verification.

    Create .env.local from .env.example for local development.
  </action>
  <verify>
    pnpm lint 2>&1 | tail -5
    pnpm build 2>&1 | tail -5
    curl -s -o /dev/null -w "%{http_code}" http://localhost:3000 2>/dev/null || echo "Dev server test will be manual"
  </verify>
  <done>All dependencies installed, lint and build pass, dev server starts successfully</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `pnpm lint` passes without errors
2. `pnpm build` compiles successfully
3. `pnpm dev` starts Next.js on localhost:3000
4. Monorepo structure matches RESEARCH.md recommended layout
5. Pre-commit hook triggers on git commit attempt
</verification>

<success_criteria>
- Monorepo structure: apps/web, packages/core, packages/db, packages/ui
- Workspace dependencies resolve correctly (no "Cannot find module" errors)
- Turborepo orchestrates tasks across packages
- ESLint 9 flat config enforces code quality
- Husky pre-commit hook runs lint-staged
- Next.js 15+ app serves on localhost:3000 with hot reload
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation/01-01-SUMMARY.md`
</output>
