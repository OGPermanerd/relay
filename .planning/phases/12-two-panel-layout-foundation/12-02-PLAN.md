---
phase: 12-two-panel-layout-foundation
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - apps/web/lib/search-skills.ts
  - apps/web/app/(protected)/skills/page.tsx
autonomous: true

must_haves:
  truths:
    - "Skills page displays two-panel layout with table on left"
    - "Table shows skills sorted by days_saved descending"
    - "Search bar filters table results"
    - "Leaderboard appears in right panel"
  artifacts:
    - path: "apps/web/lib/search-skills.ts"
      provides: "Extended search with createdAt and days_saved sorting"
      exports: ["searchSkills", "SearchSkillResult"]
    - path: "apps/web/app/(protected)/skills/page.tsx"
      provides: "Two-panel browse page with table"
  key_links:
    - from: "apps/web/app/(protected)/skills/page.tsx"
      to: "apps/web/components/two-panel-layout.tsx"
      via: "component import"
      pattern: "import.*TwoPanelLayout"
    - from: "apps/web/app/(protected)/skills/page.tsx"
      to: "apps/web/components/skills-table.tsx"
      via: "component import"
      pattern: "import.*SkillsTable"
    - from: "apps/web/app/(protected)/skills/page.tsx"
      to: "apps/web/lib/search-skills.ts"
      via: "function call"
      pattern: "searchSkills.*sortBy"
---

<objective>
Wire the two-panel layout and skills table into the browse page, extending the data layer to support the new table columns.

Purpose: Transform the current card-based browse experience into the new two-panel table layout while maintaining all existing functionality (search, filters).

Output: Functional two-panel browse page with skills table and leaderboard.
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-two-panel-layout-foundation/12-01-SUMMARY.md
@apps/web/lib/search-skills.ts
@apps/web/app/(protected)/skills/page.tsx
@apps/web/lib/leaderboard.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend searchSkills for table data</name>
  <files>apps/web/lib/search-skills.ts</files>
  <action>
Extend the searchSkills function to return additional fields needed for the table and add days_saved sorting.

Changes to SearchSkillResult interface - add:
```typescript
createdAt: Date;  // When skill was published
```

Changes to the select query - add:
```typescript
createdAt: skills.createdAt,
```

Add "days_saved" as a valid sortBy option:
```typescript
sortBy?: "uses" | "quality" | "rating" | "days_saved";
```

Add sorting logic for days_saved (default sort):
- Sort by: `(totalUses * COALESCE(hoursSaved, 1)) / 8` descending
- This matches the FTE Days Saved calculation used in skill-card.tsx

Update the default sort (when no sortBy specified and no search query):
- Change from `desc(skills.totalUses)` to days_saved descending
- This satisfies requirement: "Table is sorted by days_saved descending by default"

SQL for days_saved sort:
```typescript
sql`(${skills.totalUses} * COALESCE(${skills.hoursSaved}, 1)) / 8.0 DESC`
```
  </action>
  <verify>
1. SearchSkillResult interface includes createdAt: Date
2. SearchParams includes "days_saved" in sortBy union type
3. Default sort (no query, no sortBy) uses days_saved descending
4. TypeScript compiles: `npx tsc --noEmit -p apps/web/tsconfig.json`
  </verify>
  <done>searchSkills returns createdAt and defaults to days_saved sorting</done>
</task>

<task type="auto">
  <name>Task 2: Rewire page.tsx with two-panel layout</name>
  <files>apps/web/app/(protected)/skills/page.tsx</files>
  <action>
Replace the current card-based layout with the two-panel table layout.

Import new components:
```typescript
import { TwoPanelLayout } from "@/components/two-panel-layout";
import { SkillsTable } from "@/components/skills-table";
import { getLeaderboard } from "@/lib/leaderboard";
import { LeaderboardTable } from "@/components/leaderboard-table";
```

Remove unused imports:
- SkillList (no longer used - replaced by SkillsTable)
- SkillCard pattern (now handled by table rows)

Update data fetching:
```typescript
const [skills, availableTags, contributors] = await Promise.all([
  searchSkills({ query, category, tags, qualityTier, sortBy }),
  getAvailableTags(),
  getLeaderboard(10),
]);
```

Update the return JSX structure:

1. Keep the header and search/filter sections exactly as they are
2. Replace the SkillList/EmptyState section with:

```tsx
<TwoPanelLayout
  left={
    <>
      {/* Results count */}
      {skills.length > 0 && (
        <p className="mb-4 text-sm text-gray-500">
          {skills.length} skill{skills.length !== 1 ? "s" : ""} found
        </p>
      )}

      {emptyStateType ? (
        <EmptyState type={emptyStateType} query={query} category={category} />
      ) : (
        <SkillsTable skills={skills} usageTrends={usageTrends} />
      )}

      {hasFilters && skills.length === 0 && <ClearFiltersButton />}
    </>
  }
  right={
    <div>
      <h2 className="mb-4 text-lg font-semibold text-gray-900">Top Contributors</h2>
      <LeaderboardTable contributors={contributors} />
    </div>
  }
/>
```

Remove the outer max-w-6xl container since TwoPanelLayout handles it.
Keep the header and filter sections in their own div above TwoPanelLayout.
  </action>
  <verify>
1. Page imports TwoPanelLayout and SkillsTable
2. Page fetches leaderboard data with getLeaderboard
3. TwoPanelLayout wraps the main content area
4. SkillsTable receives skills and usageTrends props
5. LeaderboardTable in right panel
6. Dev server runs without errors: `npm run dev` in apps/web
7. Browse to /skills - should show two-panel layout
  </verify>
  <done>Browse page displays two-panel layout with skills table and leaderboard</done>
</task>

</tasks>

<verification>
After both tasks:
1. TypeScript compiles: `npx tsc --noEmit -p apps/web/tsconfig.json`
2. Dev server starts: `npm run dev` in apps/web
3. Browse to http://localhost:3000/skills
4. Verify: Two-panel layout visible (table left, leaderboard right)
5. Verify: Table has 6 columns with headers
6. Verify: Skills sorted by days_saved by default
7. Verify: Search filters update table results
</verification>

<success_criteria>
- Browse page displays two-panel layout
- Skills table occupies left 2/3 of screen
- Leaderboard occupies right 1/3 of screen
- Table sorted by days_saved descending by default
- Search and filters work with new table layout
- All existing E2E tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/12-two-panel-layout-foundation/12-02-SUMMARY.md`
</output>
