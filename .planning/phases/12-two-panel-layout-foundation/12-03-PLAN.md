---
phase: 12-two-panel-layout-foundation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/lib/leaderboard.ts
  - apps/web/components/leaderboard-table.tsx
autonomous: true

must_haves:
  truths:
    - "Leaderboard shows contributor handle"
    - "Leaderboard shows total days_saved per contributor"
    - "Leaderboard shows contribution count (skills shared)"
    - "Leaderboard shows latest contribution date"
  artifacts:
    - path: "apps/web/lib/leaderboard.ts"
      provides: "Leaderboard data with latest_contribution_date"
      exports: ["getLeaderboard", "LeaderboardEntry"]
    - path: "apps/web/components/leaderboard-table.tsx"
      provides: "Leaderboard display with required columns"
      exports: ["LeaderboardTable"]
  key_links:
    - from: "apps/web/components/leaderboard-table.tsx"
      to: "apps/web/lib/leaderboard.ts"
      via: "LeaderboardEntry type"
      pattern: "LeaderboardEntry"
---

<objective>
Update the leaderboard to display the four columns required by Phase 12: handle, total days_saved, contribution count, and latest contribution date.

Purpose: Simplify the leaderboard display to match the v1.2 design requirements while ensuring the data layer provides the latest_contribution_date field.

Output: Updated leaderboard matching the Phase 12 specification.
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@apps/web/lib/leaderboard.ts
@apps/web/components/leaderboard-table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add latest_contribution_date to leaderboard query</name>
  <files>apps/web/lib/leaderboard.ts</files>
  <action>
Extend the LeaderboardEntry interface and SQL query to include the latest contribution date.

Update LeaderboardEntry interface - add:
```typescript
latestContributionDate: Date | null;  // Date of most recent skill publication
```

Update the SQL CTE to include:
```sql
MAX(s.created_at) as latest_contribution_date
```

Update the SELECT to include:
```sql
latest_contribution_date::date as latest_contribution_date
```

Update the return mapping to include:
```typescript
latestContributionDate: row.latest_contribution_date ? new Date(String(row.latest_contribution_date)) : null,
```

The existing fields to KEEP (still needed):
- rank, userId, name, image (for contributor identity)
- skillsShared (contribution count - matches "# contributions" requirement)
- fteDaysSaved (matches "total days_saved" requirement)

Fields that can be REMOVED (not in Phase 12 spec):
- totalUses (not required in simplified leaderboard)
- avgRating (not required in simplified leaderboard)

Note: Keep totalUses and avgRating in the interface for now - they're used elsewhere. Just don't display them in the table.
  </action>
  <verify>
1. LeaderboardEntry interface includes latestContributionDate: Date | null
2. SQL query selects MAX(s.created_at) as latest_contribution_date
3. TypeScript compiles: `npx tsc --noEmit -p apps/web/tsconfig.json`
  </verify>
  <done>getLeaderboard returns latestContributionDate for each contributor</done>
</task>

<task type="auto">
  <name>Task 2: Update LeaderboardTable display</name>
  <files>apps/web/components/leaderboard-table.tsx</files>
  <action>
Simplify the LeaderboardTable to show only the 4 required columns per Phase 12 spec.

Required columns (from requirements):
1. **Handle** - contributor name (currently "Contributor" column, keep as-is with avatar)
2. **Total Days Saved** - fteDaysSaved field (rename header from "FTE Days" to "Days Saved")
3. **Contributions** - skillsShared field (rename header from "Skills" to "Contributions")
4. **Latest** - latestContributionDate formatted as "MMM D" (e.g., "Jan 15")

Columns to REMOVE:
- Rank column (rank is implicit from order)
- Uses column
- Rating column

Update table structure:
```tsx
<thead className="bg-gray-50">
  <tr>
    <th className="...">Contributor</th>
    <th className="... text-right">Days Saved</th>
    <th className="... text-right">Contributions</th>
    <th className="... text-right">Latest</th>
  </tr>
</thead>
```

Format latestContributionDate:
- Use toLocaleDateString with options: { month: 'short', day: 'numeric' }
- Fallback to "-" if null

Keep the existing contributor column styling (avatar + name).
Keep alternating row colors and hover states.
  </action>
  <verify>
1. Table has 4 columns: Contributor, Days Saved, Contributions, Latest
2. No Rank, Uses, or Rating columns
3. Latest column shows formatted date (e.g., "Jan 15")
4. TypeScript compiles: `npx tsc --noEmit -p apps/web/tsconfig.json`
  </verify>
  <done>LeaderboardTable displays 4 columns: handle, days_saved, contributions, latest_date</done>
</task>

</tasks>

<verification>
After both tasks:
1. TypeScript compiles: `npx tsc --noEmit -p apps/web/tsconfig.json`
2. LeaderboardEntry type includes latestContributionDate
3. LeaderboardTable renders 4 columns
4. Date formatting works correctly
</verification>

<success_criteria>
- Leaderboard shows contributor handle with avatar
- Leaderboard shows total days_saved for each contributor
- Leaderboard shows contribution count (skills shared)
- Leaderboard shows latest contribution date
- No extra columns (Uses, Rating, Rank removed)
</success_criteria>

<output>
After completion, create `.planning/phases/12-two-panel-layout-foundation/12-03-SUMMARY.md`
</output>
