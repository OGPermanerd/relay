---
status: resolved
trigger: "Investigate a bug in the PowerShell install script generated by Relay."
created: 2026-02-07T00:00:00Z
updated: 2026-02-07T00:00:01Z
---

## Current Focus

hypothesis: Line 53 `$Result = node -e $MergeScript $Existing` is failing because PowerShell passes multi-line JSON with unescaped quotes/newlines, breaking the node -e argument parsing
test: analyzing how PowerShell handles the $Existing variable expansion in node -e
expecting: PowerShell string interpolation causes JSON to be improperly escaped when passed to node
next_action: compare with bash implementation to see how it handles multi-line JSON

## Symptoms

expected: Install script should complete without errors
actual: JSON parse error shown during install callback: "SyntaxError: Expected property name or '}' in JSON at position 4 (line 2 column 3)"
errors: SyntaxError from `node -e` command - "Expected property name or '}' in JSON at position 4 (line 2 column 3)"
reproduction: Run PowerShell install script on Windows
started: Issue reported, appears to be existing bug

## Eliminated

## Evidence

- timestamp: 2026-02-07T00:00:00Z
  checked: /home/dev/projects/relay/apps/web/lib/install-script.ts lines 22-72
  found: PowerShell script structure
  implication: Error is from node -e command, need to identify which one

- timestamp: 2026-02-07T00:00:01Z
  checked: Line 53 vs line 60-62 callback
  found: Line 53 uses `node -e $MergeScript $Existing` - this is the merge. Line 60 uses PowerShell's ConvertFrom-Json (not node)
  implication: Error must be from line 53 merge script, not callback. The issue is how $Existing is passed to node.

- timestamp: 2026-02-07T00:00:02Z
  checked: PowerShell variable expansion in node -e command
  found: Line 53: `node -e $MergeScript $Existing` - $Existing contains multi-line JSON from Get-Content -Raw
  implication: When $Existing contains JSON with newlines and quotes, PowerShell may not properly escape it for node -e

- timestamp: 2026-02-07T00:00:03Z
  checked: Bash version (line 105-113)
  found: Bash uses double quotes around argument: `node -e "..." "$EXISTING"` - properly quoted
  implication: Bash properly quotes the JSON string, PowerShell does NOT quote $Existing

## Resolution

root_cause: Line 53 passes $Existing without quotes: `node -e $MergeScript $Existing`. When config file has multi-line JSON, PowerShell splits it into multiple arguments. Node's process.argv[1] receives only the first token, which is incomplete JSON, causing parse error.
fix: Add quotes around $Existing: `node -e $MergeScript "$Existing"`
verification: Test with multi-line JSON config file
files_changed: ['/home/dev/projects/relay/apps/web/lib/install-script.ts']
