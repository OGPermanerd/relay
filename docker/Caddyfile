{
    on_demand_tls {
        ask http://web-prod:2000/api/check-domain
    }
}

staging.everyskill.ai {
    tls {
        dns hetzner {env.HETZNER_DNS_API_TOKEN}
    }
    basicauth {
        {env.STAGING_AUTH_USER} {env.STAGING_AUTH_HASH}
    }
    reverse_proxy web-staging:2001 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
}

*.everyskill.ai, everyskill.ai {
    tls {
        dns hetzner {env.HETZNER_DNS_API_TOKEN}
    }

    reverse_proxy web-prod:2000 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
}

# Catch-all for vanity domains â€” on-demand TLS auto-provisions certificates
# Only domains validated by /api/check-domain will get certificates
https:// {
    tls {
        on_demand
    }
    reverse_proxy web-prod:2000 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
}
